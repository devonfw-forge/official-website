<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>JPA :: devonfw</title>
    <link rel="canonical" href="https://devonfw.com/java/current/persistence/jpa.html">
    <meta name="generator" content="Antora 3.0.2">
    <link rel="stylesheet" href="../../../_/css/site.css">
    <script>var uiRootPath = '../../../_'</script>
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://devonfw.com">devonfw</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <!-- <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Support</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Microsoft Teams</a>
            <a class="navbar-item" href="#">Yammer</a>
            <a class="navbar-item" href="#">Email</a>
          </div>
        </div>
        <a class="navbar-item" href="http://adcenter.capgemini.com/">ADCenter</a> -->
        <a class="navbar-item" href="/website/pages/learning/">Tutorials</a>
        <a class="navbar-item" href="/website/pages/solutions/">Solutions</a>
        <a class="navbar-item" href="/website/pages/docs/master.html">Docs</a>
          <div class="navbar-item search hide-for-print">
            <div id="search-field" class="field">
              <input id="search-input" type="text" placeholder="Search the docs">
            </div>
          </div>
        <a class="navbar-github navbar-item" href="https://github.com/devonfw/"></a>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="java" data-version="1">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../index.html">Java</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../getting_started/getting_started.html">Getting started</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../getting_started/create_rest_service.html">Create a REST service</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../architecture/architecture.html">Architecture</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../architecture/layered_architecture.html">Layered Architecture</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Integration</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../integration/rest-service.html">REST</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../integration/rest_exception_handling.html">RESTful Exception Handling</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../integration/rest_service_json.html">JSON</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../integration/rest_openapi.html">Open Api Generator</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Persistence</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Relational Databases</span>
<ul class="nav-list">
  <li class="nav-item is-current-page" data-depth="3">
    <a class="nav-link" href="jpa.html">JPA</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="transactional.html">Transaction</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Cross cutting</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../cross_cutting/coding_conventions.html">Coding Conventions</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../cross_cutting/configuration.html">Configuration</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../cross_cutting/dependency-injection.html">Dependency Injection</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../cross_cutting/exceptions.html">Exceptions</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../cross_cutting/i18n.html">Internationalization (I18N)</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../cross_cutting/logging.html">Logging</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Security</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../cross_cutting/security/authentication.html">Authentication</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../cross_cutting/security/authorization.html">Authorization</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../cross_cutting/security/cors.html">CORS</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../cross_cutting/security/csrf.html">CSRF</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../cross_cutting/tracing.html">Tracing</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Examples</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../examples/my-thai-star.html">My-Thai-Star Sample Application</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Java</span>
    <span class="version">1</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <a class="title" href="../index.html">Java</a>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="../index.html">1</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../typescript/current/index.html">Typescript</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../typescript/current/index.html">1</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../index.html">Java</a></li>
    <li>Persistence</li>
    <li>Relational Databases</li>
    <li><a href="jpa.html">JPA</a></li>
  </ul>
</nav>
  <div class="edit-this-page"><a href="https://github.com/devonfw/java/edit/main/modules/ROOT/pages/persistence/jpa.adoc">Edit this Page</a></div>
  </div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">JPA</h1>
<div class="sect1">
<h2 id="_general_conventions"><a class="anchor" href="#_general_conventions"></a>General conventions</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_spring_data_jpa_with_hibernate"><a class="anchor" href="#_spring_data_jpa_with_hibernate"></a>Spring Data JPA with Hibernate</h3>
<div class="ulist">
<ul>
<li>
<p>The standard for accessing relational databases in Java is the <a href="http://www.oracle.com/technetwork/java/javaee/tech/persistence-jsp-140049.html">Java Persistence API (JPA)</a>.</p>
</li>
<li>
<p><a href="http://hibernate.org/orm/">Hibernate</a> is the has proven to be a reliable implementation of JPA.</p>
</li>
<li>
<p>Use the JPA where ever possible and use vendor (hibernate) specific features only for situations when JPA does not provide a solution. In the latter case consider first if you really need the feature.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_naming_conventions"><a class="anchor" href="#_naming_conventions"></a>Naming conventions</h3>
<div class="ulist">
<ul>
<li>
<p>Entities should be named &lt;EntityName&gt;Entity</p>
</li>
<li>
<p>Repositories should be named &lt;EntityName&gt;Repository</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_entities"><a class="anchor" href="#_entities"></a>Entities</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_entities_must_not_contain_business_logic"><a class="anchor" href="#_entities_must_not_contain_business_logic"></a>Entities must not contain business logic</h3>
<div class="paragraph">
<p>Entities must be simple POJOs and not contain business logic.</p>
</div>
</div>
<div class="sect2">
<h3 id="_default_columns"><a class="anchor" href="#_default_columns"></a>Default columns</h3>
<div class="paragraph">
<p>There&#8217;s a number of columns (attributes) each entity should contain:</p>
</div>
<div class="sect3">
<h4 id="_id_specification"><a class="anchor" href="#_id_specification"></a>Id specification</h4>
<div class="ulist">
<ul>
<li>
<p>Add a <code>private Long id</code></p>
</li>
<li>
<p>The id needs to  be annotated with <a href="https://jakarta.ee/specifications/persistence/3.1/apidocs/jakarta.persistence/jakarta/persistence/id"><code>@Id</code></a>.</p>
</li>
<li>
<p>The id uses database sequence for generation of the id. <a href="https://jakarta.ee/specifications/persistence/3.1/apidocs/jakarta.persistence/jakarta/persistence/generatedvalue"><code>@GeneratedValue(strategy = GenerationType.SEQUENCE)</code></a>.</p>
</li>
<li>
<p>Use <code>Long</code> as type because it is the most efficient representation for the database.
Therefore looking up a record and joins are faster compared to e.g. <code>String</code> or <code>UUID</code>.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_modification_counter"><a class="anchor" href="#_modification_counter"></a>Modification Counter</h4>
<div class="ulist">
<ul>
<li>
<p>Add a <code>private int modificationCounter</code>.</p>
</li>
<li>
<p>The modification counter is used as version of the entity for optimistic locking.
Whenever the object gets modified and persisted this counter will be increased.</p>
</li>
<li>
<p>Use int for the modification counter.</p>
</li>
<li>
<p>Annotate the modification counter with <a href="https://jakarta.ee/specifications/persistence/3.1/apidocs/jakarta.persistence/jakarta/persistence/version"><code>@Version</code></a>.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="blobs"><a class="anchor" href="#blobs"></a>BLOBs must not be stored in byte arrays</h3>
<div class="paragraph">
<p>Byte array will cause problems if BLOBs get large because the entire BLOB is loaded into the RAM. Use the datatype <a href="https://docs.oracle.com/javase/7/docs/api/java/sql/Blob.html">Blob</a>. Stream the BLOB directly from the database to the user when the data is requested via an API.</p>
</div>
</div>
<div class="sect2">
<h3 id="_do_not_mix_granularity_of_temporal_values"><a class="anchor" href="#_do_not_mix_granularity_of_temporal_values"></a>Do not mix granularity of temporal values</h3>
<div class="ulist">
<ul>
<li>
<p>Always use <a href="https://jakarta.ee/specifications/persistence/3.1/apidocs/jakarta.persistence/jakarta/persistence/temporaltype"><code>TemporalType.TIMESTAMP</code></a> with <a href="https://jakarta.ee/specifications/persistence/3.1/apidocs/jakarta.persistence/jakarta/persistence/temporal"><code>@Temporal</code></a>.</p>
</li>
<li>
<p>Mixing with other granularities causes problems when comparing one value to another.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_always_use_lazy_loading"><a class="anchor" href="#_always_use_lazy_loading"></a>Always use lazy loading</h3>
<div class="paragraph">
<p>Application are strongly advised to always use lazy loading. Always override the default of the relationship annotation by providing <a href="https://jakarta.ee/specifications/persistence/3.1/apidocs/jakarta.persistence/jakarta/persistence/manytomany#fetch()"><code>fetch = FetchType.LAZY</code></a>, even if this is the default already.</p>
</div>
</div>
<div class="sect2">
<h3 id="_map_enums_to_dedicated_string"><a class="anchor" href="#_map_enums_to_dedicated_string"></a>Map enums to dedicated string</h3>
<div class="paragraph">
<p>Mapping enums to their ordinal or name is fragile when it comes to code changes and refactoring. Define a dedicated <a href="https://www.baeldung.com/java-enum-values#adding-constructor">string in each enum value</a> for database representation. Enums then have to be treated as a custom datatype with a converter.</p>
</div>
</div>
<div class="sect2">
<h3 id="_use_single_table_inheritance"><a class="anchor" href="#_use_single_table_inheritance"></a>Use single table inheritance</h3>
<div class="paragraph">
<p>There are several ways to handle <a href="http://openjpa.apache.org/builds/1.0.4/apache-openjpa-1.0.4/docs/manual/jpa_overview_mapping_inher.html#jpa_overview_mapping_inher_tpc">inheritance in databases</a>. In most cases, 'single table' should be used, because it is usually the fastest way to do the mapping, as no joins are needed when retrieving, searching or persisting entities.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_accessing_the_data"><a class="anchor" href="#_accessing_the_data"></a>Accessing the data</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_use_spring_respositories"><a class="anchor" href="#_use_spring_respositories"></a>Use Spring Respositories</h3>
<div class="paragraph">
<p>For each entity <code>«EntityName»Entity</code> an interface is created with the name <code>«EntityName»Repository</code> extending <a href="https://docs.spring.io/spring-data/jpa/docs/current/api/org/springframework/data/jpa/repository/JpaRepository.html"><code>JpaRepository</code></a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_use_query_for_simple_custom_queries"><a class="anchor" href="#_use_query_for_simple_custom_queries"></a>Use <code>@Query</code> for simple custom queries</h3>
<div class="paragraph">
<p>The <a href="https://docs.spring.io/spring-data/jpa/docs/current/api/org/springframework/data/jpa/repository/Query.html"><code>@Query</code></a> annotation is used for easy cases where the needed results can be found by a simple SQL query.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
In Quarkus, native and named queries via the <code>@Query</code> annotation are currently not supported. So in Quarkus fragments have to be used.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_use_fragments_for_extensive_access_with_individual_implementation"><a class="anchor" href="#_use_fragments_for_extensive_access_with_individual_implementation"></a>Use fragments for extensive access with individual implementation</h3>
<div class="paragraph">
<p><a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#repositories.custom-implementations" class="bare">https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#repositories.custom-implementations</a></p>
</div>
</div>
<div class="sect2">
<h3 id="_use_pagination"><a class="anchor" href="#_use_pagination"></a>Use pagination</h3>
<div class="paragraph">
<p>When dealing with large amounts of data, an efficient method of retrieving the data is required. Paging is used to process only small subsets of the entire data set.</p>
</div>
<div class="paragraph">
<p>If you are using Spring Data repositories you will get pagination support out of the box by providing the interfaces <a href="https://docs.spring.io/spring-data/commons/docs/current/api/org/springframework/data/domain/Pageable.html">Page</a> and <a href="https://docs.spring.io/spring-data/commons/docs/current/api/org/springframework/data/domain/Pageable.html">Pageable</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_do_not_iterate_over_1n_and_nm_relations"><a class="anchor" href="#_do_not_iterate_over_1n_and_nm_relations"></a>Do not iterate over 1:n and n:m relations</h3>
<div class="paragraph">
<p>When iterating over 1:n and n:m this most likely will end up in performance problems due to the N+1 problem. This means one query is used to fetch the entity and N queries are used to fetch the related entities.</p>
</div>
<div class="paragraph">
<p>To avoid the N+1 problem</p>
</div>
<div class="ulist">
<ul>
<li>
<p>create special functions to load the entity with the related entities <code>&lt;EntityName&gt;Repo.findBy&lt;EntityName&gt;With&lt;RelatedEntityName&gt;ById(id)</code>. This will solve the problem with one query. To do that join the tables of the entity and the related entities.</p>
</li>
<li>
<p>load the related entities with the repository of the related entity <code>&lt;RelatedEntityName&gt;Repo.findBy&lt;EntityName&gt;Id(id)</code>. This will solve the problem with two queries if the entity and the related entities are needed and with one query if only the related entities are needed.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_security"><a class="anchor" href="#_security"></a>Security</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_do_not_use_string_concatenation"><a class="anchor" href="#_do_not_use_string_concatenation"></a>Do not use string concatenation</h3>
<div class="paragraph">
<p>Never build queries with string concatenation or your code might be vulnerable through <a href="http://en.wikipedia.org/wiki/SQL_injection">SQL-Injections</a>. Consider using <a href="https://www.baeldung.com/jpa-query-parameters">Query parameters</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_use_limited_permissions"><a class="anchor" href="#_use_limited_permissions"></a>Use limited permissions</h3>
<div class="paragraph">
<p>Operate the application with a database user that has limited permissions so the user can not modify the SQL schema (e.g. drop tables). For initializing the schema (DDL) or to do schema migrations use a separate user that is not used by the application itself.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_references"><a class="anchor" href="#_references"></a>References</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="https://docs.spring.io/spring-data/jpa/docs/current/api/">Spring data JPA docs</a></p>
</li>
<li>
<p><a href="https://jakarta.ee/specifications/persistence/3.1/apidocs/jakarta.persistence/jakarta/persistence/package-summary.html">jakarta persistence docs</a></p>
</li>
<li>
<p><a href="https://docs.spring.io/spring-data/jpa/docs/current/api/org/springframework/data/jpa/repository/JpaRepository.html#findAll--">findAll</a></p>
</li>
<li>
<p><a href="https://docs.spring.io/spring-data/commons/docs/current/api/org/springframework/data/repository/CrudRepository.html?is-external=true#findById-ID-">findById</a></p>
</li>
</ul>
</div>
</div>
</div>
</article>
  </div>
</main>
</div>
<footer class="footer">
  <p>This page was built using the Antora default UI.</p>
  <p>The source code for this UI is licensed under the terms of the MPL-2.0 license.</p>
</footer>
<script src="../../../_/js/site.js"></script>
<script async src="../../../_/js/vendor/highlight.js"></script>
<script src="../../../_/js/vendor/lunr.js"></script>
<script src="../../../_/js/search-ui.js" id="search-ui-script" data-site-root-path="../../.." data-snippet-length="100" data-stylesheet="../../../_/css/search.css"></script>
<script async src="../../../search-index.js"></script>
  </body>
</html>
