<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Mailer Module :: devonfw</title>
    <link rel="canonical" href="https://devonfw.com/docs/typescript/current/nestjs/guides-mailer.html">
    <meta name="generator" content="Antora 3.0.2">
    <link rel="stylesheet" href="../../../_/css/site.css">
    <script>var uiRootPath = '../../../_'</script>
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://devonfw.com/docs">devonfw</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
    <div class="navbar-end">
        <a class="navbar-item" href="/docs/java/current/">Java</a>
        <a class="navbar-item" href="/docs/typescript/current/">TypeScript</a>
        <a class="navbar-item" href="https://github.com/devonfw/ide">IDE</a>
        <a class="navbar-item" href="https://github.com/devonfw/hangar">CI/CD</a>
        <a class="navbar-item" href="/website/pages/learning/">Tutorials</a>
        <a class="navbar-item" href="/website/pages/solutions/">Solutions</a>
        <a class="navbar-item" href="/website/pages/docs/master.html">Legacy Docs</a>
          <div class="navbar-item search hide-for-print">
            <div id="search-field" class="field">
              <input id="search-input" type="text" placeholder="Search the docs">
            </div>
          </div>
        <a class="navbar-github navbar-item" href="https://github.com/devonfw/"></a>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="typescript" data-version="1">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../index.html">Typescript</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../general/general.html">General</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../general/node_version_manager.html">nvm : Node Version Manager</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../general/package_managers.html">Package Managers</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../general/package_manager_workflow.html">Package Managers Workflow</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../general/yarn_2.html">Yarn 2</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../angular/angular-home.html">Angular</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../angular/architecture-home.html">Architecture</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../angular/ngrx-home.html">NgRx</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../angular/guide-home.html">Guides</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../angular/nx-home.html">Nx</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Resources</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../angular/guide-angular-libraries.html">Angular Libraries</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../ionic/ionic_home.html">Ionic</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../ionic/ionic_getting_started.html">Ionic Getting Started</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../ionic/ionic_to_android.html">Ionic to Android</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../ionic/ionic_pwa.html">Ionic Progress Web Apps</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="nestjs-home.html">NodeJS </a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Layers</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="layer-controller.html">Controller</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="layer-service.html">Service</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="layer-dataaccess.html">Data Access</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="guide-nestjs-home.html">Guides</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">devon4node applications</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="samples.html">devon4node Samples</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="samples-step-by-step.html">devon4node Sample Step by Step</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Resources</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="guide-nestjs-libraries.html">NestJS Libraries</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Typescript</span>
    <span class="version">1</span>
  </div>
  <ul class="components">
    <li class="component">
      <a class="title" href="../../../java/current/index.html">Java</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../java/current/index.html">1</a>
        </li>
      </ul>
    </li>
    <li class="component is-current">
      <a class="title" href="../index.html">Typescript</a>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="../index.html">1</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../index.html">Typescript</a></li>
    <li><a href="guides-mailer.html">Mailer Module</a></li>
  </ul>
</nav>
  <div class="edit-this-page"><a href="https://github.com/devonfw/typescript/edit/main/modules/ROOT/pages/nestjs/guides-mailer.adoc">Edit this Page</a></div>
  </div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">Mailer Module</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>This module enables you to send emails in devon4node. It also provides a template engine using Handlebars.</p>
</div>
<div class="paragraph">
<p>It is a NestJS module that inject into your application a <code>MailerService</code>, which is the responsible to send the emails using the nodemailer library.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_installing"><a class="anchor" href="#_installing"></a>Installing</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Execute the following command in a devon4node project:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">yarn add @devon4node/mailer</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_configuring"><a class="anchor" href="#_configuring"></a>Configuring</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To configure the mailer module, you only need to import it in your application into another module. Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">@Module({
  ...
  imports: [
    MailerModule.forRoot(),
  ],
  ...
})</code></pre>
</div>
</div>
<div class="paragraph">
<p>Your must pass the configuration using the <code>forRoot</code> or <code>forRootAsync</code> methods.</p>
</div>
<div class="sect2">
<h3 id="_forroot"><a class="anchor" href="#_forroot"></a><code>forRoot()</code></h3>
<div class="paragraph">
<p>The <code>forRoot</code> method receives an <code>MailerModuleOptions</code> object as parameter. It configures the <code>MailerModule</code> using the input <code>MailerModuleOptions</code> object.</p>
</div>
<div class="paragraph">
<p>The structure of <code>MailerModuleOptions</code> is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">{
  hbsOptions?: {
    templatesDir: string;
    extension?: string;
    partialsDir?: string;
    helpers?: IHelperFunction[];
    compilerOptions?: ICompileOptions;
  },
  mailOptions?: nodemailerSmtpTransportOptions;
  emailFrom: string;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here, you need to specify the <a href="https://handlebarsjs.com/api-reference/compilation.html#handlebars-compile-template-options">Handlebars compile options</a>, the <a href="https://nodemailer.com/smtp">nodemailer transport options</a> and the email address which will send the emails.
Then, you need to call to <code>forRoot</code> function in the module imports. Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">@Module({
  ...
  imports: [
    MailerModule.forRoot({
      mailOptions: {
        host: 'localhost',
        port: 1025,
        secure: false,
        tls: {
          rejectUnauthorized: false,
        },
      },
      emailFrom: 'noreply@capgemini.com',
      hbsOptions: {
        templatesDir: join(__dirname, '../..', 'templates/views'),
        partialsDir: join(__dirname, '../..', 'templates/partials'),
        helpers: [{
          name: 'fullname',
          func: person =&gt; `${person.name} ${person.surname}`,s
        }],
      },
    }),
  ...
})</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_forrootasync"><a class="anchor" href="#_forrootasync"></a><code>forRootAsync()</code></h3>
<div class="paragraph">
<p>The method <code>forRootAsync</code> enables you to get the mailer configuration in a asynchronous way. It is useful when you need to get the configuration using, for example, a service (e.g. <code>ConfigurationService</code>).</p>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">@Module({
  ...
  imports: [
    MailerModule.forRootAsync({
      imports: [ConfigurationModule],
      useFactory: (config: ConfigurationService) =&gt; {
        return config.mailerConfig;
      },
      inject: [ConfigurationService],
    }),
  ...
})</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this example, we use the <code>ConfigurationService</code> in order to get the <code>MailerModuleOptions</code> (the same as <code>forRoot</code>)</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_usage"><a class="anchor" href="#_usage"></a>Usage</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In order to use, you only need to inject using the dependency injection the <code>MailerService</code>.</p>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">@Injectable()
export class CatsService {
  constructor(private readonly mailer: MailerService) {}
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then, you only need to use the methods provided by the <code>MailerService</code> in your service. Take into account that you can inject it in every place that support NestJS dependency injection.</p>
</div>
<div class="sect2">
<h3 id="_mailerservice_methods"><a class="anchor" href="#_mailerservice_methods"></a><code>MailerService</code> methods</h3>
<div class="sect3">
<h4 id="_sendplainmail"><a class="anchor" href="#_sendplainmail"></a><code>sendPlainMail</code></h4>
<div class="paragraph">
<p>The method <code>sendPlainMail</code> receive a string sends a email.</p>
</div>
<div class="paragraph">
<p>The method signatures are:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">sendPlainMail(emailOptions: SendMailOptions): Promise&lt;SentMessageInfo&gt;;
sendPlainMail(to: string, subject: string, mail: string): Promise&lt;SentMessageInfo&gt;;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Examples:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">this.mailer.sendPlainMail({
  to: 'example@example.com',
  subject: 'This is a subject',
  html: '&lt;h1&gt;Hello world&lt;/h1&gt;'
});
this.mailer.sendPlainMail('example@example.com', 'This is a subject', '&lt;h1&gt;Hello world&lt;/h1&gt;');</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_sendtemplatemail"><a class="anchor" href="#_sendtemplatemail"></a><code>sendTemplateMail</code></h4>
<div class="paragraph">
<p>The method <code>sendTemplateMail</code> sends a email based on a Handlebars template. The templates are registered using the <code>templatesDir</code> option or using the <code>addTemplate</code> method.
The template name is the name of the template (without extension) or the first parameter of the method <code>addTemplate</code>.</p>
</div>
<div class="paragraph">
<p>The method signatures are:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">sendTemplateMail(emailOptions: SendMailOptions, templateName: string, emailData: any, hbsOptions?: RuntimeOptions): Promise&lt;SentMessageInfo&gt;;
sendTemplateMail(to: string, subject: string, templateName: string, emailData: any, hbsOptions?: RuntimeOptions): Promise&lt;SentMessageInfo&gt;;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Examples:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">this.mailer.sendTemplateMail({
  to: 'example@example.com',
  subject: 'This is a subject',
  html: '&lt;h1&gt;Hello world&lt;/h1&gt;'
}, 'template1', { person: {name: 'Dario', surname: 'Rodriguez'}});
this.mailer.sendTemplateMail('example@example.com', 'This is a subject', 'template1', { person: {name: 'Dario', surname: 'Rodriguez'}});</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_addtemplate"><a class="anchor" href="#_addtemplate"></a><code>addTemplate</code></h4>
<div class="paragraph">
<p>Adds a new template to the <code>MailerService</code>.</p>
</div>
<div class="paragraph">
<p>Method signature:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">addTemplate(name: string, template: string, options?: CompileOptions): void;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">this.mailer.addTemplate('newTemplate', '&lt;html&gt;&lt;head&gt;&lt;/head&gt;&lt;body&gt;{{&gt;partial1}}&lt;/body&gt;&lt;/html&gt;')</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_registerpartial"><a class="anchor" href="#_registerpartial"></a><code>registerPartial</code></h4>
<div class="paragraph">
<p>Register a new partial in Handlebars.</p>
</div>
<div class="paragraph">
<p>Method signature:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">registerPartial(name: string, partial: Handlebars.Template&lt;any&gt;): void;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">this.mailer.registerPartial('partial', '&lt;h1&gt;Hello World&lt;/h1&gt;')</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_registerhelper"><a class="anchor" href="#_registerhelper"></a><code>registerHelper</code></h4>
<div class="paragraph">
<p>Register a new helper in Handlebars.</p>
</div>
<div class="paragraph">
<p>Method signature:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">registerHelper(name: string, helper: Handlebars.HelperDelegate): void;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">this.mailer.registerHelper('fullname', person =&gt; `${person.name} ${person.surname}`)</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_handlebars_templates"><a class="anchor" href="#_handlebars_templates"></a>Handlebars templates</h2>
<div class="sectionbody">
<div class="paragraph">
<p>As mentioned above, this module allow you to use Handlebars as template engine, but it is optional. If you do not need the Handlebars, you just need to keep the <code>hbsOptions</code> undefined.</p>
</div>
<div class="paragraph">
<p>In order to get the templates form the file system, you can specify the template folder, the partials folder and the helpers.
At the moment of module initialization, it will read the content of the template folder, and will register every file with the name (without extension) and the content as Handlebars template. It will do the same for the partials.</p>
</div>
<div class="paragraph">
<p>You can specify the extension of template files using the <code>extension</code> parameter. The default value is <code>.handlebars</code></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_local_development"><a class="anchor" href="#_local_development"></a>Local development</h2>
<div class="sectionbody">
<div class="paragraph">
<p>If you want to work with this module but you don&#8217;t have a SMTP server, you can use the <code>streamTransport</code>. Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">{
  mailOptions: {
    streamTransport: true,
    newline: 'windows',
  },
  emailFrom: ...
  hbsOptions: ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then, you need to get the <code>sendPlainMail</code> or <code>sendTemplateMail</code> result, and print the email to the standard output (<code>STDOUT</code>). Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">const mail = await this.mailer.sendTemplateMail(...);

mail.message.pipe(process.stdout);</code></pre>
</div>
</div>
</div>
</div>
</article>
  </div>
</main>
</div>
<footer class="footer">
  <div class="bottom-footer">
    <ul>
      <li><a>Impressum</a></li>
    </ul>
  </div>
</footer>
<script src="../../../_/js/site.js"></script>
<script async src="../../../_/js/vendor/highlight.js"></script>
<script src="../../../_/js/vendor/lunr.js"></script>
<script src="../../../_/js/search-ui.js" id="search-ui-script" data-site-root-path="../../.." data-snippet-length="100" data-stylesheet="../../../_/css/search.css"></script>
<script async src="../../../search-index.js"></script>
  </body>
</html>
