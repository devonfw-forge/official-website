<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>State, Selection and Reducers :: devonfw</title>
    <link rel="canonical" href="https://devonfw.com/docs/typescript/current/angular/guide-ngrx-simple-store.html">
    <meta name="generator" content="Antora 3.0.2">
    <link rel="stylesheet" href="../../../_/css/site.css">
    <script>var uiRootPath = '../../../_'</script>
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://devonfw.com/docs">devonfw</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
    <div class="navbar-end">
        <a class="navbar-item" href="/docs/java/current/">Java</a>
        <a class="navbar-item" href="/docs/typescript/current/">TypeScript</a>
        <a class="navbar-item" href="#">IDE</a>
        <a class="navbar-item" href="#">CI/CD</a>
        <a class="navbar-item" href="/website/pages/learning/">Tutorials</a>
        <a class="navbar-item" href="/website/pages/solutions/">Solutions</a>
        <a class="navbar-item" href="/website/pages/docs/master.html">Legacy Docs</a>
          <div class="navbar-item search hide-for-print">
            <div id="search-field" class="field">
              <input id="search-input" type="text" placeholder="Search the docs">
            </div>
          </div>
        <a class="navbar-github navbar-item" href="https://github.com/devonfw/"></a>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="typescript" data-version="1">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../index.html">Typescript</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../general/general.html">General</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../general/node_version_manager.html">nvm : Node Version Manager</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../general/package_managers.html">Package Managers</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../general/package_manager_workflow.html">Package Managers Workflow</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../general/yarn_2.html">Yarn 2</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="angular-home.html">Angular</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="architecture-home.html">Architecture</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="ngrx-home.html">NgRx</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="guide-home.html">Guides</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="nx-home.html">Nx</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Resources</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="guide-angular-libraries.html">Angular Libraries</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../ionic/ionic_home.html">Ionic</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../ionic/ionic_getting_started.html">Ionic Getting Started</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../ionic/ionic_to_android.html">Ionic to Android</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../ionic/ionic_pwa.html">Ionic Progress Web Apps</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../nestjs/nestjs-home.html">NodeJS </a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Layers</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../nestjs/layer-controller.html">Controller</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../nestjs/layer-service.html">Service</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../nestjs/layer-dataaccess.html">Data Access</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../nestjs/guide-nestjs-home.html">Guides</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">devon4node applications</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../nestjs/samples.html">devon4node Samples</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../nestjs/samples-step-by-step.html">devon4node Sample Step by Step</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Resources</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../nestjs/guide-nestjs-libraries.html">NestJS Libraries</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Typescript</span>
    <span class="version">1</span>
  </div>
  <ul class="components">
    <li class="component">
      <a class="title" href="../../../java/current/index.html">Java</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../java/current/index.html">1</a>
        </li>
      </ul>
    </li>
    <li class="component is-current">
      <a class="title" href="../index.html">Typescript</a>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="../index.html">1</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../index.html">Typescript</a></li>
    <li><a href="guide-ngrx-simple-store.html">State, Selection and Reducers</a></li>
  </ul>
</nav>
  <div class="edit-this-page"><a href="https://github.com/devonfw/typescript/edit/main/modules/ROOT/pages/angular/guide-ngrx-simple-store.adoc">Edit this Page</a></div>
  </div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">State, Selection and Reducers</h1>
<div class="sect1">
<h2 id="_creating_a_simple_store"><a class="anchor" href="#_creating_a_simple_store"></a>Creating a Simple Store</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In the following pages we use the example of an online streaming service. We will model a particular feature, a watchlist that can be populated by the user with movies she or he wants to see in the future.</p>
</div>
<div class="sect2">
<h3 id="_initializing_ngrx"><a class="anchor" href="#_initializing_ngrx"></a>Initializing NgRx</h3>
<div class="paragraph">
<p>If you&#8217;re starting fresh, you first have to initialize NgRx and create a root state. The fastest way to do this is using the schematic:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>`ng generate @ngrx/schematics:store State --root --module app.module.ts`</pre>
</div>
</div>
<div class="paragraph">
<p>This will automatically generate a root store and register it in the app module. Next we generate a feature module for the watchlist:</p>
</div>
<div class="paragraph">
<p>` ng generate module watchlist`</p>
</div>
<div class="paragraph">
<p>and create a corresponding feature store:</p>
</div>
<div class="paragraph">
<p>` ng generate store watchlist/Watchlist -m watchlist.module.ts`</p>
</div>
<div class="paragraph">
<p>This generates a file <code>watchlist/reducers/index.ts</code> with the reducer function, and registers the store in the watchlist module declaration.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If you&#8217;re getting an error <em>Schematic "store" not found in collection "@schematics/angular"</em>, this means you forgot to register the NgRx schematics as default.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Next, add the <code>WatchlistModule</code> to the <code>AppModule</code> imports so the feature store is registered when the application starts. We also added the <strong>store devtools</strong> which we will use later, resulting in the following file:</p>
</div>
<div class="paragraph">
<p><strong>app.module.ts</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">import { BrowserModule } from '@angular/platform-browser';
import { NgModule } from '@angular/core';

import { AppComponent } from './app.component';
import { EffectsModule } from '@ngrx/effects';
import { AppEffects } from './app.effects';
import { StoreModule } from '@ngrx/store';
import { reducers, metaReducers } from './reducers';
import { StoreDevtoolsModule } from '@ngrx/store-devtools';
import { environment } from '../environments/environment';
import { WatchlistModule } from './watchlist/watchlist.module';

@NgModule({
  declarations: [
    AppComponent
  ],
  imports: [
    BrowserModule,
    WatchlistModule,
    StoreModule.forRoot(reducers, { metaReducers }),
    // Instrumentation must be imported after importing StoreModule (config is optional)
    StoreDevtoolsModule.instrument({
      maxAge: 25, // Retains last 25 states
      logOnly: environment.production, // Restrict extension to log-only mode
    }),
    !environment.production ? StoreDevtoolsModule.instrument() : []
  ],
  providers: [],
  bootstrap: [AppComponent]
})
export class AppModule { }</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_create_an_entity_model_and_initial_state"><a class="anchor" href="#_create_an_entity_model_and_initial_state"></a>Create an entity model and initial state</h3>
<div class="paragraph">
<p>We need a simple model for our list of movies. Create a file <code>watchlist/models/movies.ts</code> and insert the following code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">export interface Movie {
    id: number;
    title: string;
    releaseYear: number;
    runtimeMinutes: number;
    genre: Genre;
}

export type Genre = 'action' | 'fantasy' | 'sci-fi' | 'romantic' | 'comedy' | 'mystery';

export interface WatchlistItem {
    id: number;
    movie: Movie;
    added: Date;
    playbackMinutes: number;
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>We discourage putting several types into the same file and do this only for the sake of keeping this tutorial brief.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Later we will learn how to retrieve data from the back-end using effects. For now we will create an initial state for the user with a default movie.</p>
</div>
<div class="paragraph">
<p>State is defined and transforms by a reducer function. Let&#8217;s create a watchlist reducer:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>```
cd watchlist/reducers
ng g reducer WatchlistData --reducers index.ts
```</pre>
</div>
</div>
<div class="paragraph">
<p>Open the generated file <code>watchlist-data.reducer.ts</code>. You see three exports: The <strong>State</strong> interface defines the shape of the state. There is only one instance of a feature state in the store at all times. The <code><strong>initialState</strong></code> constant is the state at application creation time. The <strong>reducer</strong> function will later be called by the store to produce the next state instance based on the current state and an action object.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s put a movie into the user&#8217;s watchlist:</p>
</div>
<div class="paragraph">
<p><strong>watchlist-data.reducer.ts</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">export interface State {
  items: WatchlistItem[];
}

export const initialState: State = {
  items: [
    {
      id: 42,
      movie: {
        id: 1,
        title: 'Die Hard',
        genre: 'action',
        releaseYear: 1988,
        runtimeMinutes: 132
      },
      playbackMinutes: 0,
      added: new Date(),
    }
  ]
};</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_select_the_current_watchlist"><a class="anchor" href="#_select_the_current_watchlist"></a>Select the current watchlist</h3>
<div class="paragraph">
<p>State slices can be retrieved from the store using selectors.</p>
</div>
<div class="paragraph">
<p>Create a watchlist component:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>`ng g c watchlist/Watchlist`</pre>
</div>
</div>
<div class="paragraph">
<p>and add it to the exports of <code>WatchlistModule</code>. Also, replace <code>app.component.html</code> with</p>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;app-watchlist&gt;&lt;/app-watchlist&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>State observables are obtained using selectors. They are memoized by default, meaning that you don&#8217;t have to worry about performance if you use complicated calculations when deriving state&#8201;&#8212;&#8201;these are only performed once per state emission.</p>
</div>
<div class="paragraph">
<p>Add a selector to <code>watchlist-data.reducer.ts</code>:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>`export const getAllItems = (state: State) =&gt; state.items;`</pre>
</div>
</div>
<div class="paragraph">
<p>Next, we have to re-export the selector for this sub-state in the feature reducer. Modify the <code>watchlist/reducers/index.ts</code> like this:</p>
</div>
<div class="paragraph">
<p><strong>watchlist/reducers/index.ts</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">import {
  ActionReducer,
  ActionReducerMap,
  createFeatureSelector,
  createSelector,
  MetaReducer
} from '@ngrx/store';
import { environment } from 'src/environments/environment';
import * as fromWatchlistData from './watchlist-data.reducer';
import * as fromRoot from 'src/app/reducers/index';

export interface WatchlistState { <i class="conum" data-value="1"></i><b>(1)</b>
  watchlistData: fromWatchlistData.State;
}

export interface State extends fromRoot.State { <i class="conum" data-value="2"></i><b>(2)</b>
  watchlist: WatchlistState;
}

export const reducers: ActionReducerMap&lt;WatchlistState&gt; = { <i class="conum" data-value="3"></i><b>(3)</b>
  watchlistData: fromWatchlistData.reducer,
};

export const metaReducers: MetaReducer&lt;WatchlistState&gt;[] = !environment.production ? [] : [];

export const getFeature = createFeatureSelector&lt;State, WatchlistState&gt;('watchlist'); <i class="conum" data-value="4"></i><b>(4)</b>

export const getWatchlistData = createSelector( <i class="conum" data-value="5"></i><b>(5)</b>
  getFeature,
  state =&gt; state.watchlistData
);

export const getAllItems = createSelector( <i class="conum" data-value="6"></i><b>(6)</b>
  getWatchlistData,
  fromWatchlistData.getAllItems
);</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The feature state, each member is managed by a different reducer</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Feature states are registered by the <code>forFeature</code> method. This interface provides a typesafe path from root to feature state.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Tie sub-states of a feature state to the corresponding reducers</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Create a selector to access the 'watchlist' feature state</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>select the <code>watchlistData</code> sub state</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>re-export the selector</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Note how <code>createSelector</code> allows to chain selectors. This is a powerful tool that also allows for selecting from multiple states.</p>
</div>
<div class="paragraph">
<p>You can use selectors as pipeable operators:</p>
</div>
<div class="paragraph">
<p><strong>watchlist.component.ts</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">export class WatchlistComponent {
  watchlistItems$: Observable&lt;WatchlistItem[]&gt;;

  constructor(
    private store: Store&lt;fromWatchlist.State&gt;
  ) {
    this.watchlistItems$ = this.store.pipe(select(fromWatchlist.getAllItems));
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>watchlist.component.html</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">&lt;h1&gt;Watchlist&lt;/h1&gt;
&lt;ul&gt;
    &lt;li *ngFor="let item of watchlistItems$ | async"&gt;{{item.movie.title}} ({{item.movie.releaseYear}}): {{item.playbackMinutes}}/{{item.movie.runtimeMinutes}} min watched&lt;/li&gt;
&lt;/ul&gt;</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_dispatching_an_action_to_update_watched_minutes"><a class="anchor" href="#_dispatching_an_action_to_update_watched_minutes"></a>Dispatching an action to update watched minutes</h3>
<div class="paragraph">
<p>We track the user&#8217;s current progress at watching a movie as the <code>playbackMinutes</code> property. After closing a video, the watched minutes have to be updated. In NgRx, state is being updated by dispatching actions. An action is an option with a (globally unique) type discriminator and an optional payload.</p>
</div>
<div class="sect3">
<h4 id="_creating_the_action"><a class="anchor" href="#_creating_the_action"></a>Creating the action</h4>
<div class="paragraph">
<p>Create a file <code>playback/actions/index.ts</code>. In this example, we do not further separate the actions per sub state. Actions can be defined by using action creators:</p>
</div>
<div class="paragraph">
<p><strong>playback/actions/index.ts</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">import { createAction, props, union } from '@ngrx/store';

export const playbackFinished = createAction('[Playback] Playback finished', props&lt;{ movieId: number, stoppedAtMinute: number }&gt;());

const actions = union({
    playbackFinished
});

export type ActionsUnion = typeof actions;</code></pre>
</div>
</div>
<div class="paragraph">
<p>First we specify the type, followed by a call to the payload definition function. Next, we create a union of all possible actions for this file using <code>union</code>, which allows us a to access action payloads in the reducer in a typesafe way.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Action types should follow the naming convention <code>[Source] Event</code>, e.g. <code>[Recommended List] Hide Recommendation</code> or <code>[Auth API] Login Success</code>. Think of actions rather as events than commands. You should never use the same action at two different places (you can still handle multiple actions the same way). This facilitate tracing the source of an action. For details see <a href="https://www.youtube.com/watch?v=JmnsEvoy-gY">Good Action Hygiene with NgRx</a> by Mike Ryan (video).</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_dispatch"><a class="anchor" href="#_dispatch"></a>Dispatch</h4>
<div class="paragraph">
<p>We skip the implementation of an actual video playback page and simulate watching a movie in 10 minute segments by adding a link in the template:</p>
</div>
<div class="paragraph">
<p><strong>watchlist-component.html</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">&lt;li *ngFor="let item of watchlistItems$ | async"&gt;... &lt;button (click)="stoppedPlayback(item.movie.id, item.playbackMinutes + 10)"&gt;Add 10 Minutes&lt;/button&gt;&lt;/li&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>watchlist-component.ts</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">import * as playbackActions from 'src/app/playback/actions';
...
  stoppedPlayback(movieId: number, stoppedAtMinute: number) {
    this.store.dispatch(playbackActions.playbackFinished({ movieId, stoppedAtMinute }));
  }</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_state_reduction"><a class="anchor" href="#_state_reduction"></a>State reduction</h4>
<div class="paragraph">
<p>Next, we handle the action inside the <code>watchlistData</code> reducer. Note that actions can be handled by multiple reducers and effects at the same time to update different states, for example if we&#8217;d like to show a rating modal after playback has finished.</p>
</div>
<div class="paragraph">
<p><strong>watchlist-data.reducer.ts</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">export function reducer(state = initialState, action: playbackActions.ActionsUnion): State {
  switch (action.type) {
    case playbackActions.playbackFinished.type:
      return {
        ...state,
        items: state.items.map(updatePlaybackMinutesMapper(action.movieId, action.stoppedAtMinute))
      };

    default:
      return state;
  }
}

export function updatePlaybackMinutesMapper(movieId: number, stoppedAtMinute: number) {
  return (item: WatchlistItem) =&gt; {
    if (item.movie.id === movieId) {
      return {
        ...item,
        playbackMinutes: stoppedAtMinute
      };
    } else {
      return item;
    }
  };
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note how we changed the reducer&#8217;s function signature to reference the actions union. The switch-case handles all incoming actions to produce the next state. The default case handles all actions a reducer is not interested in by returning the state unchanged. Then we find the watchlist item corresponding to the movie with the given id and update the playback minutes. Since state is immutable, we have to clone all objects down to the one we would like to change using the object spread operator (<code>&#8230;&#8203;</code>).</p>
</div>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<i class="fa icon-caution" title="Caution"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Selectors rely on object identity to decide whether the value has to be recalculated. Do not clone objects that are not on the path to the change you want to make. This is why <code>updatePlaybackMinutesMapper</code> returns the same item if the movie id does not match.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_alternative_state_mapping_with_immer"><a class="anchor" href="#_alternative_state_mapping_with_immer"></a>Alternative state mapping with Immer</h4>
<div class="paragraph">
<p>It can be hard to think in immutable changes, especially if your team has a strong background in imperative programming. In this case, you may find the <a href="https://github.com/immerjs/immer">Immer</a> library convenient, which allows to produce immutable objects by manipulating a proxied draft. The same reducer can then be written as:</p>
</div>
<div class="paragraph">
<p><strong>watchlist-data.reducer.ts</strong> with Immer</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">import { produce } from 'immer';
...
case playbackActions.playbackFinished.type:
      return produce(state, draft =&gt; {
        const itemToUpdate = draft.items.find(item =&gt; item.movie.id === action.movieId);
        if (itemToUpdate) {
          itemToUpdate.playbackMinutes = action.stoppedAtMinute;
        }
      });</code></pre>
</div>
</div>
<div class="paragraph">
<p>Immer works out of the box with plain objects and arrays.</p>
</div>
</div>
<div class="sect3">
<h4 id="_redux_devtools"><a class="anchor" href="#_redux_devtools"></a>Redux devtools</h4>
<div class="paragraph">
<p>If the <code>StoreDevToolsModule</code> is instrumented as described above, you can use the browser extension <a href="https://github.com/reduxjs/redux-devtools">Redux devtools</a> to see all dispatched actions and the resulting state diff, as well as the current state, and even travel back in time by undoing actions.</p>
</div>
<div class="imageblock text-center">
<div class="content">
<a class="image" href="images/ngrx-devtools.png"><img src="../_images/ngrx-devtools.png" alt="Redux Devtools"></a>
</div>
<div class="title">Figure 1. Redux devtools</div>
</div>
<div class="paragraph">
<p>Continue with <a href="guide-ngrx-effects">learning about effects</a></p>
</div>
</div>
</div>
</div>
</div>
</article>
  </div>
</main>
</div>
<footer class="footer">
  <div class="bottom-footer">
    <ul>
      <li><a>Impressum</a></li>
    </ul>
  </div>
</footer>
<script src="../../../_/js/site.js"></script>
<script async src="../../../_/js/vendor/highlight.js"></script>
<script src="../../../_/js/vendor/lunr.js"></script>
<script src="../../../_/js/search-ui.js" id="search-ui-script" data-site-root-path="../../.." data-snippet-length="100" data-stylesheet="../../../_/css/search.css"></script>
<script async src="../../../search-index.js"></script>
  </body>
</html>
