<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=">
<meta name="generator" content="Asciidoctor 1.5.8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- ******** SOCIAL MEDIA META ********** -->

<meta name="title" property="og:title" content="devonfw website">
<meta property="og:type" content="website">
<meta name="image" property="og:image" content="https://devonfw.com/images/devonfwwebsite.png">
<meta name="description" property="og:description" content="devonfw is the standard open source software development platform; Serving the full Software Delivery Life Cycle.">
<meta property="og:url" content="https://devonfw.com/index.html">

<meta name="twitter:title" content="devonfw website">
<meta name="twitter:description" content="devonfw is the standard open source software development platform; Serving the full Software Delivery Life Cycle.">
<meta name="twitter:image" content="https://devonfw.com/images/devonfwwebsite.png">
<meta name="twitter:card" content="summary_large_image">

<!-- ************************************* -->


<title>Mailer Module</title>
<!-- devonfw website stylesheet -->
<link rel="stylesheet" type="text/css" href="/devonfw.css">
<!-- Lunr -->
<script src="/website/assets/scripts/lunr.min.js"></script>
<!-- JQuery -->
<script src="/website/assets/scripts/jquery.min.js"></script>
<link rel="stylesheet" href="/website/assets/styles/font-awesome.min.css">
<link rel="stylesheet" href="/website/assets/styles/googlecode.min.css">
<script src="/website/assets/scripts/highlight.min.js"></script>
<script src="/website/assets/scripts/common.min.js"></script>
<script>hljs.initHighlightingOnLoad()</script>
<link rel="stylesheet" href="/website/assets/styles/bootstrap.min.css">

<script src="/website/assets/scripts/anchor.min.js"></script>

<script src="/website/components/header/search-engine/bundle.js"></script>

<script src="/website/shared/rightmenu.js"></script>

<!-- ************** Google analytics ************ -->
<script>
window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}

gtag('consent', 'default', {
  'analytics_storage': 'denied'
});
</script>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-151636804-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-151636804-1');
</script>
<script>
  function consentGranted() {
    gtag('consent', 'update', {
      'analytics_storage': 'granted'
    });
  }
</script>

<!-- ******************************************** -->


</head>
<body class="article">
<div id="website-navbar" class="website-navbar">
<button id="menu-button" class="menu-button">
  <img src="/images/menu-button.svg" width="32px" height="32px" alt=""/>
</button>

<ul>
<li>
<p><span class="image"><a class="image" href="/website/pages/welcome/welcome.html"><img alt="logo" src="/images/Logo_devonfw.svg"></a></span></p>
</li>
<li>
<p><a href="https://killercoda.com/devonfw">Tutorials</a></p>
</li>
<li>
<p><a href="/website/pages/solutions/index.html">Solutions</a></p>
</li>
<li>
<p><a href="/website/pages/docs/master.html">Docs</a></p>
</li>
</ul>

<form class="form-inline">
  <div class="search-bar">
    <input
      id="search-field"
      type="search"
      class="form-control mr-sm-2"
      placeholder="Search by keyword(s)..."
      aria-label="Search"
      style="height: auto;"
      autocomplete="off"/>
    <div class="sb-res-pos px-4">
      <div id="click-outside" class="click-outside z-50 hidden"></div>
      <div class="col rounded px-0 border z-100 bg-white hidden search-bar-results" id="search-results-box">
      </div>
    </div>
  </div>
</form>
<a class="navbar-github text-white" href="https://github.com/devonfw/">
  <img src="/images/github-mark.png" width=auto height=auto alt="">
</a></div>
<div id="sidebar" class="wiki-sidebar"></div>

<div id="content" class="mt-4 mt-sm-5">
<div class="toc2">
<div class="title">Table of Contents</div>
<ul class="sectlevel0">
<li><a href="#devonfw-guide_devon4ts.wiki_nest_guides-mailer.asciidoc">Mailer Module</a>
<ul class="sectlevel1">
<li><a href="#devonfw-guide_devon4ts.wiki_nest_guides-mailer.asciidoc_installing">Installing</a></li>
<li><a href="#devonfw-guide_devon4ts.wiki_nest_guides-mailer.asciidoc_configuring">Configuring</a>
<ul class="sectlevel2">
<li><a href="#devonfw-guide_devon4ts.wiki_nest_guides-mailer.asciidoc_forroot"><code>forRoot()</code></a></li>
<li><a href="#devonfw-guide_devon4ts.wiki_nest_guides-mailer.asciidoc_forrootasync"><code>forRootAsync()</code></a></li>
</ul>
</li>
<li><a href="#devonfw-guide_devon4ts.wiki_nest_guides-mailer.asciidoc_usage">Usage</a>
<ul class="sectlevel2">
<li><a href="#devonfw-guide_devon4ts.wiki_nest_guides-mailer.asciidoc_mailerservice-methods"><code>MailerService</code> methods</a></li>
</ul>
</li>
<li><a href="#devonfw-guide_devon4ts.wiki_nest_guides-mailer.asciidoc_handlebars-templates">Handlebars templates</a></li>
<li><a href="#devonfw-guide_devon4ts.wiki_nest_guides-mailer.asciidoc_local-development">Local development</a></li>
</ul>
</li>
</ul>
<h1 id="devonfw-guide_devon4ts.wiki_nest_guides-mailer.asciidoc" class="sect0">Mailer Module</h1>
<div class="paragraph">
<p>This module enables you to send emails in devon4node. It also provides a template engine using Handlebars.</p>
</div>
<div class="paragraph">
<p>It is a NestJS module that inject into your application a <code>MailerService</code>, which is the responsible to send the emails using the nodemailer library.</p>
</div>
<div class="sect1">
<h2 id="devonfw-guide_devon4ts.wiki_nest_guides-mailer.asciidoc_installing">Installing</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Execute the following command in a devon4node project:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="shell language-shell">yarn add @devon4node/mailer</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="devonfw-guide_devon4ts.wiki_nest_guides-mailer.asciidoc_configuring">Configuring</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To configure the mailer module, you only need to import it in your application into another module. Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="typescript language-typescript">@Module({
  ...
  imports: [
    MailerModule.forRoot(),
  ],
  ...
})</code></pre>
</div>
</div>
<div class="paragraph">
<p>Your must pass the configuration using the <code>forRoot</code> or <code>forRootAsync</code> methods.</p>
</div>
<div class="sect2">
<h3 id="devonfw-guide_devon4ts.wiki_nest_guides-mailer.asciidoc_forroot"><code>forRoot()</code></h3>
<div class="paragraph">
<p>The <code>forRoot</code> method receives an <code>MailerModuleOptions</code> object as parameter. It configures the <code>MailerModule</code> using the input <code>MailerModuleOptions</code> object.</p>
</div>
<div class="paragraph">
<p>The structure of <code>MailerModuleOptions</code> is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="typescript language-typescript">{
  hbsOptions?: {
    templatesDir: string;
    extension?: string;
    partialsDir?: string;
    helpers?: IHelperFunction[];
    compilerOptions?: ICompileOptions;
  },
  mailOptions?: nodemailerSmtpTransportOptions;
  emailFrom: string;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here, you need to specify the <a href="devonfw-guide/devon4ts.wiki/nest_https://handlebarsjs.com/api-reference/compilation.html#handlebars-compile-template-options">Handlebars compile options</a>, the <a href="#devonfw-guide/devon4ts.wiki/nest_https://nodemailer.com/smtp">nodemailer transport options</a> and the email address which will send the emails.
Then, you need to call to <code>forRoot</code> function in the module imports. Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="typescript language-typescript">@Module({
  ...
  imports: [
    MailerModule.forRoot({
      mailOptions: {
        host: 'localhost',
        port: 1025,
        secure: false,
        tls: {
          rejectUnauthorized: false,
        },
      },
      emailFrom: 'noreply@capgemini.com',
      hbsOptions: {
        templatesDir: join(__dirname, '../..', 'templates/views'),
        partialsDir: join(__dirname, '../..', 'templates/partials'),
        helpers: [{
          name: 'fullname',
          func: person =&gt; `${person.name} ${person.surname}`,s
        }],
      },
    }),
  ...
})</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="devonfw-guide_devon4ts.wiki_nest_guides-mailer.asciidoc_forrootasync"><code>forRootAsync()</code></h3>
<div class="paragraph">
<p>The method <code>forRootAsync</code> enables you to get the mailer configuration in a asynchronous way. It is useful when you need to get the configuration using, for example, a service (e.g. <code>ConfigurationService</code>).</p>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="typescript language-typescript">@Module({
  ...
  imports: [
    MailerModule.forRootAsync({
      imports: [ConfigurationModule],
      useFactory: (config: ConfigurationService) =&gt; {
        return config.mailerConfig;
      },
      inject: [ConfigurationService],
    }),
  ...
})</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this example, we use the <code>ConfigurationService</code> in order to get the <code>MailerModuleOptions</code> (the same as <code>forRoot</code>)</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="devonfw-guide_devon4ts.wiki_nest_guides-mailer.asciidoc_usage">Usage</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In order to use, you only need to inject using the dependency injection the <code>MailerService</code>.</p>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="typescript language-typescript">@Injectable()
export class CatsService {
  constructor(private readonly mailer: MailerService) {}
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then, you only need to use the methods provided by the <code>MailerService</code> in your service. Take into account that you can inject it in every place that support NestJS dependency injection.</p>
</div>
<div class="sect2">
<h3 id="devonfw-guide_devon4ts.wiki_nest_guides-mailer.asciidoc_mailerservice-methods"><code>MailerService</code> methods</h3>
<div class="sect3">
<h4 id="devonfw-guide_devon4ts.wiki_nest_guides-mailer.asciidoc_sendplainmail"><code>sendPlainMail</code></h4>
<div class="paragraph">
<p>The method <code>sendPlainMail</code> receive a string sends a email.</p>
</div>
<div class="paragraph">
<p>The method signatures are:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="typescript language-typescript">sendPlainMail(emailOptions: SendMailOptions): Promise&lt;SentMessageInfo&gt;;
sendPlainMail(to: string, subject: string, mail: string): Promise&lt;SentMessageInfo&gt;;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Examples:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="typescript language-typescript">this.mailer.sendPlainMail({
  to: 'example@example.com',
  subject: 'This is a subject',
  html: '&lt;h1&gt;Hello world&lt;/h1&gt;'
});
this.mailer.sendPlainMail('example@example.com', 'This is a subject', '&lt;h1&gt;Hello world&lt;/h1&gt;');</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="devonfw-guide_devon4ts.wiki_nest_guides-mailer.asciidoc_sendtemplatemail"><code>sendTemplateMail</code></h4>
<div class="paragraph">
<p>The method <code>sendTemplateMail</code> sends a email based on a Handlebars template. The templates are registered using the <code>templatesDir</code> option or using the <code>addTemplate</code> method.
The template name is the name of the template (without extension) or the first parameter of the method <code>addTemplate</code>.</p>
</div>
<div class="paragraph">
<p>The method signatures are:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="typescript language-typescript">sendTemplateMail(emailOptions: SendMailOptions, templateName: string, emailData: any, hbsOptions?: RuntimeOptions): Promise&lt;SentMessageInfo&gt;;
sendTemplateMail(to: string, subject: string, templateName: string, emailData: any, hbsOptions?: RuntimeOptions): Promise&lt;SentMessageInfo&gt;;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Examples:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="typescript language-typescript">this.mailer.sendTemplateMail({
  to: 'example@example.com',
  subject: 'This is a subject',
  html: '&lt;h1&gt;Hello world&lt;/h1&gt;'
}, 'template1', { person: {name: 'Dario', surname: 'Rodriguez'}});
this.mailer.sendTemplateMail('example@example.com', 'This is a subject', 'template1', { person: {name: 'Dario', surname: 'Rodriguez'}});</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="devonfw-guide_devon4ts.wiki_nest_guides-mailer.asciidoc_addtemplate"><code>addTemplate</code></h4>
<div class="paragraph">
<p>Adds a new template to the <code>MailerService</code>.</p>
</div>
<div class="paragraph">
<p>Method signature:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="typescript language-typescript">addTemplate(name: string, template: string, options?: CompileOptions): void;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="typescript language-typescript">this.mailer.addTemplate('newTemplate', '&lt;html&gt;&lt;head&gt;&lt;/head&gt;&lt;body&gt;{{&gt;partial1}}&lt;/body&gt;&lt;/html&gt;')</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="devonfw-guide_devon4ts.wiki_nest_guides-mailer.asciidoc_registerpartial"><code>registerPartial</code></h4>
<div class="paragraph">
<p>Register a new partial in Handlebars.</p>
</div>
<div class="paragraph">
<p>Method signature:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="typescript language-typescript">registerPartial(name: string, partial: Handlebars.Template&lt;any&gt;): void;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="typescript language-typescript">this.mailer.registerPartial('partial', '&lt;h1&gt;Hello World&lt;/h1&gt;')</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="devonfw-guide_devon4ts.wiki_nest_guides-mailer.asciidoc_registerhelper"><code>registerHelper</code></h4>
<div class="paragraph">
<p>Register a new helper in Handlebars.</p>
</div>
<div class="paragraph">
<p>Method signature:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="typescript language-typescript">registerHelper(name: string, helper: Handlebars.HelperDelegate): void;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="typescript language-typescript">this.mailer.registerHelper('fullname', person =&gt; `${person.name} ${person.surname}`)</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="devonfw-guide_devon4ts.wiki_nest_guides-mailer.asciidoc_handlebars-templates">Handlebars templates</h2>
<div class="sectionbody">
<div class="paragraph">
<p>As mentioned above, this module allow you to use Handlebars as template engine, but it is optional. If you do not need the Handlebars, you just need to keep the <code>hbsOptions</code> undefined.</p>
</div>
<div class="paragraph">
<p>In order to get the templates form the file system, you can specify the template folder, the partials folder and the helpers.
At the moment of module initialization, it will read the content of the template folder, and will register every file with the name (without extension) and the content as Handlebars template. It will do the same for the partials.</p>
</div>
<div class="paragraph">
<p>You can specify the extension of template files using the <code>extension</code> parameter. The default value is <code>.handlebars</code></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="devonfw-guide_devon4ts.wiki_nest_guides-mailer.asciidoc_local-development">Local development</h2>
<div class="sectionbody">
<div class="paragraph">
<p>If you want to work with this module but you don&#8217;t have a SMTP server, you can use the <code>streamTransport</code>. Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="typescript language-typescript">{
  mailOptions: {
    streamTransport: true,
    newline: 'windows',
  },
  emailFrom: ...
  hbsOptions: ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then, you need to get the <code>sendPlainMail</code> or <code>sendTemplateMail</code> result, and print the email to the standard output (<code>STDOUT</code>). Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="typescript language-typescript">const mail = await this.mailer.sendTemplateMail(...);

mail.message.pipe(process.stdout);</code></pre>
</div>
</div>
</div>
</div>
</div>
<div id="footer" class="footer">
<div class="openblock footerLinks">
<div class="content">
<div class="dlist linklist">
<dl>
<dt class="hdlist1">About</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><a href="/website/pages/welcome/welcome.html">About devonfw</a></p>
</li>
<li>
<p><a href="/website/pages/docs/devonfw-guide_getting-started.wiki_introduction-why-should-i-use-devonfw.asciidoc_features.html">Features</a></p>
</li>
<li>
<p><a href="/website/pages/docs/devonfw-guide_devon4j.wiki_architecture.asciidoc.html#devonfw-guide_devon4j.wiki_architecture.asciidoc_technology-stack">Technology Stack</a></p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div class="dlist linklist">
<dl>
<dt class="hdlist1">Explore</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><a href="/website/pages/docs/devonfw-guide_getting-started.wiki_getting-started.asciidoc.html">Getting started</a></p>
</li>
<li>
<p><a href="/website/pages/docs/devonfw-guide_devon4j.wiki_architecture.asciidoc.html">Architecture</a></p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div class="dlist linklist">
<dl>
<dt class="hdlist1">Docs</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><a href="/website/pages/docs/devonfw-guide_ide.wiki_devonfw-ide-introduction.asciidoc.html">User guide</a></p>
</li>
<li>
<p><a href="/website/pages/docs/devonfw-guide_general_master-release-notes.asciidoc.html">Releases information</a></p>
</li>
<li>
<p><a href="/website/pages/docs/master.html">Wiki</a></p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div class="dlist linklist">
<dl>
<dt class="hdlist1">Community</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/orgs/devonfw/people">Contributors</a></p>
</li>
<li>
<p><a href="https://github.com/devonfw/devonfw.github.io/blob/develop/README.asciidoc">Website Contribution</a></p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
</div>
<div class="ulist footerFooter">
<ul>
<li>
<p><a href="https://devonfw.com/website/pages/docs/devonfw-guide_ide.wiki_LICENSE.asciidoc.html">Terms of Use</a></p>
</li>
<li>
<p><a href="https://github.com/devonfw">Support</a></p>
</li>
</ul>
</div>
</div>
    <script>
      let bb = document.getElementById('menu-button');
      bb.addEventListener('click', function() {
        document.querySelector('.website-navbar ul').classList.toggle('visible');
        console.log(document.querySelector('.website-navbar ul'))
      })
    </script>
    <script type="module">
      import { EditLinksModule } from '/website/shared/editlinks.js';

      let alwaysVisible = true;
      if(document.location.pathname.endsWith("pages/welcome/welcome.html")) {
        alwaysVisible = false;
      }
      EditLinksModule.addEditLinks(alwaysVisible);
    </script>
    <script src="/website/assets/scripts/popper.min.js"></script>
    <script src="/website/assets/scripts/bootstrap.min.js"></script>
<div class="footnote"><sub>

Last updated 2022-06-29 08:21:58 UTC
</sub></div>
</div>
</div>
<link rel="stylesheet" type="text/css" href="https://cginternal.devonfw.com/websitesnippets/main.css">
<script async src="https://cginternal.devonfw.com/websitesnippets/main.js"></script>
<script>
  if(!document.location.pathname.endsWith("pages/welcome/welcome.html")) {
    anchors.options.visible = 'always';
  }
  anchors.add();
</script>
<script>
  var internalUrls = ["https://cginternal.devonfw.com/websitesnippets/"];
  $(".internal").each(function(){
    internalUrls.forEach((internalUrl, index) => {
      $.ajax({url: internalUrl + $(this).text() + "/index.html" })
      .then(r => {
        var leftDiv = $('<div class="info"><span class="infoText">Internal</span><img class="infoImage" src="' + internalUrl + 'logo.png"/></div>');
        var rightFirstDiv = $('<div class="message">This is only visible inside of the corporate network.</div>');
        var rightLastDiv = $('<div class="content"></div>');
        rightLastDiv.html(r);
        var rightDiv = $('<div class="right"></div>');
        rightDiv.append(rightFirstDiv);
        rightDiv.append(rightLastDiv);
        $(this).html(leftDiv);
        $(this).append(rightDiv);
        $(this).addClass("internal-active");
        $(this).removeClass("internal");
      })
    });
	});
</script>
<script>
      let cookieName = 'cookie_consent';
      let expiryTime = new Date(2037, 11, 21);
      let today = new Date();
      let cookieConsentDeclinedDate = localStorage.getItem("cookie_consent_declined");
      let dateDiffHours = 0;
      let cookieConsentHtml = `
      <div id="cookie-consent">
        <p>
          We use cookies to perform analytics and enhance user experience. Do you accept to the use of cookies?
        </p>
        <p class="cookie-consent-buttons">
          <a id="decline-cookie-btn" class="btn white-button" href="javascript:void(0)">Decline</a>
          <a id="accept-cookie-btn" class="btn blue-button" href="javascript:void(0)">Accept</a>
        </p>
      </div>
      `;
      dateDiffHours = cookieConsentDeclinedDate ? Math.abs(cookieConsentDeclinedDate - today) / 36e5 : 0;
      if (document.cookie.indexOf(cookieName) < 0) {
        if (cookieConsentDeclinedDate) {
          if (dateDiffHours > 24) {
            $("body").append(cookieConsentHtml);
          }
        } else {
          $("body").append(cookieConsentHtml);
        }
      }
      $("#accept-cookie-btn").click(function() {
        document.cookie = `${cookieName}=accept;expires=${expiryTime};path=/`;
        localStorage.removeItem("cookie_consent_declined");
        consentGranted();
        $("#cookie-consent").hide();
      });
      $("#decline-cookie-btn").click(function() {
        localStorage.setItem("cookie_consent_declined", today);
        $("#cookie-consent").hide();
      });
</script>
</body>
</html>