<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=">
<meta name="generator" content="Asciidoctor 1.5.8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- ******** SOCIAL MEDIA META ********** -->

<meta name="title" property="og:title" content="devonfw website">
<meta property="og:type" content="website">
<meta name="image" property="og:image" content="https://devonfw.com/images/devonfwwebsite.png">
<meta name="description" property="og:description" content="devonfw is the standard open source software development platform; Serving the full Software Delivery Life Cycle.">
<meta property="og:url" content="https://devonfw.com/index.html">

<meta name="twitter:title" content="devonfw website">
<meta name="twitter:description" content="devonfw is the standard open source software development platform; Serving the full Software Delivery Life Cycle.">
<meta name="twitter:image" content="https://devonfw.com/images/devonfwwebsite.png">
<meta name="twitter:card" content="summary_large_image">

<!-- ************************************* -->


<title>devon4node Architecture</title>
<!-- devonfw website stylesheet -->
<link rel="stylesheet" type="text/css" href="/devonfw.css">
<!-- Lunr -->
<script src="/website/assets/scripts/lunr.min.js"></script>
<!-- JQuery -->
<script src="/website/assets/scripts/jquery.min.js"></script>
<link rel="stylesheet" href="/website/assets/styles/font-awesome.min.css">
<link rel="stylesheet" href="/website/assets/styles/googlecode.min.css">
<script src="/website/assets/scripts/highlight.min.js"></script>
<script src="/website/assets/scripts/common.min.js"></script>
<script>hljs.initHighlightingOnLoad()</script>
<link rel="stylesheet" href="/website/assets/styles/bootstrap.min.css">

<script src="/website/assets/scripts/anchor.min.js"></script>

<script src="/website/components/header/search-engine/bundle.js"></script>

<script src="/website/shared/rightmenu.js"></script>

<!-- ************** Google analytics ************ -->
<script>
window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}

gtag('consent', 'default', {
  'analytics_storage': 'denied'
});
</script>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-151636804-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-151636804-1');
</script>
<script>
  function consentGranted() {
    gtag('consent', 'update', {
      'analytics_storage': 'granted'
    });
  }
</script>

<!-- ******************************************** -->


</head>
<body class="article">
<div id="website-navbar" class="website-navbar">
<button id="menu-button" class="menu-button">
  <img src="/images/menu-button.svg" width="32px" height="32px" alt=""/>
</button>

<ul>
<li>
<p><span class="image"><a class="image" href="/website/pages/welcome/welcome.html"><img alt="logo" src="/images/Logo_devonfw.svg"></a></span></p>
</li>
<li>
<p><a href="https://devonfw.com/website/pages/learning/">Tutorials</a></p>
</li>
<li>
<p><a href="/website/pages/solutions/index.html">Solutions</a></p>
</li>
<li>
<p><a href="/website/pages/docs/master.html">Docs</a></p>
</li>
</ul>

<form class="form-inline">
  <div class="search-bar">
    <input
      id="search-field"
      type="search"
      class="form-control mr-sm-2"
      placeholder="Search by keyword(s)..."
      aria-label="Search"
      style="height: auto;"
      autocomplete="off"/>
    <div class="sb-res-pos px-4">
      <div id="click-outside" class="click-outside z-50 hidden"></div>
      <div class="col rounded px-0 border z-100 bg-white hidden search-bar-results" id="search-results-box">
      </div>
    </div>
  </div>
</form>
<a class="navbar-github text-white" href="https://github.com/devonfw/">
  <img src="/images/github-mark.png" width=auto height=auto alt="">
</a></div>
<div id="sidebar" class="wiki-sidebar"></div>

<div id="content" class="mt-4 mt-sm-5">
<div class="toc2">
<div class="title">Table of Contents</div>
<ul class="sectlevel0">
<li><a href="#devonfw-guide_devon4ts.wiki_nest_devon4node-architecture.asciidoc">devon4node Architecture</a>
<ul class="sectlevel1">
<li><a href="#devonfw-guide_devon4ts.wiki_nest_devon4node-architecture.asciidoc_http-layer">HTTP layer</a></li>
<li><a href="#devonfw-guide_devon4ts.wiki_nest_devon4node-architecture.asciidoc_devon4node-layers">devon4node layers</a></li>
<li><a href="#devonfw-guide_devon4ts.wiki_nest_devon4node-architecture.asciidoc_devon4node-application-structure">devon4node application structure</a>
<ul class="sectlevel2">
<li><a href="#devonfw-guide_devon4ts.wiki_nest_devon4node-architecture.asciidoc_modules">Modules</a></li>
<li><a href="#devonfw-guide_devon4ts.wiki_nest_devon4node-architecture.asciidoc_folder-structure">Folder structure</a></li>
<li><a href="#devonfw-guide_devon4ts.wiki_nest_devon4node-architecture.asciidoc_nestjs-components">NestJS components</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<h1 id="devonfw-guide_devon4ts.wiki_nest_devon4node-architecture.asciidoc" class="sect0">devon4node Architecture</h1>
<div class="paragraph">
<p>As we have mentioned in the introduction, devon4node is based on <a href="#devonfw-guide/devon4ts.wiki/nest_https://nestjs.com/">NestJS</a>. Nest (NestJS) is a framework for building efficient, scalable Node.js server-side applications.</p>
</div>
<div class="sect1">
<h2 id="devonfw-guide_devon4ts.wiki_nest_devon4node-architecture.asciidoc_http-layer">HTTP layer</h2>
<div class="sectionbody">
<div class="paragraph">
<p>By using <a href="#devonfw-guide/devon4ts.wiki/nest_https://nestjs.com/">NestJS</a>, devon4node is a platform-agnostic framework. NestJS focuses only on the logical layer, and delegates the transport layer to another framework, such as ExpressJS. You can see it in the following diagram:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw.github.io/devonfw.github.io/target/generated-docs/images/devon4node-architecture.png" alt="devon4node architecture">
</div>
</div>
<div class="paragraph">
<p>As you can see, NestJS do not listen directly for incoming request. It has an adapter to communicate with ExpressJS and ExpressJS is the responsible for that. ExpressJS is only one of the frameworks that NestJS can work with. We have also another adapter available out-of-the-box: the <a href="#devonfw-guide/devon4ts.wiki/nest_https://www.fastify.io/">Fastify</a> adapter. With that, you can replace ExpressJS for Fastify But you can still use all your NestJS components. You can also create your own adapter to make NestJS work with other HTTP framework.</p>
</div>
<div class="paragraph">
<p>At this point, you may think: why is NestJS (and devon4node) using ExpressJS by default instead of Fastify? Because, as you can see in the previous diagram, there is a component that is dependent on the HTTP framework: the middleware. As ExpressJS is the most widely used framework, there exists a lot of middleware for it, so, in order to reuse them in our NestJS applications, NestJS use ExpressJS by default. Anyway, you may think which HTTP framework best fits your requirements.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="devonfw-guide_devon4ts.wiki_nest_devon4node-architecture.asciidoc_devon4node-layers">devon4node layers</h2>
<div class="sectionbody">
<div class="paragraph">
<p>As other devonfw technologies, devon4node separates the application into layers.</p>
</div>
<div class="paragraph">
<p>Those layers are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#devonfw-guide_devon4ts.wiki_nest_layer-controller.asciidoc">Controller layer</a></p>
</li>
<li>
<p><a href="#devonfw-guide_devon4ts.wiki_nest_layer-service.asciidoc">Service layer</a></p>
</li>
<li>
<p><a href="#devonfw-guide_devon4ts.wiki_nest_layer-dataaccess.asciidoc">Data Access layer</a></p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw.github.io/devonfw.github.io/target/generated-docs/images/plantuml/layers.png" alt="layers">
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="devonfw-guide_devon4ts.wiki_nest_devon4node-architecture.asciidoc_devon4node-application-structure">devon4node application structure</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Although there are many frameworks to create backend applications in NodeJS, none of them effectively solve the main problem of - Architecture. This is the main reason we have chosen NestJS for the devon4node applications. Besides, NestJS is highly inspired by <a href="#devonfw-guide/devon4ts.wiki/nest_https://angular.io/">Angular</a>, therefore a developer who knows Angular can use his already acquired knowledge to write devon4node applications.</p>
</div>
<div class="paragraph">
<p>NestJS adopts various Angular concepts, such as dependency injection, piping, interceptors and modularity, among others. By using modularity we can reuse some of our modules between applications. One example that devon4node provide is the <a href="#devonfw-guide_devon4ts.wiki_nest_guides-mailer.asciidoc">mailer module</a>.</p>
</div>
<div class="sect2">
<h3 id="devonfw-guide_devon4ts.wiki_nest_devon4node-architecture.asciidoc_modules">Modules</h3>
<div class="paragraph">
<p>Create a application module is simple, you only need to create an empty class with the decorator <code>Module</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="typescript language-typescript">@Module({})
export class AppModule {}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the module you can define:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Imports: the list of imported modules that export the providers which are required in this module</p>
</li>
<li>
<p>Controllers: the set of controllers defined in this module which have to be instantiated</p>
</li>
<li>
<p>Providers: the providers that will be instantiated by the Nest injector and that may be shared at least across this module</p>
</li>
<li>
<p>Exports: the subset of providers that are provided by this module and should be available in other modules which import this module</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The main difference between Angular and NestJS is NestJS modules encapsulates providers by default. This means that it&#8217;s impossible to inject providers that are neither directly part of the current module nor exported from the imported modules. Thus, you may consider the exported providers from a module as the module&#8217;s public interface, or API. Example of modules graph:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw.github.io/devonfw.github.io/target/generated-docs/images/plantuml/modules.png" alt="modules">
</div>
</div>
<div class="paragraph">
<p>In devon4node we three different kind of modules:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>AppModule</code>: this is the root module. Everything that our application need must be imported here.</p>
</li>
<li>
<p>Global Modules: this is a special kind of modules. When you make a module global, it&#8217;s accessible for every module in your application. Your can see it in the next diagram. It&#8217;s the same as the previous one, but now the <code>CoreModule</code> is global:</p>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw.github.io/devonfw.github.io/target/generated-docs/images/plantuml/module2.png" alt="module2">
</div>
</div>
<div class="paragraph">
<p>One example of global module is the <code>CoreModule</code>. In the <code>CoreModule</code> you must import every module which have providers that needs to be accessible in all modules of you application</p>
</div>
</li>
<li>
<p>Feature (or application) modules: modules which contains the logic of our application. We must import it in the <code>AppModule</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For more information about modules, see <a href="#devonfw-guide/devon4ts.wiki/nest_https://docs.nestjs.com/modules">NestJS documentation page</a></p>
</div>
</div>
<div class="sect2">
<h3 id="devonfw-guide_devon4ts.wiki_nest_devon4node-architecture.asciidoc_folder-structure">Folder structure</h3>
<div class="paragraph">
<p>devon4node defines a folder structure that every devon4node application must follow. The folder structure is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>├───src
│   ├───app
│   │   ├───core
│   │   │   ├───auth
│   │   │   ├───configuration
│   │   │   ├───user
│   │   │   └───core.module.ts
│   │   ├───shared
│   │   └───feature
│   │       ├───sub-module
│   │       │   ├───controllers
│   │       │   ├───...
│   │       │   ├───services
│   │       │   └───sub-module.module.ts
│   │       ├───controllers
│   │       ├───interceptors
│   │       ├───pipes
│   │       ├───guards
│   │       ├───filters
│   │       ├───middlewares
│   │       ├───model
│   │       │   ├───dto
│   │       │   └───entities
│   │       ├───services
│   │       └───feature.module.ts
│   ├───config
│   └───migration
├───test
└───package.json</pre>
</div>
</div>
<div class="paragraph">
<p><a href="#devonfw-guide_devon4ts.wiki_nest_guides-code-generation.asciidoc">devon4node schematics</a> ensures this folder structure so, please, do not create files by your own, use the <a href="#devonfw-guide_devon4ts.wiki_nest_guides-code-generation.asciidoc">devon4node schematics</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="devonfw-guide_devon4ts.wiki_nest_devon4node-architecture.asciidoc_nestjs-components">NestJS components</h3>
<div class="paragraph">
<p>NestJS provides several components that you can use in your application:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#devonfw-guide/devon4ts.wiki/nest_https://docs.nestjs.com/controllers">Controllers</a></p>
</li>
<li>
<p><a href="#devonfw-guide/devon4ts.wiki/nest_https://docs.nestjs.com/providers">Providers</a></p>
</li>
<li>
<p><a href="#devonfw-guide/devon4ts.wiki/nest_https://docs.nestjs.com/middleware">Middleware</a></p>
</li>
<li>
<p><a href="#devonfw-guide/devon4ts.wiki/nest_https://docs.nestjs.com/guards">Guards</a></p>
</li>
<li>
<p><a href="#devonfw-guide/devon4ts.wiki/nest_https://docs.nestjs.com/interceptors">Interceptors</a></p>
</li>
<li>
<p><a href="#devonfw-guide/devon4ts.wiki/nest_https://docs.nestjs.com/pipes">Pipes</a></p>
</li>
<li>
<p><a href="#devonfw-guide/devon4ts.wiki/nest_https://docs.nestjs.com/exception-filters">Exception filters</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In the <a href="#devonfw-guide/devon4ts.wiki/nest_https://docs.nestjs.com">NestJS documentation</a> you can find all information about each component. But, something that is missing in the documentation is the execution order. Every component can be defined in different levels: globally, in the controller or in the handler. As middleware is part of the HTTP server we can define it in a different way: globally or in the module.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw.github.io/devonfw.github.io/target/generated-docs/images/plantuml/components.png" alt="components">
</div>
</div>
<div class="paragraph">
<p>It is not necessary to have defined components in every level. For example, you can have defined a interceptor globally but you do not have any other in the controller or handler level. If nothing is defined in some level, the request will continue to the next component.</p>
</div>
<div class="paragraph">
<p>As you can see in the previous image, the first component which receive the request is the global defined middleware. Then, it send the request to the module middleware. Each of them can return a response to the client, without passing the request to the next level.</p>
</div>
<div class="paragraph">
<p>Then, the request continue to the guards: first the global guard, next to controller guard and finally to the handler guard. At this point, we can throw an exception in all components and the exception filter will catch it and send a proper error message to the client. We do not paint the filters in the graphic in order to simplify it.</p>
</div>
<div class="paragraph">
<p>After the guards, is time to interceptors: global interceptors, controller interceptors and handler interceptors. And last, before arrive to the handler inside the controller, the request pass through the pipes.</p>
</div>
<div class="paragraph">
<p>When the handler has the response ready to send to the client, it does not go directly to the client. It come again to the interceptors, so we can also intercept the response. The order this time is the reverse: handler interceptors, controller interceptors and global interceptors. After that, we can finally send the response to the client.</p>
</div>
<div class="paragraph">
<p>Now, with this in mind, you are able to create the components in a better way.</p>
</div>
</div>
</div>
</div>
</div>
<div id="footer" class="footer">
<div class="openblock footerLinks">
<div class="content">
<div class="dlist linklist">
<dl>
<dt class="hdlist1">About</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><a href="/website/pages/welcome/welcome.html">About devonfw</a></p>
</li>
<li>
<p><a href="/website/pages/docs/devonfw-guide_getting-started.wiki_introduction-why-should-i-use-devonfw.asciidoc_features.html">Features</a></p>
</li>
<li>
<p><a href="/website/pages/docs/devonfw-guide_devon4j.wiki_architecture.asciidoc.html#devonfw-guide_devon4j.wiki_architecture.asciidoc_technology-stack">Technology Stack</a></p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div class="dlist linklist">
<dl>
<dt class="hdlist1">Explore</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><a href="/website/pages/docs/devonfw-guide_getting-started.wiki_getting-started.asciidoc.html">Getting started</a></p>
</li>
<li>
<p><a href="/website/pages/docs/devonfw-guide_devon4j.wiki_architecture.asciidoc.html">Architecture</a></p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div class="dlist linklist">
<dl>
<dt class="hdlist1">Docs</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><a href="/website/pages/docs/devonfw-guide_ide.wiki_devonfw-ide-introduction.asciidoc.html">User guide</a></p>
</li>
<li>
<p><a href="/website/pages/docs/devonfw-guide_general_master-release-notes.asciidoc.html">Releases information</a></p>
</li>
<li>
<p><a href="/website/pages/docs/master.html">Wiki</a></p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div class="dlist linklist">
<dl>
<dt class="hdlist1">Community</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/orgs/devonfw/people">Contributors</a></p>
</li>
<li>
<p><a href="https://github.com/devonfw/devonfw.github.io/blob/develop/README.asciidoc">Website Contribution</a></p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
</div>
<div class="ulist footerFooter">
<ul>
<li>
<p><a href="https://devonfw.com/website/pages/docs/devonfw-guide_ide.wiki_LICENSE.asciidoc.html">Terms of Use</a></p>
</li>
<li>
<p><a href="https://github.com/devonfw">Support</a></p>
</li>
</ul>
</div>
</div>
    <script>
      let bb = document.getElementById('menu-button');
      bb.addEventListener('click', function() {
        document.querySelector('.website-navbar ul').classList.toggle('visible');
        console.log(document.querySelector('.website-navbar ul'))
      })
    </script>
    <script type="module">
      import { EditLinksModule } from '/website/shared/editlinks.js';

      let alwaysVisible = true;
      if(document.location.pathname.endsWith("pages/welcome/welcome.html")) {
        alwaysVisible = false;
      }
      EditLinksModule.addEditLinks(alwaysVisible);
    </script>
    <script src="/website/assets/scripts/popper.min.js"></script>
    <script src="/website/assets/scripts/bootstrap.min.js"></script>
<div class="footnote"><sub>

Last updated 2022-10-26 08:47:18 UTC
</sub></div>
</div>
</div>
<link rel="stylesheet" type="text/css" href="https://cginternal.devonfw.com/websitesnippets/main.css">
<script async src="https://cginternal.devonfw.com/websitesnippets/main.js"></script>
<script>
  if(!document.location.pathname.endsWith("pages/welcome/welcome.html")) {
    anchors.options.visible = 'always';
  }
  anchors.add();
</script>
<script>
  var internalUrls = ["https://cginternal.devonfw.com/websitesnippets/"];
  $(".internal").each(function(){
    internalUrls.forEach((internalUrl, index) => {
      $.ajax({url: internalUrl + $(this).text() + "/index.html" })
      .then(r => {
        var leftDiv = $('<div class="info"><span class="infoText">Internal</span><img class="infoImage" src="' + internalUrl + 'logo.png"/></div>');
        var rightFirstDiv = $('<div class="message">This is only visible inside of the corporate network.</div>');
        var rightLastDiv = $('<div class="content"></div>');
        rightLastDiv.html(r);
        var rightDiv = $('<div class="right"></div>');
        rightDiv.append(rightFirstDiv);
        rightDiv.append(rightLastDiv);
        $(this).html(leftDiv);
        $(this).append(rightDiv);
        $(this).addClass("internal-active");
        $(this).removeClass("internal");
      })
    });
	});
</script>
<script>
      let cookieName = 'cookie_consent';
      let expiryTime = new Date(2037, 11, 21);
      let today = new Date();
      let cookieConsentDeclinedDate = localStorage.getItem("cookie_consent_declined");
      let dateDiffHours = 0;
      let cookieConsentHtml = `
      <div id="cookie-consent">
        <p>
          We use cookies to perform analytics and enhance user experience. Do you accept to the use of cookies?
        </p>
        <p class="cookie-consent-buttons">
          <a id="decline-cookie-btn" class="btn white-button" href="javascript:void(0)">Decline</a>
          <a id="accept-cookie-btn" class="btn blue-button" href="javascript:void(0)">Accept</a>
        </p>
      </div>
      `;
      
      const parseCookie = str =>
        str
        .split(';')
        .map(v => v.split('='))
        .reduce((acc, v) => {
          acc[decodeURIComponent(v[0].trim())] = decodeURIComponent(v[1].trim());
          return acc;
        }, {});
      
      dateDiffHours = cookieConsentDeclinedDate ? Math.abs(cookieConsentDeclinedDate - today) / 36e5 : 0;
      if (document.cookie.indexOf(cookieName) < 0) {
        if (cookieConsentDeclinedDate) {
          if (dateDiffHours > 24) {
            $("body").append(cookieConsentHtml);
          }
        } else {
          $("body").append(cookieConsentHtml);
        }
      } else {
        cookies = parseCookie(document.cookie);
        if (cookies["cookie_consent"] == "accept") {
          consentGranted();
        }
      }
      
      $("#accept-cookie-btn").click(function() {
        document.cookie = `${cookieName}=accept;expires=${expiryTime};path=/`;
        localStorage.removeItem("cookie_consent_declined");
        consentGranted();
        $("#cookie-consent").hide();
      });
      $("#decline-cookie-btn").click(function() {
        localStorage.setItem("cookie_consent_declined", today);
        $("#cookie-consent").hide();
      });
</script>
</body>
</html>