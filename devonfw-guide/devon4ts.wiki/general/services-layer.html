<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=">
<meta name="generator" content="Asciidoctor 1.5.8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- ******** SOCIAL MEDIA META ********** -->

<meta name="title" property="og:title" content="devonfw website">
<meta property="og:type" content="website">
<meta name="image" property="og:image" content="https://devonfw.com/images/devonfwwebsite.png">
<meta name="description" property="og:description" content="devonfw is the standard open source software development platform; Serving the full Software Delivery Life Cycle.">
<meta property="og:url" content="https://devonfw.com/index.html">

<meta name="twitter:title" content="devonfw website">
<meta name="twitter:description" content="devonfw is the standard open source software development platform; Serving the full Software Delivery Life Cycle.">
<meta name="twitter:image" content="https://devonfw.com/images/devonfwwebsite.png">
<meta name="twitter:card" content="summary_large_image">

<!-- ************************************* -->


<title>Services Layer</title>
<!-- devonfw website stylesheet -->
<link rel="stylesheet" type="text/css" href="/devonfw.css">
<!-- Lunr -->
<script src="/website/assets/scripts/lunr.min.js"></script>
<!-- JQuery -->
<script src="/website/assets/scripts/jquery.min.js"></script>
<link rel="stylesheet" href="/website/assets/styles/font-awesome.min.css">
<link rel="stylesheet" href="/website/assets/styles/googlecode.min.css">
<script src="/website/assets/scripts/highlight.min.js"></script>
<script src="/website/assets/scripts/common.min.js"></script>
<script>hljs.initHighlightingOnLoad()</script>
<link rel="stylesheet" href="/website/assets/styles/bootstrap.min.css">

<script src="/website/assets/scripts/anchor.min.js"></script>

<script src="/website/components/header/search-engine/bundle.js"></script>

<script src="/website/shared/rightmenu.js"></script>

<!-- ************** Google analytics ************ -->
<script>
window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}

gtag('consent', 'default', {
  'analytics_storage': 'denied'
});
</script>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-151636804-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-151636804-1');
</script>
<script>
  function consentGranted() {
    gtag('consent', 'update', {
      'analytics_storage': 'granted'
    });
  }
</script>

<!-- ******************************************** -->


</head>
<body class="article">
<div id="website-navbar" class="website-navbar">
<button id="menu-button" class="menu-button">
  <img src="/images/menu-button.svg" width="32px" height="32px" alt=""/>
</button>

<ul>
<li>
<p><span class="image"><a class="image" href="https://devonfw.com/"><img alt="logo" src="/images/Logo_devonfw.svg"></a></span></p>
</li>
<li>
<p><a href="https://devonfw.com/website/pages/learning/">Tutorials</a></p>
</li>
<li>
<p><a href="/website/pages/solutions/index.html">Solutions</a></p>
</li>
<li>
<p><a href="/website/pages/docs/master.html">Docs</a></p>
</li>
</ul>

<form class="form-inline">
  <div class="search-bar">
    <input
      id="search-field"
      type="search"
      class="form-control mr-sm-2"
      placeholder="Search by keyword(s)..."
      aria-label="Search"
      style="height: auto;"
      autocomplete="off"/>
    <div class="sb-res-pos px-4">
      <div id="click-outside" class="click-outside z-50 hidden"></div>
      <div class="col rounded px-0 border z-100 bg-white hidden search-bar-results" id="search-results-box">
      </div>
    </div>
  </div>
</form>
<a class="navbar-github text-white" href="https://github.com/devonfw/">
  <img src="/images/github-mark.png" width=auto height=auto alt="">
</a></div>
<div id="sidebar" class="wiki-sidebar"></div>

<div id="content" class="mt-4 mt-sm-5">
<div class="toc2">
<div class="title">Table of Contents</div>
<ul class="sectlevel0">
<li><a href="#devonfw-guide_devon4ts.wiki_general_services-layer.asciidoc">Services Layer</a>
<ul class="sectlevel1">
<li><a href="#devonfw-guide_devon4ts.wiki_general_services-layer.asciidoc_boundaries">Boundaries</a></li>
<li><a href="#devonfw-guide_devon4ts.wiki_general_services-layer.asciidoc_store">Store</a></li>
<li><a href="#devonfw-guide_devon4ts.wiki_general_services-layer.asciidoc_use-case-service">Use Case Service</a></li>
<li><a href="#devonfw-guide_devon4ts.wiki_general_services-layer.asciidoc_adapter">Adapter</a></li>
<li><a href="#devonfw-guide_devon4ts.wiki_general_services-layer.asciidoc_interaction-of-smart-components-through-the-services-layer">Interaction of Smart Components through the services layer</a>
<ul class="sectlevel2">
<li><a href="#devonfw-guide_devon4ts.wiki_general_services-layer.asciidoc_pattern">Pattern</a></li>
<li><a href="#devonfw-guide_devon4ts.wiki_general_services-layer.asciidoc_example">Example</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<h1 id="devonfw-guide_devon4ts.wiki_general_services-layer.asciidoc" class="sect0">Services Layer</h1>
<div class="paragraph">
<p>The services layer is more or less what we call 'business logic layer' on the server side.
It is the layer where the business logic is placed.
The main challenges are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Define application state and an API for the components layer to use it</p>
</li>
<li>
<p>Handle application state transitions</p>
</li>
<li>
<p>Perform back-end interaction (XHR, WebSocket, etc.)</p>
</li>
<li>
<p>Handle business logic in a maintainable way</p>
</li>
<li>
<p>Configuration management</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>All parts of the services layer are described in this chapter.
An example which puts the concepts together can be found at the end <a href="#devonfw-guide_devon4ts.wiki_general_services-layer.asciidoc_interaction-of-smart-components-through-the-services-layer">Interaction of Smart Components through the services layer</a>.</p>
</div>
<div class="sect1">
<h2 id="devonfw-guide_devon4ts.wiki_general_services-layer.asciidoc_boundaries">Boundaries</h2>
<div class="sectionbody">
<div class="paragraph">
<p>There are two APIs for the components layer to interact with the services layer:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A store can be subscribed to for receiving state updates over time</p>
</li>
<li>
<p>A use case service can be called to trigger an action</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To illustrate the fact the following figure shows an abstract overview.</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="../images/components-layer-service-layer-boundaries.svg"><img src="/home/runner/work/devonfw.github.io/devonfw.github.io/target/images/components-layer-service-layer-boundaries.svg" alt="Smart and Dumb Components Interaction" width="450"></a>
</div>
<div class="title">Figure 1. Boundaries to components layer</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="devonfw-guide_devon4ts.wiki_general_services-layer.asciidoc_store">Store</h2>
<div class="sectionbody">
<div class="paragraph">
<p>A store is a class which defines and handles application state with its transitions over time.
Interaction with a store is always synchronous.
A basic implementation using RxJS can look like this.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="icon-tip" title=""></i>
</td>
<td class="content">
A more profound implementation taken from a real-life project can be found here (<a href="#devonfw-guide_devon4ts.wiki_general_cookbook-abstract-class-store.asciidoc">Abstract Class Store</a>).
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Listing 1. Store defined using RxJS</div>
<div class="content">
<pre class="highlight"><code class="ts language-ts">@Injectable()
export class ProductSearchStore {

  private stateSource = new BehaviorSubject&lt;ProductSearchState&gt;(defaultProductSearchState);
  state$ = this.stateSource.asObservable();

  setLoading(isLoading: boolean) {
    const currentState = this.stateSource.getValue();
    this.stateSource.next({
      isLoading: isLoading,
      products: currentState.products,
      searchCriteria: currentState.searchCriteria
    });
  }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the example <code>ProductSearchStore</code> handles state of type <code>ProductSearchState</code>.
The public API is the property <code>state$</code> which is an observable of type <code>ProductSearchState</code>.
The state can be changed with method calls.
So every desired change to the state needs to be modeled with an method.
In reactive terminology this would be an <em>Action</em>.
The store does not use any services.
Subscribing to the <code>state$</code> observable leads to the subscribers receiving every new state.</p>
</div>
<div class="paragraph">
<p>This is basically the <em>Observer Pattern</em>:<br>
The store consumer registers itself to the observable via <code>state$.subscribe()</code> method call.
The first parameter of <code>subscribe()</code> is a callback function to be called when the subject changes.
This way the consumer - the observer - is registered.
When next() is called with a new state inside the store, all callback functions are called with the new value.
So every observer is notified of the state change.
This equals the <em>Observer Pattern</em> push type.</p>
</div>
<div class="paragraph">
<p>A store is the API for <em>Smart Components</em> to receive state from the service layer.
State transitions are handled automatically with <em>Smart Components</em> registering to the <code>state$</code> observable.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="devonfw-guide_devon4ts.wiki_general_services-layer.asciidoc_use-case-service">Use Case Service</h2>
<div class="sectionbody">
<div class="paragraph">
<p>A use case service is a service which has methods to perform asynchronous state transitions.
In reactive terminology this would be an <em>Action of Actions</em> - a thunk (<code>redux</code>) or an effect (<code>@ngrx</code>).</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="../images/use-case-service.svg"><img src="/home/runner/work/devonfw.github.io/devonfw.github.io/target/images/use-case-service.svg" alt="Use Case Service" width="450"></a>
</div>
<div class="title">Figure 2. Use case services are the main API to trigger state transitions</div>
</div>
<div class="paragraph">
<p>A use case services method - an action - interacts with adapters, business services and stores.
So use case services orchestrate whole use cases.
For an example see <code><a href="#usecaseservice-example">use case service example</a></code>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="devonfw-guide_devon4ts.wiki_general_services-layer.asciidoc_adapter">Adapter</h2>
<div class="sectionbody">
<div class="paragraph">
<p>An adapter is used to communicate with the back-end.
This could be a simple XHR request, a WebSocket connection, etc.
An adapter is simple in the way that it does not add anything other than the pure network call.
So there is no caching or logging performed here.
The following listing shows an example.</p>
</div>
<div class="paragraph">
<p>For further information on back-end interaction see <a href="#devonfw-guide_devon4ts.wiki_general_guide-consuming-rest-services.asciidoc">Consuming REST Services</a></p>
</div>
<div class="listingblock">
<div class="title">Listing 2. Calling the back-end via an adapter</div>
<div class="content">
<pre class="highlight"><code class="ts language-ts">@Injectable()
export class ProducsAdapter {

  private baseUrl = environment.baseUrl;

  constructor(private http: HttpClient) { }

  getAll(): Observable&lt;Product[]&gt; {
    return this.http.get&lt;Product[]&gt;(this.baseUrl + '/products');
  }

}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="devonfw-guide_devon4ts.wiki_general_services-layer.asciidoc_interaction-of-smart-components-through-the-services-layer">Interaction of Smart Components through the services layer</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The interaction of smart components is a classic problem which has to be solved in every UI technology.
It is basically how one dialog tells the other something has changed.</p>
</div>
<div class="paragraph">
<p>An example is <em>adding an item to the shopping basket</em>.
With this action there need to be multiple state updates.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The small logo showing how many items are currently inside the basket needs to be updated from 0 to 1</p>
</li>
<li>
<p>The price needs to be recalculated</p>
</li>
<li>
<p>Shipping costs need to be checked</p>
</li>
<li>
<p>Discounts need to be updated</p>
</li>
<li>
<p>Ads need to be updated with related products</p>
</li>
<li>
<p>etc.</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="devonfw-guide_devon4ts.wiki_general_services-layer.asciidoc_pattern">Pattern</h3>
<div class="paragraph">
<p>To handle this interaction in a scalable way we apply the following pattern.</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="../images/smart-component-interaction-via-services-layer.svg"><img src="/home/runner/work/devonfw.github.io/devonfw.github.io/target/images/smart-component-interaction-via-services-layer.svg" alt="Interaction of Smart Components via services layer" width="450"></a>
</div>
<div class="title">Figure 3. Smart Component interaction</div>
</div>
<div class="paragraph">
<p>The state of interest is encapsulated inside a store. All <em>Smart Components</em> interested in the state have to subscribe to the store&#8217;s API served by the public observable. Thus, with every update to the store the subscribed components receive the new value. The components basically react to state changes. Altering a store can be done directly if the desired change is synchronous. Most actions are of asynchronous nature so the <code>UseCaseService</code> comes into play. Its actions are <code>void</code> methods, which implement a use case, i.e., adding a new item to the basket. It calls asynchronous actions and can perform multiple store updates over time.</p>
</div>
<div class="paragraph">
<p>To put this pattern into perspective the <code>UseCaseService</code> is a programmatic alternative to <code>redux-thunk</code> or <code>@ngrx/effects</code>. The main motivation here is to use the full power of TypeScript <code>--strictNullChecks</code> and to let the learning curve not to become as steep as it would be when learning a new state management framework. This way actions are just <code>void</code> method calls.</p>
</div>
</div>
<div class="sect2">
<h3 id="devonfw-guide_devon4ts.wiki_general_services-layer.asciidoc_example">Example</h3>
<div class="imageblock">
<div class="content">
<a class="image" href="../images/smart-smart-components-example.svg"><img src="/home/runner/work/devonfw.github.io/devonfw.github.io/target/images/smart-smart-components-example.svg" alt="Smart component interaction example" width="450"></a>
</div>
<div class="title">Figure 4. Smart Components interaction example</div>
</div>
<div class="paragraph">
<p>The example shows two <em>Smart Components</em> sharing the <code>FlightSearchState</code> by using the <code>FlightSearchStore</code>.
The use case shown is started by an event in the <em>Smart Component</em> <code>FlightSearchComponent</code>. The action <code>loadFlight()</code> is called. This could be submitting a search form.
The <code>UseCaseService</code> is <code>FlightSearchService</code>, which handles the use case <em>Load Flights</em>.</p>
</div>
<div class="paragraph">
<div class="title"><code>UseCaseService</code> example</div>
<p><code><a id="usecaseservice-example"></a></code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="ts language-ts">export class FlightSearchService {

  constructor(
    private flightSearchAdapter: FlightSearchAdapter,
    private store: FlightSearchStore
  ) { }

  loadFlights(criteria: FlightSearchCriteria): void {
    this.store.setLoadingFlights(true);
    this.store.clearFlights();

    this.flightSearchAdapter.getFlights(criteria.departureDate,
        {
          from: criteria.departureAirport,
          to: criteria.destinationAirport
        })
      .finally(() =&gt; this.store.setLoadingFlights(false))
      .subscribe((result: FlightTo[]) =&gt; this.store.setFlights(result, criteria));
  }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>First the loading flag is set to <code>true</code> and the current flights are cleared. This leads the <em>Smart Component</em> showing a spinner indicating the loading action. Then the asynchronous XHR is triggered by calling the adapter. After completion the loading flag is set to <code>false</code> causing the loading indication no longer to be shown. If the XHR was successful, the data would be put into the store. If the XHR was not successful, this would be the place to handle a custom error. All general network issues should be handled in a dedicated class, i.e., an interceptor. So for example the basic handling of 404 errors is not done here.</p>
</div>
</div>
</div>
</div>
</div>
<div id="footer" class="footer">
<div class="openblock footerLinks">
<div class="content">
<div class="dlist linklist">
<dl>
<dt class="hdlist1">About</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><a href="/website/pages/welcome/welcome.html">About devonfw</a></p>
</li>
<li>
<p><a href="/website/pages/docs/devonfw-guide_getting-started.wiki_introduction-why-should-i-use-devonfw.asciidoc_features.html">Features</a></p>
</li>
<li>
<p><a href="/website/pages/docs/devonfw-guide_devon4j.wiki_architecture.asciidoc.html#devonfw-guide_devon4j.wiki_architecture.asciidoc_technology-stack">Technology Stack</a></p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div class="dlist linklist">
<dl>
<dt class="hdlist1">Explore</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><a href="/website/pages/docs/devonfw-guide_getting-started.wiki_getting-started.asciidoc.html">Getting started</a></p>
</li>
<li>
<p><a href="/website/pages/docs/devonfw-guide_devon4j.wiki_architecture.asciidoc.html">Architecture</a></p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div class="dlist linklist">
<dl>
<dt class="hdlist1">Docs</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><a href="/website/pages/docs/devonfw-guide_ide.wiki_devonfw-ide-introduction.asciidoc.html">User guide</a></p>
</li>
<li>
<p><a href="/website/pages/docs/devonfw-guide_general_master-release-notes.asciidoc.html">Releases information</a></p>
</li>
<li>
<p><a href="/website/pages/docs/master.html">Wiki</a></p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div class="dlist linklist">
<dl>
<dt class="hdlist1">Community</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/orgs/devonfw/people">Contributors</a></p>
</li>
<li>
<p><a href="https://github.com/devonfw/devonfw.github.io/blob/develop/README.asciidoc">Website Contribution</a></p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
</div>
<div class="ulist footerFooter">
<ul>
<li>
<p><a href="https://devonfw.com/website/pages/docs/devonfw-guide_ide.wiki_LICENSE.asciidoc.html">Terms of Use</a></p>
</li>
<li>
<p><a href="https://github.com/devonfw">Support</a></p>
</li>
</ul>
</div>
</div>
    <script>
      let bb = document.getElementById('menu-button');
      bb.addEventListener('click', function() {
        document.querySelector('.website-navbar ul').classList.toggle('visible');
        console.log(document.querySelector('.website-navbar ul'))
      })
    </script>
    <script type="module">
      import { EditLinksModule } from '/website/shared/editlinks.js';

      let alwaysVisible = true;
      if(document.location.pathname.endsWith("pages/welcome/welcome.html")) {
        alwaysVisible = false;
      }
      EditLinksModule.addEditLinks(alwaysVisible);
    </script>
    <script src="/website/assets/scripts/popper.min.js"></script>
    <script src="/website/assets/scripts/bootstrap.min.js"></script>
<div class="footnote"><sub>

Last updated 2023-09-17 16:28:06 UTC
</sub></div>
</div>
</div>
<link rel="stylesheet" type="text/css" href="https://cginternal.devonfw.com/websitesnippets/main.css">
<script async src="https://cginternal.devonfw.com/websitesnippets/main.js"></script>
<script>
  if(!document.location.pathname.endsWith("pages/welcome/welcome.html")) {
    anchors.options.visible = 'always';
  }
  anchors.add();
</script>
<script>
  var internalUrls = ["https://cginternal.devonfw.com/websitesnippets/"];
  $(".internal").each(function(){
    internalUrls.forEach((internalUrl, index) => {
      $.ajax({url: internalUrl + $(this).text() + "/index.html" })
      .then(r => {
        var leftDiv = $('<div class="info"><span class="infoText">Internal</span><img class="infoImage" src="' + internalUrl + 'logo.png"/></div>');
        var rightFirstDiv = $('<div class="message">This is only visible inside of the corporate network.</div>');
        var rightLastDiv = $('<div class="content"></div>');
        rightLastDiv.html(r);
        var rightDiv = $('<div class="right"></div>');
        rightDiv.append(rightFirstDiv);
        rightDiv.append(rightLastDiv);
        $(this).html(leftDiv);
        $(this).append(rightDiv);
        $(this).addClass("internal-active");
        $(this).removeClass("internal");
      })
    });
	});
</script>
<script>
      let cookieName = 'cookie_consent';
      let expiryTime = new Date(2037, 11, 21);
      let today = new Date();
      let cookieConsentDeclinedDate = localStorage.getItem("cookie_consent_declined");
      let dateDiffHours = 0;
      let cookieConsentHtml = `
      <div id="cookie-consent">
        <p>
          We use cookies to perform analytics and enhance user experience. Do you accept to the use of cookies?
        </p>
        <p class="cookie-consent-buttons">
          <a id="decline-cookie-btn" class="btn white-button" href="javascript:void(0)">Decline</a>
          <a id="accept-cookie-btn" class="btn blue-button" href="javascript:void(0)">Accept</a>
        </p>
      </div>
      `;
      
      const parseCookie = str =>
        str
        .split(';')
        .map(v => v.split('='))
        .reduce((acc, v) => {
          acc[decodeURIComponent(v[0].trim())] = decodeURIComponent(v[1].trim());
          return acc;
        }, {});
      
      dateDiffHours = cookieConsentDeclinedDate ? Math.abs(cookieConsentDeclinedDate - today) / 36e5 : 0;
      if (document.cookie.indexOf(cookieName) < 0) {
        if (cookieConsentDeclinedDate) {
          if (dateDiffHours > 24) {
            $("body").append(cookieConsentHtml);
          }
        } else {
          $("body").append(cookieConsentHtml);
        }
      } else {
        cookies = parseCookie(document.cookie);
        if (cookies["cookie_consent"] == "accept") {
          consentGranted();
        }
      }
      
      $("#accept-cookie-btn").click(function() {
        document.cookie = `${cookieName}=accept;expires=${expiryTime};path=/`;
        localStorage.removeItem("cookie_consent_declined");
        consentGranted();
        $("#cookie-consent").hide();
      });
      $("#decline-cookie-btn").click(function() {
        localStorage.setItem("cookie_consent_declined", today);
        $("#cookie-consent").hide();
      });
</script>
</body>
</html>