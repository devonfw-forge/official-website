<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=">
<meta name="generator" content="Asciidoctor 1.5.8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- ******** SOCIAL MEDIA META ********** -->

<meta name="title" property="og:title" content="devonfw website">
<meta property="og:type" content="website">
<meta name="image" property="og:image" content="https://devonfw.com/images/devonfwwebsite.png">
<meta name="description" property="og:description" content="devonfw is the standard open source software development platform; Serving the full Software Delivery Life Cycle.">
<meta property="og:url" content="https://devonfw.com/index.html">

<meta name="twitter:title" content="devonfw website">
<meta name="twitter:description" content="devonfw is the standard open source software development platform; Serving the full Software Delivery Life Cycle.">
<meta name="twitter:image" content="https://devonfw.com/images/devonfwwebsite.png">
<meta name="twitter:card" content="summary_large_image">

<!-- ************************************* -->


<title>Service-Versioning</title>
<!-- devonfw website stylesheet -->
<link rel="stylesheet" type="text/css" href="/devonfw.css">
<!-- Lunr -->
<script src="/website/assets/scripts/lunr.min.js"></script>
<!-- JQuery -->
<script src="/website/assets/scripts/jquery.min.js"></script>
<link rel="stylesheet" href="/website/assets/styles/font-awesome.min.css">
<link rel="stylesheet" href="/website/assets/styles/googlecode.min.css">
<script src="/website/assets/scripts/highlight.min.js"></script>
<script src="/website/assets/scripts/common.min.js"></script>
<script>hljs.initHighlightingOnLoad()</script>
<link rel="stylesheet" href="/website/assets/styles/bootstrap.min.css">

<script src="/website/assets/scripts/anchor.min.js"></script>

<script src="/website/components/header/search-engine/bundle.js"></script>

<script src="/website/shared/rightmenu.js"></script>

<!-- ************** Google analytics ************ -->
<script>
window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}

gtag('consent', 'default', {
  'analytics_storage': 'denied'
});
</script>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-151636804-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-151636804-1');
</script>
<script>
  function consentGranted() {
    gtag('consent', 'update', {
      'analytics_storage': 'granted'
    });
  }
</script>

<!-- ******************************************** -->


</head>
<body class="article">
<div id="website-navbar" class="website-navbar">
<button id="menu-button" class="menu-button">
  <img src="/images/menu-button.svg" width="32px" height="32px" alt=""/>
</button>

<ul>
<li>
<p><span class="image"><a class="image" href="https://devonfw.com/"><img alt="logo" src="/images/Logo_devonfw.svg"></a></span></p>
</li>
<li>
<p><a href="https://devonfw.com/website/pages/learning/">Tutorials</a></p>
</li>
<li>
<p><a href="/website/pages/solutions/index.html">Solutions</a></p>
</li>
<li>
<p><a href="/website/pages/docs/master.html">Docs</a></p>
</li>
</ul>

<form class="form-inline">
  <div class="search-bar">
    <input
      id="search-field"
      type="search"
      class="form-control mr-sm-2"
      placeholder="Search by keyword(s)..."
      aria-label="Search"
      style="height: auto;"
      autocomplete="off"/>
    <div class="sb-res-pos px-4">
      <div id="click-outside" class="click-outside z-50 hidden"></div>
      <div class="col rounded px-0 border z-100 bg-white hidden search-bar-results" id="search-results-box">
      </div>
    </div>
  </div>
</form>
<a class="navbar-github text-white" href="https://github.com/devonfw/">
  <img src="/images/github-mark.png" width=auto height=auto alt="">
</a></div>
<div id="sidebar" class="wiki-sidebar"></div>

<div id="content" class="mt-4 mt-sm-5">
<div class="toc2">
<div class="title">Table of Contents</div>
<ul class="sectlevel0">
<li><a href="#devonfw-guide_devon4j.wiki_guide-service-versioning.asciidoc">Service-Versioning</a>
<ul class="sectlevel1">
<li><a href="#devonfw-guide_devon4j.wiki_guide-service-versioning.asciidoc_motivation">Motivation</a></li>
<li><a href="#devonfw-guide_devon4j.wiki_guide-service-versioning.asciidoc_procedure">Procedure</a></li>
<li><a href="#devonfw-guide_devon4j.wiki_guide-service-versioning.asciidoc_versioning-schema">Versioning Schema</a></li>
<li><a href="#devonfw-guide_devon4j.wiki_guide-service-versioning.asciidoc_practice">Practice</a>
<ul class="sectlevel2">
<li><a href="#devonfw-guide_devon4j.wiki_guide-service-versioning.asciidoc_modularization">Modularization</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="icon-warning" title=""></i>
</td>
<td class="content">
Hey there! Seems like you are still using the documentation of our legacy Java repository. Since it won&#8217;t be maintained anymore, we recommend you to checkout the new Java page <a href="https://devonfw.com/docs/java/current/">here</a>.
</td>
</tr>
</table>
</div>
<hr>
<h1 id="devonfw-guide_devon4j.wiki_guide-service-versioning.asciidoc" class="sect0">Service-Versioning</h1>
<div class="paragraph">
<p>This guide describes the aspect and details about versioning of <a href="#devonfw-guide_devon4j.wiki_guide-service-layer.asciidoc">services</a></p>
</div>
<div class="sect1">
<h2 id="devonfw-guide_devon4j.wiki_guide-service-versioning.asciidoc_motivation">Motivation</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Why versioning of services? First of all, you should only care about this topic if you really have to. Service versioning is complex and requires effort (time and budget). The best way to avoid this is to be smart in the first place when designing the service API.
Further, if you are creating services where the only consumer is e.g. the web-client that you deploy together with the consumed services then you can change your service without the overhead to create new service versions and keeping old service versions for compatibility.</p>
</div>
<div class="paragraph">
<p>However, if the following indicators are given you typically need to do service versioning:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Your service is part of a complex and distributed IT landscape</p>
</li>
<li>
<p>Your service requires incompatible changes</p>
</li>
<li>
<p>There are many consumers or there is at least one (relevant) consumer that can not be updated at the same time or is entirely out of control (unknown or totally different party/company)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>What are incompatible changes?</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Almost any change when <a href="#devonfw-guide_devon4j.wiki_guide-soap.asciidoc">SOAP</a> is used (as it changes the WSDL and breaks the contract). Therefore, we recommend to use <a href="#devonfw-guide_devon4j.wiki_guide-rest.asciidoc">REST</a> instead. Then, only the following changes are critical.</p>
</li>
<li>
<p>A change where existing properties (attributes) have to change their name</p>
</li>
<li>
<p>A change where existing features (properties, operations, etc.) have to change their semantics (meaning)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>What changes do not cause incompatibilities?</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Adding new service operations is entirely uncritical with <a href="#devonfw-guide_devon4j.wiki_guide-rest.asciidoc">REST</a>.</p>
</li>
<li>
<p>Adding new properties is only a problem in the following cases:</p>
<div class="ulist">
<ul>
<li>
<p>Adding new mandatory properties to the input of a service is causing incompatibilities. This problem can be avoided by contract-design.</p>
</li>
<li>
<p>If a consumer is using a service to read data, modify it and then save it back via a service and a property is added to the data, then this property might be lost. This is not a problem with dynamic languages such as JavaScript/TypeScript but with strictly typed languages such as Java. In Java you will typically use structured typed transfer-objects (and not <code>Map&lt;String, Object&gt;</code>) so new properties that have been added but are not known to the consumer can not be mapped to the transfer-object and will be lost. When saving that transfer-object later the property will be gone. It might be impossible to determine the difference between a lost property and a property that was removed on purpose. This is a general problem that you need to be aware of and that you have to consider by your design in such situations.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>Even if you hit an indicator for incompatible changes you can still think about adding a new service operation instead of changing an existing one (and deprecating the old one). Be creative to simplify and avoid extra effort.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="devonfw-guide_devon4j.wiki_guide-service-versioning.asciidoc_procedure">Procedure</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The procedure when rolling out incompatible changes is illustrated by the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>+------+  +------+
| App1 |  | App2 |
+---+--+  +--+---+
    |        |
    +---+----+
        |
+-------+--------+
|      Sv1       |
|                |
|      App3      |
+----------------+</code></pre>
</div>
</div>
<div class="paragraph">
<p>So, here we see a simple example where <code>App3</code> provides a Service <code>S</code> in Version <code>v1</code> that is consumed both by <code>App1</code> and <code>App2</code>.</p>
</div>
<div class="paragraph">
<p>Now for some reason the service <code>S</code> has to be changed in an incompatible way to make it future-proof for demands. However, upgrading all 3 applications at the same time is not possible in this case for whatever reason. Therefore, service versioning is applied for the changes of <code>S</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>+------+  +------+
| App1 |  | App2 |
+---+--+  +--+---+
    |        |
    +--------+
    |
+---+------------+
|  Sv1  |  Sv2   |
|                |
|      App3*     |
+----------------+</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now, <code>App3</code> has been upgraded and the new release was deployed. A new version <code>v2</code> of <code>S</code> has been added while <code>v1</code> is still kept for compatibility reasons and that version is still used by <code>App1</code> and <code>App2</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>+------+  +------+
| App1 |  | App2*|
+---+--+  +--+---+
    |        |
    |        |
    |        |
+---+--------+---+
|  Sv1  |  Sv2   |
|                |
|      App3      |
+----------------+</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now, <code>App2</code> has been updated and deployed and it is using the new version <code>v2</code> of <code>S</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>+------+  +------+
| App1*|  | App2 |
+---+--+  +--+---+
    |        |
    +--------+
             |
+------------+---+
|  Sv1  |  Sv2   |
|                |
|      App3      |
+----------------+</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now, also <code>App1</code> has been updated and deployed and it is using the new version <code>v2</code> of <code>S</code>. The version <code>v1</code> of <code>S</code> is not used anymore. This can be verified via logging and monitoring.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>+------+  +------+
| App1 |  | App2 |
+---+--+  +--+---+
    |        |
    +--------+
             |
+------------+---+
|          Sv2   |
|                |
|      App3*     |
+----------------+</code></pre>
</div>
</div>
<div class="paragraph">
<p>Finally, version <code>v1</code> of the service <code>S</code> was removed from <code>App3</code> and the new release has been deployed.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="devonfw-guide_devon4j.wiki_guide-service-versioning.asciidoc_versioning-schema">Versioning Schema</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In general anything can be used to differentiate versions of a service. Possibilities are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Code names (e.g. <code>Strawberry</code>, <code>Blueberry</code>, <code>Grapefruit</code>)</p>
</li>
<li>
<p>Timestamps (<code>YYYYMMDD-HHmmSS</code>)</p>
</li>
<li>
<p>Sequential version numbers (e.g. <code>v1</code>, <code>v2</code>, <code>v3</code>)</p>
</li>
<li>
<p>Composed version numbers (e.g. <code>1.0.48-pre-alpha-3-20171231-235959-Strawberry</code>)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>As we are following the KISS principle (see <a href="#devonfw-guide_devon4j.wiki_architecture.asciidoc_key-principles">key principles</a>) we propose to use sequential version numbers. These are short, clear, and easy while still allowing to see what version is after another one. Especially composed version numbers (even <code>1.1</code> vs. <code>2.0</code>) lead to decisions and discussions that easily waste more time than adding value. It is still very easy to maintain an Excel sheet or release-notes document that is explaining the changes for each version (<code>v1</code>, <code>v2</code>, <code>v3</code>) of a particular service.</p>
</div>
<div class="paragraph">
<p>We suggest to always add the version schema to the service URL to be prepared for service versioning even if service versioning is not (yet) actively used. For simplicity it is explicitly stated that you may even do incompatible changes to the current version (typically <code>v1</code>) of your service if you can update the according consumers within the same deployment.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="devonfw-guide_devon4j.wiki_guide-service-versioning.asciidoc_practice">Practice</h2>
<div class="sectionbody">
<div class="paragraph">
<p>So assuming you know that you have to do service versioning, the question is how to do it practically in the code.
The approach for your devon4j project in case of code-first should be as described below:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Determine which types in the code need to be changed. It is likely to be the API and implementation of the according service but it may also impact transfer objects and potentially even datatypes.</p>
</li>
<li>
<p>Create new packages for all these concerned types containing the current version number (e.g. <code>v1</code>).</p>
</li>
<li>
<p>Copy all these types to that new packages.</p>
</li>
<li>
<p>Rename these copies so they carry the version number as suffix (e.g. <code>V1</code>).</p>
</li>
<li>
<p>Increase the version of the service in the unversioned package (e.g. from <code>v1</code> to <code>v2</code>).</p>
</li>
<li>
<p>Now you have two versions of the same service (e.g. <code>v1</code> and <code>v2</code>) but so far they behave exactly the same.</p>
</li>
<li>
<p>You start with your actual changes and modify the original files that have been copied before.</p>
</li>
<li>
<p>You will also ensure the links (import statements) of the copied types point to the copies with the version number</p>
</li>
<li>
<p>This will cause incompatibilities (and compile errors) in the copied service. Therefore, you need to fix that service implementation to map from the old API to the new API and behavior. In some cases, this may be easy (e.g. mapping <code>x.y.z.v1.FooTo</code> to <code>x.y.z.FooTo</code> using <a href="#devonfw-guide_devon4j.wiki_guide-beanmapping.asciidoc">bean-mapping</a> with some custom mapping for the incompatible changes), in other cases this can get very complex. Be aware of this complexity from the start before you make your decision about service versioning.</p>
</li>
<li>
<p>As far as possible this mapping should be done in the service-layer, not to pollute your business code in the core-layer with versioning-aspects. If there is no way to handle it in the service layer, e.g. you need some data from the persistence-layer, implement the "mapping" in the core-layer then, but don&#8217;t forget to remove this code, when removing the old service version.</p>
</li>
<li>
<p>Finally, ensure that both the old service behaves as before as well as the new service works as planned.</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="devonfw-guide_devon4j.wiki_guide-service-versioning.asciidoc_modularization">Modularization</h3>
<div class="paragraph">
<p>For modularization, we also follow the KISS principle (see <a href="#devonfw-guide_devon4j.wiki_architecture.asciidoc_key-principles">key principles</a>):
we suggest to have one <code>api</code> module per application that will contain the most recent version of your service and get released with every release-version of the application. The compatibility code with the versioned packages will be added to the <code>core</code> module and therefore is not exposed via the <code>api</code> module (because it has already been exposed in the previous release of the app). This way, you can always determine for sure which version of a service is used by another application just by its maven dependencies.</p>
</div>
<div class="paragraph">
<p>The KISS approach with only a single module that may contain multiple services (e.g. one for each business component) will cause problems when you want to have mixed usages of service versions: You can not use an old version of one service and a new version of another service from the same APP as then you would need to have its API module twice as a dependency on different versions, which is not possible. However, to avoid complicated overhead we always suggest to follow this easy approach. Only if you come to the point that you really need this complexity you can still solve it (even afterwards by publishing another maven artefact). As we are all on our way to build more but smaller applications (SOA, microservices, etc.) we should always start simple and only add complexity when really needed.</p>
</div>
<div class="paragraph">
<p>The following example gives an idea of the structure:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>/«my-app»
├──/api
|  └──/src/main/java/
|     └──/«rootpackage»/«application»/«component»
|        ├──/common/api/to
|        |  └──FooTo
|        └──/service/api/rest
|           └──FooRestService
└──/core
   └──/src/main/java/
      └──«rootpackage»/«application»/«component»
         ├──/common/api/to/v1
         |  └──FooToV1
         └──/service
            ├──/api/rest/v1
            |  └──FooRestServiceV1
            └──impl/rest
               ├──/v1
               |  └── FooRestServiceImplV1
               └──FooRestServiceImpl</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div id="footer" class="footer">
<div class="openblock footerLinks">
<div class="content">
<div class="dlist linklist">
<dl>
<dt class="hdlist1">About</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><a href="/website/pages/welcome/welcome.html">About devonfw</a></p>
</li>
<li>
<p><a href="/website/pages/docs/devonfw-guide_getting-started.wiki_introduction-why-should-i-use-devonfw.asciidoc_features.html">Features</a></p>
</li>
<li>
<p><a href="/website/pages/docs/devonfw-guide_devon4j.wiki_architecture.asciidoc.html#devonfw-guide_devon4j.wiki_architecture.asciidoc_technology-stack">Technology Stack</a></p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div class="dlist linklist">
<dl>
<dt class="hdlist1">Explore</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><a href="/website/pages/docs/devonfw-guide_getting-started.wiki_getting-started.asciidoc.html">Getting started</a></p>
</li>
<li>
<p><a href="/website/pages/docs/devonfw-guide_devon4j.wiki_architecture.asciidoc.html">Architecture</a></p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div class="dlist linklist">
<dl>
<dt class="hdlist1">Docs</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><a href="/website/pages/docs/devonfw-guide_ide.wiki_devonfw-ide-introduction.asciidoc.html">User guide</a></p>
</li>
<li>
<p><a href="/website/pages/docs/devonfw-guide_general_master-release-notes.asciidoc.html">Releases information</a></p>
</li>
<li>
<p><a href="/website/pages/docs/master.html">Wiki</a></p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div class="dlist linklist">
<dl>
<dt class="hdlist1">Community</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/orgs/devonfw/people">Contributors</a></p>
</li>
<li>
<p><a href="https://github.com/devonfw/devonfw.github.io/blob/develop/README.asciidoc">Website Contribution</a></p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
</div>
<div class="ulist footerFooter">
<ul>
<li>
<p><a href="https://devonfw.com/website/pages/docs/devonfw-guide_ide.wiki_LICENSE.asciidoc.html">Terms of Use</a></p>
</li>
<li>
<p><a href="https://github.com/devonfw">Support</a></p>
</li>
</ul>
</div>
</div>
    <script>
      let bb = document.getElementById('menu-button');
      bb.addEventListener('click', function() {
        document.querySelector('.website-navbar ul').classList.toggle('visible');
        console.log(document.querySelector('.website-navbar ul'))
      })
    </script>
    <script type="module">
      import { EditLinksModule } from '/website/shared/editlinks.js';

      let alwaysVisible = true;
      if(document.location.pathname.endsWith("pages/welcome/welcome.html")) {
        alwaysVisible = false;
      }
      EditLinksModule.addEditLinks(alwaysVisible);
    </script>
    <script src="/website/assets/scripts/popper.min.js"></script>
    <script src="/website/assets/scripts/bootstrap.min.js"></script>
<div class="footnote"><sub>

Last updated 2022-11-22 09:56:39 UTC
</sub></div>
</div>
</div>
<link rel="stylesheet" type="text/css" href="https://cginternal.devonfw.com/websitesnippets/main.css">
<script async src="https://cginternal.devonfw.com/websitesnippets/main.js"></script>
<script>
  if(!document.location.pathname.endsWith("pages/welcome/welcome.html")) {
    anchors.options.visible = 'always';
  }
  anchors.add();
</script>
<script>
  var internalUrls = ["https://cginternal.devonfw.com/websitesnippets/"];
  $(".internal").each(function(){
    internalUrls.forEach((internalUrl, index) => {
      $.ajax({url: internalUrl + $(this).text() + "/index.html" })
      .then(r => {
        var leftDiv = $('<div class="info"><span class="infoText">Internal</span><img class="infoImage" src="' + internalUrl + 'logo.png"/></div>');
        var rightFirstDiv = $('<div class="message">This is only visible inside of the corporate network.</div>');
        var rightLastDiv = $('<div class="content"></div>');
        rightLastDiv.html(r);
        var rightDiv = $('<div class="right"></div>');
        rightDiv.append(rightFirstDiv);
        rightDiv.append(rightLastDiv);
        $(this).html(leftDiv);
        $(this).append(rightDiv);
        $(this).addClass("internal-active");
        $(this).removeClass("internal");
      })
    });
	});
</script>
<script>
      let cookieName = 'cookie_consent';
      let expiryTime = new Date(2037, 11, 21);
      let today = new Date();
      let cookieConsentDeclinedDate = localStorage.getItem("cookie_consent_declined");
      let dateDiffHours = 0;
      let cookieConsentHtml = `
      <div id="cookie-consent">
        <p>
          We use cookies to perform analytics and enhance user experience. Do you accept to the use of cookies?
        </p>
        <p class="cookie-consent-buttons">
          <a id="decline-cookie-btn" class="btn white-button" href="javascript:void(0)">Decline</a>
          <a id="accept-cookie-btn" class="btn blue-button" href="javascript:void(0)">Accept</a>
        </p>
      </div>
      `;
      
      const parseCookie = str =>
        str
        .split(';')
        .map(v => v.split('='))
        .reduce((acc, v) => {
          acc[decodeURIComponent(v[0].trim())] = decodeURIComponent(v[1].trim());
          return acc;
        }, {});
      
      dateDiffHours = cookieConsentDeclinedDate ? Math.abs(cookieConsentDeclinedDate - today) / 36e5 : 0;
      if (document.cookie.indexOf(cookieName) < 0) {
        if (cookieConsentDeclinedDate) {
          if (dateDiffHours > 24) {
            $("body").append(cookieConsentHtml);
          }
        } else {
          $("body").append(cookieConsentHtml);
        }
      } else {
        cookies = parseCookie(document.cookie);
        if (cookies["cookie_consent"] == "accept") {
          consentGranted();
        }
      }
      
      $("#accept-cookie-btn").click(function() {
        document.cookie = `${cookieName}=accept;expires=${expiryTime};path=/`;
        localStorage.removeItem("cookie_consent_declined");
        consentGranted();
        $("#cookie-consent").hide();
      });
      $("#decline-cookie-btn").click(function() {
        localStorage.setItem("cookie_consent_declined", today);
        $("#cookie-consent").hide();
      });
</script>
</body>
</html>