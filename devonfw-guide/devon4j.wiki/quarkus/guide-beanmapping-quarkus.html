<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=">
<meta name="generator" content="Asciidoctor 1.5.8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- ******** SOCIAL MEDIA META ********** -->

<meta name="title" property="og:title" content="devonfw website">
<meta property="og:type" content="website">
<meta name="image" property="og:image" content="https://devonfw.com/images/devonfwwebsite.png">
<meta name="description" property="og:description" content="devonfw is the standard open source software development platform; Serving the full Software Delivery Life Cycle.">
<meta property="og:url" content="https://devonfw.com/index.html">

<meta name="twitter:title" content="devonfw website">
<meta name="twitter:description" content="devonfw is the standard open source software development platform; Serving the full Software Delivery Life Cycle.">
<meta name="twitter:image" content="https://devonfw.com/images/devonfwwebsite.png">
<meta name="twitter:card" content="summary_large_image">

<!-- ************************************* -->


<title>Bean mapping with Quarkus</title>
<!-- devonfw website stylesheet -->
<link rel="stylesheet" type="text/css" href="/devonfw.css">
<!-- Lunr -->
<script src="/website/assets/scripts/lunr.min.js"></script>
<!-- JQuery -->
<script src="/website/assets/scripts/jquery.min.js"></script>
<link rel="stylesheet" href="/website/assets/styles/font-awesome.min.css">
<link rel="stylesheet" href="/website/assets/styles/googlecode.min.css">
<script src="/website/assets/scripts/highlight.min.js"></script>
<script src="/website/assets/scripts/common.min.js"></script>
<script>hljs.initHighlightingOnLoad()</script>
<link rel="stylesheet" href="/website/assets/styles/bootstrap.min.css">

<script src="/website/assets/scripts/anchor.min.js"></script>

<script src="/website/components/header/search-engine/bundle.js"></script>

<script src="/website/shared/rightmenu.js"></script>

<!-- ************** Google analytics ************ -->
<script>
window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}

gtag('consent', 'default', {
  'analytics_storage': 'denied'
});
</script>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-151636804-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-151636804-1');
</script>
<script>
  function consentGranted() {
    gtag('consent', 'update', {
      'analytics_storage': 'granted'
    });
  }
</script>

<!-- ******************************************** -->


</head>
<body class="article">
<div id="website-navbar" class="website-navbar">
<button id="menu-button" class="menu-button">
  <img src="/images/menu-button.svg" width="32px" height="32px" alt=""/>
</button>

<ul>
<li>
<p><span class="image"><a class="image" href="/website/pages/welcome/welcome.html"><img alt="logo" src="/images/Logo_devonfw.svg"></a></span></p>
</li>
<li>
<p><a href="https://devonfw.com/website/pages/learning/">Tutorials</a></p>
</li>
<li>
<p><a href="/website/pages/solutions/index.html">Solutions</a></p>
</li>
<li>
<p><a href="/website/pages/docs/master.html">Docs</a></p>
</li>
</ul>

<form class="form-inline">
  <div class="search-bar">
    <input
      id="search-field"
      type="search"
      class="form-control mr-sm-2"
      placeholder="Search by keyword(s)..."
      aria-label="Search"
      style="height: auto;"
      autocomplete="off"/>
    <div class="sb-res-pos px-4">
      <div id="click-outside" class="click-outside z-50 hidden"></div>
      <div class="col rounded px-0 border z-100 bg-white hidden search-bar-results" id="search-results-box">
      </div>
    </div>
  </div>
</form>
<a class="navbar-github text-white" href="https://github.com/devonfw/">
  <img src="/images/github-mark.png" width=auto height=auto alt="">
</a></div>
<div id="sidebar" class="wiki-sidebar"></div>

<div id="content" class="mt-4 mt-sm-5">
<div class="toc2">
<div class="title">Table of Contents</div>
<ul class="sectlevel0">
<li><a href="#devonfw-guide_devon4j.wiki_quarkus_guide-beanmapping-quarkus.asciidoc">Bean mapping with Quarkus</a>
<ul class="sectlevel1">
<li><a href="#devonfw-guide_devon4j.wiki_quarkus_guide-beanmapping-quarkus.asciidoc_mapstruct-dependency">MapStruct Dependency</a></li>
<li><a href="#devonfw-guide_devon4j.wiki_quarkus_guide-beanmapping-quarkus.asciidoc_mapstruct-configuration">MapStruct Configuration</a>
<ul class="sectlevel2">
<li><a href="#devonfw-guide_devon4j.wiki_quarkus_guide-beanmapping-quarkus.asciidoc_simple-configuration">Simple Configuration</a></li>
<li><a href="#devonfw-guide_devon4j.wiki_quarkus_guide-beanmapping-quarkus.asciidoc_mapperconfig-configuration">MapperConfig Configuration</a></li>
<li><a href="#devonfw-guide_devon4j.wiki_quarkus_guide-beanmapping-quarkus.asciidoc_configuration-via-annotation-processor-options">Configuration via annotation processor options</a></li>
</ul>
</li>
<li><a href="#devonfw-guide_devon4j.wiki_quarkus_guide-beanmapping-quarkus.asciidoc_basic-bean-mapper-usage">Basic Bean-Mapper Usage</a></li>
<li><a href="#devonfw-guide_devon4j.wiki_quarkus_guide-beanmapping-quarkus.asciidoc_advanced-bean-mapper-usage">Advanced Bean-Mapper Usage</a></li>
</ul>
</li>
</ul>
<h1 id="devonfw-guide_devon4j.wiki_quarkus_guide-beanmapping-quarkus.asciidoc" class="sect0">Bean mapping with Quarkus</h1>
<div class="paragraph">
<p>This guide will show bean-mapping, in particular for a Quarkus application. We recommend using <a href="https://mapstruct.org/">MapStruct</a> with a Quarkus application because the other bean-mapper frameworks use Java reflections. They are not supported in GraalVm right now and cause problems when building native applications. MapStruct is a code generator that greatly simplifies the implementation of mappings between Java bean types based on a convention over configuration approach. The mapping code will be generated at compile-time and uses plain method invocations and is thus fast, type-safe, and easy to understand. MapStruct has to be configured to not use Java reflections, which will be shown in this guide.</p>
</div>
<div class="paragraph">
<p>You can find the official
<a href="https://mapstruct.org/documentation/stable/reference/pdf/mapstruct-reference-guide.pdf">MapStruct reference guide</a> and a general introduction to MapStruct from <a href="https://www.baeldung.com/mapstruct">Baeldung</a>.</p>
</div>
<div class="sect1">
<h2 id="devonfw-guide_devon4j.wiki_quarkus_guide-beanmapping-quarkus.asciidoc_mapstruct-dependency">MapStruct Dependency</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To get access to MapStruct, we have to add the dependency to our POM.xml:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="xml language-xml">&lt;dependency&gt;
  &lt;groupId&gt;org.mapstruct&lt;/groupId&gt;
  &lt;artifactId&gt;mapstruct&lt;/artifactId&gt;
  &lt;version&gt;1.4.2.Final&lt;/version&gt;
  &lt;scope&gt;provided&lt;/scope&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>MapStruct provides an annotation processor that also has to be added to the POM.xml</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="xml language-xml">&lt;plugin&gt;
	&lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;
	&lt;artifactId&gt;maven-compiler-plugin&lt;/artifactId&gt;
	&lt;version&gt;3.8.1&lt;/version&gt;
	&lt;configuration&gt;
		&lt;source&gt;1.8&lt;/source&gt;
		&lt;target&gt;1.8&lt;/target&gt;
		&lt;annotationProcessorPaths&gt;
			&lt;path&gt;
				&lt;groupId&gt;org.mapstruct&lt;/groupId&gt;
				&lt;artifactId&gt;mapstruct-processor&lt;/artifactId&gt;
				&lt;version&gt;1.4.2.Final&lt;/version&gt;
			&lt;/path&gt;
		&lt;/path&gt;
		&lt;/annotationProcessorPaths&gt;
	&lt;/configuration&gt;
&lt;/plugin&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>MapStruct takes advantage of generated getters, setters, and constructors from the <a href="https://projectlombok.org/">Lombok</a> library, follow this <a href="#devonfw-guide/devon4j.wiki/quarkus_../guide-lombok.asciidoc.asciidoc_lombok-with-mapstruct">Lombok with Mapstruct guide</a> to get Lombok with Mapstruct working.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="devonfw-guide_devon4j.wiki_quarkus_guide-beanmapping-quarkus.asciidoc_mapstruct-configuration">MapStruct Configuration</h2>
<div class="sectionbody">
<div class="paragraph">
<p>We already discussed the benefits of <a href="https://github.com/devonfw/devon4j/blob/master/documentation/guide-dependency-injection.asciidoc#dependency-injection">dependency injection</a>. MapStruct supports CDI with EJB, spring, and jsr330. The default retrieving method for a mapper is a factory that uses reflections, which should be avoided. The component model should be set to CDI, as this will allow us to easily inject the generated mapper implementation. The component model can be configured in multiple ways.</p>
</div>
<div class="sect2">
<h3 id="devonfw-guide_devon4j.wiki_quarkus_guide-beanmapping-quarkus.asciidoc_simple-configuration">Simple Configuration</h3>
<div class="paragraph">
<p>Add the attribute <strong>componentModel</strong> to the <strong>@Mapper</strong> annotation in the mapper interface.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="java language-java">@Mapper(compnentModel = "cdi")
public interface ProductMapper{
  ...
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="devonfw-guide_devon4j.wiki_quarkus_guide-beanmapping-quarkus.asciidoc_mapperconfig-configuration">MapperConfig Configuration</h3>
<div class="paragraph">
<p>Create a shared configuration that can be used for multiple mappers. Implement an interface and use the annotation <strong>@MapperConfig</strong> for the class. You can define all configurations in this interface and pass the generated <code>MapperConfig.class</code> with the <strong>config</strong> attribute to the mapper. The <code>MapperConfig</code> also defines the <strong>InjectionStrategy</strong> and <strong>MappingInheritaceStrategy</strong>, both of which will be explained later.
A list of all configurations can be found <a href="https://mapstruct.org/documentation/stable/api/org/mapstruct/MapperConfig.html">here</a>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="java language-java">@MapperConfig(
  compnentModel = "cdi",
  mappingInheritanceStrategy = MappingInheritanceStrategy.AUTO_INHERIT_FROM_CONFIG
  injectionStrategy =InjectionStrategy.CONSTRUCTOR
)
public interface MapperConfig{
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="java language-java">@Mapper( config = MapperConfig.class )
public interface ProductMapper{
  ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Any attributes not given via <strong>@Mapper</strong> will be inherited from the shared configuration <code>MapperConfig.class</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="devonfw-guide_devon4j.wiki_quarkus_guide-beanmapping-quarkus.asciidoc_configuration-via-annotation-processor-options">Configuration via annotation processor options</h3>
<div class="paragraph">
<p>The MapStruct code generator can be configured using annotation processor options.
You can pass the options to the compiler while invoking javac directly, or add the parameters to the maven configuration in the POM.xml</p>
</div>
<div class="paragraph">
<p>We also use the constructor injection strategy to avoid field injections and potential reflections. This will also simplify our tests.</p>
</div>
<div class="paragraph">
<p>The option to pass the parameter to the annotation processor in the POM.xml is used and can be inspected in our <a href="https://github.com/devonfw-sample/devon4quarkus-reference/blob/master/pom.xml#L220-L228">quarkus reference project</a>.</p>
</div>
<div class="paragraph">
<p>A list of all annotation processor options can be found <a href="https://mapstruct.org/documentation/dev/reference/html/#configuration-options">here</a>.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="devonfw-guide_devon4j.wiki_quarkus_guide-beanmapping-quarkus.asciidoc_basic-bean-mapper-usage">Basic Bean-Mapper Usage</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To use the mapper, we have to implement the mapper interface and the function prototypes with a <strong>@Mapper</strong> annotation.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="java language-java">@Mapper
public interface ProductMapper {

  ProductDto map(ProductEntity model);

  ProductEntity create(NewProductDto dto);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The MapStruct annotation processor will generate the implementation for us under <code>/target/generated-sources/</code>, we just need to tell it that we would like to have a method that accepts a <code>ProductEntity</code> entity and returns a new <code>ProductDto</code> DTO.</p>
</div>
<div class="paragraph">
<p>The generated mapper implementation will be marked with the <strong>@ApplicationScoped</strong> annotation and can thus be injected into fields, constructor arguments, etc. using the <strong>@Inject</strong> annotation:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="java language-java">public class ProductRestService{

  @Inject
  ProductMapper mapper;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>That is the basic usage of a Mapstruct mapper. In the next chapter, we&#8217;ll go into a bit more detail and show some more configurations.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="devonfw-guide_devon4j.wiki_quarkus_guide-beanmapping-quarkus.asciidoc_advanced-bean-mapper-usage">Advanced Bean-Mapper Usage</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Let´s assume that our <code>Product</code> entity and the <code>ProductDto</code> have some differently named properties that should be mapped. Add a mapping annotation to map the property <strong>type</strong> from <code>Product</code> to <strong>kind</strong> from <code>ProductDto</code>. We define the source name of the property and the target name.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="java language-java">@Mapper
public interface ProductMapper {
  @Mapping(target = "kind", source = "type")
  ProductDto map(ProductEntity entity);

  @InheritInverseConfiguration(name = "map" )
  ProductEntity create(ProductDto dto);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>For bi-directional mappings, we can indicate that a method shall inherit the inverse configuration of the corresponding method with the <strong>@InheritInverseConfiguration</strong>. You can omit the name parameter if the result type of method A is the same as the
single-source type of method B and if the single-source type of A is the same as the result type of B. If multiple apply, the attribute name is needed. Specific mappings from the inverse method can (optionally) be overridden, ignored, or set to constants or expressions.</p>
</div>
<div class="paragraph">
<p>The mappingInheritanceStrategy can be defined as showed in <a href="#devonfw-guide_devon4j.wiki_quarkus_guide-beanmapping-quarkus.asciidoc_mapstruct-configuration">MapStruct Configuration</a>. The existing options can be found <a href="https://mapstruct.org/documentation/dev/reference/html/#shared-configurations">here</a>.</p>
</div>
<div class="paragraph">
<p>A mapped attribute does not always have the same type in the source and target objects. For instance, an attribute may be of type <code>int</code> in the source bean but of type <code>Long</code> in the target bean.</p>
</div>
<div class="paragraph">
<p>Another example are references to other objects which should be mapped to the corresponding types in the target model. E.g. the class <code>ShoppingCart</code> might have a property <strong>content</strong> of the type <code>Product</code> which needs to be converted into a <code>ProductDto</code> object when mapping a <code>ShoppingCart</code> object to <code>ShoppingCartDto</code>. For these cases, it&#8217;s useful to understand how Mapstruct <a href="https://mapstruct.org/documentation/dev/reference/html/#datatype-conversions">converts the data types</a> and the <a href="https://mapstruct.org/documentation/dev/reference/html/#mapping-object-references">object references</a>.</p>
</div>
<div class="paragraph">
<p>Also, the Chapter for <a href="https://mapstruct.org/documentation/dev/reference/html/#controlling-nested-bean-mappings">nested bean mappings</a> will help to configure MapStruct to map arbitrarily deep object graphs.</p>
</div>
<div class="paragraph">
<p>You can study running MapStruct implementation examples given by <a href="https://github.com/mapstruct/mapstruct-examples">MapStruct</a> or in our <a href="https://github.com/devonfw-sample/devon4quarkus-reference">Quarkus reference project</a></p>
</div>
</div>
</div>
</div>
<div id="footer" class="footer">
<div class="openblock footerLinks">
<div class="content">
<div class="dlist linklist">
<dl>
<dt class="hdlist1">About</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><a href="/website/pages/welcome/welcome.html">About devonfw</a></p>
</li>
<li>
<p><a href="/website/pages/docs/devonfw-guide_getting-started.wiki_introduction-why-should-i-use-devonfw.asciidoc_features.html">Features</a></p>
</li>
<li>
<p><a href="/website/pages/docs/devonfw-guide_devon4j.wiki_architecture.asciidoc.html#devonfw-guide_devon4j.wiki_architecture.asciidoc_technology-stack">Technology Stack</a></p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div class="dlist linklist">
<dl>
<dt class="hdlist1">Explore</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><a href="/website/pages/docs/devonfw-guide_getting-started.wiki_getting-started.asciidoc.html">Getting started</a></p>
</li>
<li>
<p><a href="/website/pages/docs/devonfw-guide_devon4j.wiki_architecture.asciidoc.html">Architecture</a></p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div class="dlist linklist">
<dl>
<dt class="hdlist1">Docs</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><a href="/website/pages/docs/devonfw-guide_ide.wiki_devonfw-ide-introduction.asciidoc.html">User guide</a></p>
</li>
<li>
<p><a href="/website/pages/docs/devonfw-guide_general_master-release-notes.asciidoc.html">Releases information</a></p>
</li>
<li>
<p><a href="/website/pages/docs/master.html">Wiki</a></p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div class="dlist linklist">
<dl>
<dt class="hdlist1">Community</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/orgs/devonfw/people">Contributors</a></p>
</li>
<li>
<p><a href="https://github.com/devonfw/devonfw.github.io/blob/develop/README.asciidoc">Website Contribution</a></p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
</div>
<div class="ulist footerFooter">
<ul>
<li>
<p><a href="https://devonfw.com/website/pages/docs/devonfw-guide_ide.wiki_LICENSE.asciidoc.html">Terms of Use</a></p>
</li>
<li>
<p><a href="https://github.com/devonfw">Support</a></p>
</li>
</ul>
</div>
</div>
    <script>
      let bb = document.getElementById('menu-button');
      bb.addEventListener('click', function() {
        document.querySelector('.website-navbar ul').classList.toggle('visible');
        console.log(document.querySelector('.website-navbar ul'))
      })
    </script>
    <script type="module">
      import { EditLinksModule } from '/website/shared/editlinks.js';

      let alwaysVisible = true;
      if(document.location.pathname.endsWith("pages/welcome/welcome.html")) {
        alwaysVisible = false;
      }
      EditLinksModule.addEditLinks(alwaysVisible);
    </script>
    <script src="/website/assets/scripts/popper.min.js"></script>
    <script src="/website/assets/scripts/bootstrap.min.js"></script>
<div class="footnote"><sub>

Last updated 2022-09-29 15:46:52 UTC
</sub></div>
</div>
</div>
<link rel="stylesheet" type="text/css" href="https://cginternal.devonfw.com/websitesnippets/main.css">
<script async src="https://cginternal.devonfw.com/websitesnippets/main.js"></script>
<script>
  if(!document.location.pathname.endsWith("pages/welcome/welcome.html")) {
    anchors.options.visible = 'always';
  }
  anchors.add();
</script>
<script>
  var internalUrls = ["https://cginternal.devonfw.com/websitesnippets/"];
  $(".internal").each(function(){
    internalUrls.forEach((internalUrl, index) => {
      $.ajax({url: internalUrl + $(this).text() + "/index.html" })
      .then(r => {
        var leftDiv = $('<div class="info"><span class="infoText">Internal</span><img class="infoImage" src="' + internalUrl + 'logo.png"/></div>');
        var rightFirstDiv = $('<div class="message">This is only visible inside of the corporate network.</div>');
        var rightLastDiv = $('<div class="content"></div>');
        rightLastDiv.html(r);
        var rightDiv = $('<div class="right"></div>');
        rightDiv.append(rightFirstDiv);
        rightDiv.append(rightLastDiv);
        $(this).html(leftDiv);
        $(this).append(rightDiv);
        $(this).addClass("internal-active");
        $(this).removeClass("internal");
      })
    });
	});
</script>
<script>
      let cookieName = 'cookie_consent';
      let expiryTime = new Date(2037, 11, 21);
      let today = new Date();
      let cookieConsentDeclinedDate = localStorage.getItem("cookie_consent_declined");
      let dateDiffHours = 0;
      let cookieConsentHtml = `
      <div id="cookie-consent">
        <p>
          We use cookies to perform analytics and enhance user experience. Do you accept to the use of cookies?
        </p>
        <p class="cookie-consent-buttons">
          <a id="decline-cookie-btn" class="btn white-button" href="javascript:void(0)">Decline</a>
          <a id="accept-cookie-btn" class="btn blue-button" href="javascript:void(0)">Accept</a>
        </p>
      </div>
      `;
      
      const parseCookie = str =>
        str
        .split(';')
        .map(v => v.split('='))
        .reduce((acc, v) => {
          acc[decodeURIComponent(v[0].trim())] = decodeURIComponent(v[1].trim());
          return acc;
        }, {});
      
      dateDiffHours = cookieConsentDeclinedDate ? Math.abs(cookieConsentDeclinedDate - today) / 36e5 : 0;
      if (document.cookie.indexOf(cookieName) < 0) {
        if (cookieConsentDeclinedDate) {
          if (dateDiffHours > 24) {
            $("body").append(cookieConsentHtml);
          }
        } else {
          $("body").append(cookieConsentHtml);
        }
      } else {
        cookies = parseCookie(document.cookie);
        if (cookies["cookie_consent"] == "accept") {
          consentGranted();
        }
      }
      
      $("#accept-cookie-btn").click(function() {
        document.cookie = `${cookieName}=accept;expires=${expiryTime};path=/`;
        localStorage.removeItem("cookie_consent_declined");
        consentGranted();
        $("#cookie-consent").hide();
      });
      $("#decline-cookie-btn").click(function() {
        localStorage.setItem("cookie_consent_declined", today);
        $("#cookie-consent").hide();
      });
</script>
</body>
</html>