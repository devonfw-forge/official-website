<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=">
<meta name="generator" content="Asciidoctor 1.5.8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- ******** SOCIAL MEDIA META ********** -->

<meta name="title" property="og:title" content="devonfw website">
<meta property="og:type" content="website">
<meta name="image" property="og:image" content="https://devonfw.com/images/devonfwwebsite.png">
<meta name="description" property="og:description" content="devonfw is the standard open source software development platform; Serving the full Software Delivery Life Cycle.">
<meta property="og:url" content="https://devonfw.com/index.html">

<meta name="twitter:title" content="devonfw website">
<meta name="twitter:description" content="devonfw is the standard open source software development platform; Serving the full Software Delivery Life Cycle.">
<meta name="twitter:image" content="https://devonfw.com/images/devonfwwebsite.png">
<meta name="twitter:card" content="summary_large_image">

<!-- ************************************* -->


<title>Testing e2e with Cypress</title>
<!-- devonfw website stylesheet -->
<link rel="stylesheet" type="text/css" href="/devonfw.css">
<!-- Lunr -->
<script src="/website/assets/scripts/lunr.min.js"></script>
<!-- JQuery -->
<script src="/website/assets/scripts/jquery.min.js"></script>
<link rel="stylesheet" href="/website/assets/styles/font-awesome.min.css">
<link rel="stylesheet" href="/website/assets/styles/googlecode.min.css">
<script src="/website/assets/scripts/highlight.min.js"></script>
<script src="/website/assets/scripts/common.min.js"></script>
<script>hljs.initHighlightingOnLoad()</script>
<link rel="stylesheet" href="/website/assets/styles/bootstrap.min.css">

<script src="/website/assets/scripts/anchor.min.js"></script>

<script src="/website/components/header/search-engine/bundle.js"></script>

<script src="/website/shared/rightmenu.js"></script>

<!-- ************** Google analytics ************ -->
<script>
window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}

gtag('consent', 'default', {
  'analytics_storage': 'denied'
});
</script>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-151636804-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-151636804-1');
</script>
<script>
  function consentGranted() {
    gtag('consent', 'update', {
      'analytics_storage': 'granted'
    });
  }
</script>

<!-- ******************************************** -->


</head>
<body class="article">
<div id="website-navbar" class="website-navbar">
<button id="menu-button" class="menu-button">
  <img src="/images/menu-button.svg" width="32px" height="32px" alt=""/>
</button>

<ul>
<li>
<p><span class="image"><a class="image" href="https://devonfw.com/"><img alt="logo" src="/images/Logo_devonfw.svg"></a></span></p>
</li>
<li>
<p><a href="https://devonfw.com/website/pages/learning/">Tutorials</a></p>
</li>
<li>
<p><a href="/website/pages/solutions/index.html">Solutions</a></p>
</li>
<li>
<p><a href="/website/pages/docs/master.html">Docs</a></p>
</li>
</ul>

<form class="form-inline">
  <div class="search-bar">
    <input
      id="search-field"
      type="search"
      class="form-control mr-sm-2"
      placeholder="Search by keyword(s)..."
      aria-label="Search"
      style="height: auto;"
      autocomplete="off"/>
    <div class="sb-res-pos px-4">
      <div id="click-outside" class="click-outside z-50 hidden"></div>
      <div class="col rounded px-0 border z-100 bg-white hidden search-bar-results" id="search-results-box">
      </div>
    </div>
  </div>
</form>
<a class="navbar-github text-white" href="https://github.com/devonfw/">
  <img src="/images/github-mark.png" width=auto height=auto alt="">
</a></div>
<div id="sidebar" class="wiki-sidebar"></div>

<div id="content" class="mt-4 mt-sm-5">
<div class="toc2">
<div class="title">Table of Contents</div>
<ul class="sectlevel0">
<li><a href="#devonfw-guide_devon4ng.wiki_guide-cypress.asciidoc">Testing e2e with Cypress</a>
<ul class="sectlevel1">
<li><a href="#devonfw-guide_devon4ng.wiki_guide-cypress.asciidoc_setup">Setup</a></li>
<li><a href="#devonfw-guide_devon4ng.wiki_guide-cypress.asciidoc_files--structure">Files / Structure</a></li>
<li><a href="#devonfw-guide_devon4ng.wiki_guide-cypress.asciidoc_tests">Tests</a></li>
<li><a href="#devonfw-guide_devon4ng.wiki_guide-cypress.asciidoc_fixtures">Fixtures</a></li>
<li><a href="#devonfw-guide_devon4ng.wiki_guide-cypress.asciidoc_request--route">Request / Route</a>
<ul class="sectlevel2">
<li><a href="#devonfw-guide_devon4ng.wiki_guide-cypress.asciidoc_route">Route</a></li>
<li><a href="#devonfw-guide_devon4ng.wiki_guide-cypress.asciidoc_request">Request</a></li>
</ul>
</li>
<li><a href="#devonfw-guide_devon4ng.wiki_guide-cypress.asciidoc_custom-commands">Custom commands</a></li>
<li><a href="#devonfw-guide_devon4ng.wiki_guide-cypress.asciidoc_cross-browser-testing">Cross browser testing</a></li>
<li><a href="#devonfw-guide_devon4ng.wiki_guide-cypress.asciidoc_viewport">Viewport</a></li>
<li><a href="#devonfw-guide_devon4ng.wiki_guide-cypress.asciidoc_test-retries">Test retries</a></li>
<li><a href="#devonfw-guide_devon4ng.wiki_guide-cypress.asciidoc_reporter">Reporter</a>
<ul class="sectlevel2">
<li><a href="#devonfw-guide_devon4ng.wiki_guide-cypress.asciidoc_mochawesome">Mochawesome</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<h1 id="devonfw-guide_devon4ng.wiki_guide-cypress.asciidoc" class="sect0">Testing e2e with Cypress</h1>
<div class="paragraph">
<p>This guide will cover the basics of e2e testing using Cypress.</p>
</div>
<div class="paragraph">
<p>Cypress is a framework “all in one” that provides the necessary libraries to write specific e2e tests, without the need of Selenium.</p>
</div>
<div class="paragraph">
<p>Why Cypress?</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Uses JavaScript</p>
</li>
<li>
<p>It works directly with the browser so the compatibility with the front-end framework the project uses (in this case Angular) is not a problem.</p>
</li>
<li>
<p>Easy cross browser testing</p>
</li>
</ul>
</div>
<div class="sect1">
<h2 id="devonfw-guide_devon4ng.wiki_guide-cypress.asciidoc_setup">Setup</h2>
<div class="sectionbody">
<div class="paragraph">
<p><strong>Install</strong>
First of all we need to install it, we can use <code>npm install</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="bash language-bash">$ npm install -D cypress</code></pre>
</div>
</div>
<div class="paragraph">
<p>Or we can install it with <code>yarn</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="bash language-bash">$ yarn add -D cypress</code></pre>
</div>
</div>
<div class="paragraph">
<p>We need to run Cypress in order to get the folder tree downloaded, then create a <code>tsconfig.json</code> file inside <code>cypress folder</code> to add the typescript configuration.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="bash language-bash">$ . /node_modules/.bin/cypress open</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Listing 1. <code>tsconfig.json</code></div>
<div class="content">
<pre class="highlight"><code class="json language-json">{
  "compilerOptions": {
    "strict": true,
    "baseUrl": "../node_modules",
    "target": "es5",
    "lib": ["es5", "dom"],
    "types": ["cypress"]
  },
  "include": [
    "**/*.ts"
  ]
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong><code>BaseUrl</code></strong></p>
</div>
<div class="paragraph">
<p>Let&#8217;s setup the base URL so when we run the tests cypress will "navigate" to the right place, go to <code>cypress.json</code> on the root of the project.</p>
</div>
<div class="listingblock">
<div class="title">Listing 2. cypress.json</div>
<div class="content">
<pre class="highlight"><code class="json language-json">{
  "baseUrl": "http://localhost:4200"
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="devonfw-guide_devon4ng.wiki_guide-cypress.asciidoc_files--structure">Files / Structure</h2>
<div class="sectionbody">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="TypeScript language-TypeScript">/cypress
  tsconfig.json
  /fixtures
    - example.json
  /integration
    - button.spec.ts
    - test.spec.ts
    /examples
  /plugins
    - index.js
  /support
    - commands.js
    - index.js</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>tsconfig.json</code> for typescript configuration.</p>
</div>
<div class="paragraph">
<p><code>fixtures</code> to store our mock data or files (images, mp3&#8230;&#8203;) to use on our tests.</p>
</div>
<div class="paragraph">
<p><code>integration</code> is where our tests go, by default it comes with an examples folder with tested samples.</p>
</div>
<div class="paragraph">
<p><code>plugins</code> is where the configuration files of the plugins go.</p>
</div>
<div class="paragraph">
<p><code>support</code> to add custom commands.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="icon-note" title=""></i>
</td>
<td class="content">
<div class="paragraph">
<p>If you are using Nx, it automatically generates a e2e cypress project for every project that you generate. So you already get the configuration files like <code>tsconfig.json</code> and <code>cypress.json</code> and also get the folder structure described above. This helps you focus more on writing your tests rather than setting up Cypress.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="devonfw-guide_devon4ng.wiki_guide-cypress.asciidoc_tests">Tests</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The structure is the same than Mocha.</p>
</div>
<div class="paragraph">
<p>First, we create a file, for example <code>form.spec.ts</code>, inside we define a context to group all our tests referred to the same subject.</p>
</div>
<div class="listingblock">
<div class="title">Listing 3. form.spec.ts</div>
<div class="content">
<pre class="highlight"><code class="TypeScript language-TypeScript">context('Button page', () =&gt; {
  beforeEach(() =&gt; {
    cy.visit('/');
  });
  it('should have button',()=&gt;{
    cy.get('button').should('exist');
  });
  it('should contain PRESS',()=&gt;{
    cy.contains('button', 'PRESS');
  });
});</code></pre>
</div>
</div>
<div class="paragraph">
<div class="title"><code>beforeEach</code></div>
<p>Visit '/' before every test.</p>
</div>
<div class="paragraph">
<div class="title">it</div>
<p>Inside we write the test.</p>
</div>
<div class="paragraph">
<p>The result:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw.github.io/devonfw.github.io/target/generated-docs/images/cypress/contextImg.jpg" alt="contextImg">
</div>
</div>
<div class="paragraph">
<p>For more info check <a href="#devonfw-guide/devon4ng.wiki_docs.cypress.io/guides/core-concepts/writing-and-organizing-tests.html.asciidoc_Folder-Structure">Cypress documentation</a></p>
</div>
<div class="paragraph">
<p>On <a href="#devonfw-guide/devon4ng.wiki_https://github.com/cypress-io/cypress-example-kitchensink">kitchensink</a>
you can find an official cypress demo with all the commands being used.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="devonfw-guide_devon4ng.wiki_guide-cypress.asciidoc_fixtures">Fixtures</h2>
<div class="sectionbody">
<div class="paragraph">
<p>We use fixtures to mock data, it can be a json, an image, video&#8230;&#8203;</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="json language-json">{
  "name": "Dummy name",
  "phone": 999 99 99 99,
  "body": "Mock data"
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can store multiple mocks on the same fixture file.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="json language-json">{
  "create":{"name": "e2etestBox"},
  "boxFruit":{
    "uuid":"3376339576e33dfb9145362426a33333",
    "name":"e2etestBox",
    "visibility":true,
    "items":[
      {"name":"apple","units":3},
      {"name":"kiwi","units":2},
    ]
  },
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>To access data we don&#8217;t need to import any file, we just call <code>cy.fixture(filename)</code> inside the <code>**.spec.ts</code>. We can name it as we want.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="TypeScript language-TypeScript">cy.fixture('box.json').as('fruitBox')</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>cy.fixture('box.json')</code> we get access to <code>box.json</code>
<code>.as(fruitBox)</code> is used to create an alias <code>(fruitBox)</code> to the fixture.</p>
</div>
<div class="paragraph">
<p>For more info check <a href="devonfw-guide/devon4ng.wiki_https://docs.cypress.io/api/commands/fixture.html#Syntax">Fixtures documentation</a></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="devonfw-guide_devon4ng.wiki_guide-cypress.asciidoc_request--route">Request / Route</h2>
<div class="sectionbody">
<div class="paragraph">
<p>With cypress you can test your application with real data or with mocks.</p>
</div>
<div class="paragraph">
<p>Not using mocks guarantees that your tests are real e2e test but makes them vulnerable to external issues.
When you mock data you don&#8217;t know exactly if the data and the structure received from the backend is correct because you are forcing a mock on the response, but you can avoid external issues, run test faster and have better control on the structure and status.</p>
</div>
<div class="paragraph">
<p>To get more information go to <a href="devonfw-guide/devon4ng.wiki_https://docs.cypress.io/guides/guides/network-requests.html#Testing-Strategies">Testing Strategies</a></p>
</div>
<div class="sect2">
<h3 id="devonfw-guide_devon4ng.wiki_guide-cypress.asciidoc_route">Route</h3>
<div class="paragraph">
<p>Cypress can intercept a XHR request and interact with it.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="TypeScript language-TypeScript">cy.server();
cy.route(
  'GET',
  '/apiUrl/list',
  [{"name":"apple", "units":3},{"name":"kiwi", "units":2}]
)</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>cy.server(options)</code> start a server to interact with the responses.</p>
</div>
<div class="ulist">
<div class="title"><code>cy.route(options)</code> intercepts a <code>XMLHttpRequests</code></div>
<ul>
<li>
<p>method <code>GET</code></p>
</li>
<li>
<p>URL <code>/apiUrl/list'</code></p>
</li>
<li>
<p>response <code>[{"name":"apple", "units":3},{"name":"kiwi", "units":2}]</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Waits</strong></p>
</div>
<div class="paragraph">
<p>Every cypress action has a default await time to avoid asynchronous issues, but this time can be short for some particular actions like API calls, for those cases we can use <code>cy.wait()</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="TypeScript language-TypeScript">cy.server();
cy.route('/apiUrl/list').as('list');
cy.visit('/boxList');
cy.wait('@list');</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can find more information about <code>cy.wait()</code> <a href="devonfw-guide/devon4ng.wiki_https://docs.cypress.io/guides/guides/network-requests.html#Waiting">here</a></p>
</div>
<div class="paragraph">
<p>To mock data with fixtures:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="TypeScript language-TypeScript">cy.fixture('box')
  .then(({boxFruit}) =&gt; {
    cy.route(
      'GET',
      '/apiUrl/list',
      boxFruit
    ).as('boxFruit');
    cy.get('#button').click();
    cy.wait('@journalsList');
    cy.get('#list').contains('apple');
  })</code></pre>
</div>
</div>
<div class="paragraph">
<p>We get <code>boxFruit</code> data from the box fixture and then we mock the API call with it so now the response of the call is <code>boxFruit</code> object.
When the button is clicked, it waits to receive the response of the call and then checks if the list contains one of the elements of the <code>fruitBox</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="devonfw-guide_devon4ng.wiki_guide-cypress.asciidoc_request">Request</h3>
<div class="paragraph">
<p>Make a HTTP request.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="TypeScript language-TypeScript">cy.server();
cy.request('http://localhost:4200/')
  .its('body')
  .should('include', '&lt;h1&gt;Welcome to Devon4ngAngularElementsTest!&lt;/h1&gt;');</code></pre>
</div>
</div>
<div class="paragraph">
<p>If we have <code>'http://localhost:4200'</code> as <code>baseUrl</code> on <code>cypress.json</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="TypeScript language-TypeScript">cy.server();
cy.request('/')
  .its('body')
  .should('include', '&lt;h1&gt;Welcome to Devon4ngAngularElementsTest!&lt;/h1&gt;');
// Goes to http://localhost:4200/</code></pre>
</div>
</div>
<div class="paragraph">
<p>We can add other options, like we can send the body of a form.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="TypeScript language-TypeScript">cy.server();
cy.request({
  method: 'POST',
  url: '/send',
  form: true,
  body: {
    name: 'name task',
    description: 'description of the task'
  }
});</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="devonfw-guide_devon4ng.wiki_guide-cypress.asciidoc_custom-commands">Custom commands</h2>
<div class="sectionbody">
<div class="paragraph">
<p>If you see yourself writing the same test more than once (login is a common one), you can create a custom command to make things faster.</p>
</div>
<div class="paragraph">
<p><code>Cypress.Commands.add('name', ()&#8658;{})</code> to create the test.</p>
</div>
<div class="listingblock">
<div class="title">Listing 4. commands.ts</div>
<div class="content">
<pre class="highlight"><code class="TypeScript language-TypeScript">Cypress.Commands.add('checkPlaceholder', (name) =&gt; {
  cy.get(`[name='${name}']`).click();
  cy.get('mat-form-field.mat-focused').should('exist');
});</code></pre>
</div>
</div>
<div class="paragraph">
<div class="title">index.ts</div>
<p>To use the commands we need to import the files on support/index.ts</p>
</div>
<div class="listingblock">
<div class="title">Listing 5. index.ts</div>
<div class="content">
<pre class="highlight"><code class="TypeScript language-TypeScript">import './commands'
import './file1'
import './folder/file2'</code></pre>
</div>
</div>
<div class="paragraph">
<p>index.ts is where all our custom commands files unite so Cypress knows where to find them.</p>
</div>
<div class="paragraph">
<p>And as we are using typescript we need to define a <code>namespace</code>, <code>interface</code> and define our function.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>index.d.ts</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>declare namespace Cypress {
  interface Chainable&lt;Subject&gt; {
    checkPlaceholder(name:string):Chainable&lt;void&gt;
  }
}</pre>
</div>
</div>
<div class="paragraph">
<p>Check <a href="devonfw-guide/devon4ng.wiki_https://docs.cypress.io/guides/tooling/typescript-support.html#Types-for-custom-commands">typescript custom commands</a></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="devonfw-guide_devon4ng.wiki_guide-cypress.asciidoc_cross-browser-testing">Cross browser testing</h2>
<div class="sectionbody">
<div class="paragraph">
<p>By default the browser used by Cypress is Chrome, it has compatibility with it&#8217;s family browsers (including Microsoft Edge) and has beta support for Mozilla Firefox.</p>
</div>
<div class="paragraph">
<p>To change the browser on the panel we can do it by selecting the desired one on the browsers tab before running the spec file.</p>
</div>
<div class="paragraph">
<p><code>Cypress will detect and display, except electron, only the browsers that you have already installed on your machine.</code></p>
</div>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw.github.io/devonfw.github.io/target/generated-docs/images/cypress/browserTab.jpg" alt="browserTab">
</div>
</div>
<div class="paragraph">
<p>Once the browser is selected, you can run your tests.</p>
</div>
<div class="paragraph">
<p>To change the browser on the automatic test run, you can add a flag on the node command</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="bash language-bash">cypress run --browser edge</code></pre>
</div>
</div>
<div class="paragraph">
<p>Only if we use the <code>cypress run</code> command.</p>
</div>
<div class="paragraph">
<p>Or we can change the script file.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>cypress/script.js</code></p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="javascript language-javascript">const runTests= async ()=&gt;{
  ...
  const {totalFailed} = await cypress.run({browser:'edge'});
  ...
};</code></pre>
</div>
</div>
<div class="paragraph">
<p><a href="https://docs.cypress.io/guides/guides/cross-browser-testing.html#Continuous-Integration-Strategies">Cypress documentation</a></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="devonfw-guide_devon4ng.wiki_guide-cypress.asciidoc_viewport">Viewport</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Cypress allow us to create tests depending on the Viewport, so we can test responsiveness.</p>
</div>
<div class="paragraph">
<p>There are different ways to use it:</p>
</div>
<div class="paragraph">
<p>Inside a test case</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="Typescript language-Typescript">it('should change title when viewport is less than 320px', ()=&gt;{
  cy.get('.title-l').should('be.visible');
  cy.get('.title-s').should('not.be.visible');
  cy.viewport(320, 480);
  cy.get('.title-l').should('not.be.visible');
  cy.get('.title-s').should('be.visible');
})</code></pre>
</div>
</div>
<div class="paragraph">
<p>Passing the configuration as an option</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="Typescript language-Typescript">describe('page display on medium size screen', {
  viewportHeight: 1000,
  viewportWidth: 400
}, () =&gt; {
  ...
})</code></pre>
</div>
</div>
<div class="paragraph">
<p>Or we can set a default</p>
</div>
<div class="ulist">
<ul>
<li>
<p>cypress.json</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>...
{
 "viewportHeight": 1000
 "viewportWidth": 400,
}
...</pre>
</div>
</div>
<div class="paragraph">
<p><a href="https://docs.cypress.io/api/commands/viewport.html#Syntax">Viewport documentation</a></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="devonfw-guide_devon4ng.wiki_guide-cypress.asciidoc_test-retries">Test retries</h2>
<div class="sectionbody">
<div class="paragraph">
<p>We can get false negatives intermittently due external issues that can affect our tests, because of that we can add, in the configuration, a retries entry so Cypress can run again a certain failed test the selected number of times to verify that the error is real.</p>
</div>
<div class="paragraph">
<p>We can set retries for run or open mode.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>cypress.json</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>...
"retries": {
    "runMode": 3,
    "openMode": 3
  }
...</pre>
</div>
</div>
<div class="paragraph">
<p>The retries can be configured on the <code>cypress.json</code> or directly on a specific test.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="Typescript language-Typescript">it('should get button', {
  retries: {
    runMode: 2,
    openMode: 2
  }
}, () =&gt; {
  ...
})</code></pre>
</div>
</div>
<div class="paragraph">
<p>This retries those not shown on the test log.</p>
</div>
<div class="paragraph">
<p>Check more on <a href="https://docs.cypress.io/guides/guides/test-retries.html#Introduction">retries documentation</a></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="devonfw-guide_devon4ng.wiki_guide-cypress.asciidoc_reporter">Reporter</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The tests results appear on the terminal, but to have a more friendly view we can add a reporter.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw.github.io/devonfw.github.io/target/generated-docs/images/cypress/reporter.jpg" alt="reporter">
</div>
</div>
<div class="sect2">
<h3 id="devonfw-guide_devon4ng.wiki_guide-cypress.asciidoc_mochawesome">Mochawesome</h3>
<div class="paragraph">
<p>In this case we are going to use Mochawesome, initially its a Mocha reporter but as Cypress uses Mocha it works the same.</p>
</div>
<div class="paragraph">
<p><strong>Install</strong></p>
</div>
<div class="paragraph">
<p>npm</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="bash language-bash">npm install --save-dev mochawesome</code></pre>
</div>
</div>
<div class="paragraph">
<p>yarn</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="bash language-bash">yarn add -D mochawesome</code></pre>
</div>
</div>
<div class="paragraph">
<p>To run the reporter:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="bash language-bash">cypress run --reporter mochawesome</code></pre>
</div>
</div>
<div class="paragraph">
<p>Mochawesome saves by default the generated files on <em>`./mochawesome-report/`</em> but we can add options to change this behavior.</p>
</div>
<div class="paragraph">
<p>Options can be passed to the reporter in two ways</p>
</div>
<div class="paragraph">
<p>Using a flag</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="bash language-bash">cypress run --reporter mochawesome --reporter-options reportDir=report</code></pre>
</div>
</div>
<div class="paragraph">
<p>Or on <em>cypress.json</em></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="json language-json">{
  "baseUrl": "http://localhost:4200",
  "reporter": "mochawesome",
  "reporterOptions": {
    "overwrite": false,
    "html": false,
    "json": true,
    "reportDir": "cypress/report"
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>Overwrite:false</code> to not overwrite every **:spec.ts test report, we want them to create a merged version later.</p>
</div>
<div class="paragraph">
<p><code>reportDir</code> to set a custom directory.</p>
</div>
<div class="paragraph">
<p><code>html:false</code> because we don&#8217;t need it.</p>
</div>
<div class="paragraph">
<p><code>json:true</code> to save them on json.</p>
</div>
<div class="paragraph">
<p>Mochawesome only creates the html file of the last .spec.ts file that the tests run, that&#8217;s why we don&#8217;t generate html reports directly, in order to stack them all on the same final html we need to merge the reports.</p>
</div>
<div class="paragraph">
<p>Check the <a href="#devonfw-guide/devon4ng.wiki_https://www.npmjs.com/package/mochawesome-report-generator">mochawesome documentation</a></p>
</div>
<div class="paragraph">
<p><strong><code>mochawesome-merge</code></strong></p>
</div>
<div class="paragraph">
<p><code>Mochawesome-merge</code> is a library that helps us to merge the different json.</p>
</div>
<div class="paragraph">
<p>npm</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="bash language-bash">npm install --save-dev mochawesome-merge
npm install --save-dev mochawesome-report-generator</code></pre>
</div>
</div>
<div class="paragraph">
<p>yarn</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="bash language-bash">yarn add -D mochawesome-merge
yarn add -D mochawesome-report-generator</code></pre>
</div>
</div>
<div class="paragraph">
<p>To merge the files we execute this command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="bash language-bash">mochawesome-merge cypress/report/*.json &gt; cypress/reportFinal.json</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>reportFinal.json</code> is the result of this merge, whit that we have the data of all the spec files in one json.</p>
</div>
<div class="paragraph">
<p>We can also automate the test, merge and conversion to html using a script.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="TypeScript language-TypeScript">const cypress = require('cypress');
const fse = require('fs-extra');
const { merge } = require('mochawesome-merge');
const generator = require('mochawesome-report-generator');
const runTests= async ()=&gt;{
  await fse.remove('mochawesome-report');
  await fse.remove('cypress/report');
  const {totalFailed} = await cypress.run();
  const reporterOptions = {
    files: ["cypress/report/*.json"]
  };
  await generateReport(reporterOptions);
  if(totalFailed !== 0){
    process.exit(2);
  };
};
const generateReport = (options)=&gt; {
  return merge(options).then((jsonReport)=&gt;{
    generator.create(jsonReport).then(()=&gt;{
      process.exit();
    });
  });
};
runTests();</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>fse.remove()</code> to remove older reports data.</p>
</div>
<div class="paragraph">
<p><code>cypress.run()</code> to run the tests.</p>
</div>
<div class="paragraph">
<p><code>merge(options)</code> we merge the <code>json</code> output from running the tests.</p>
</div>
<div class="paragraph">
<p><code>generator.create(jsonReport)</code> then we generate the html view of the report.</p>
</div>
<div class="paragraph">
<p>Check the <a href="#devonfw-guide/devon4ng.wiki_https://www.npmjs.com/package/mochawesome-merge"><code>mochawesome-merge</code> documentation</a></p>
</div>
<div class="paragraph">
<p>On <a href="#devonfw-guide/devon4ng.wiki_https://github.com/cypress-io/cypress-example-kitchensink">kitchensink</a>
you can find an official cypress demo with all the commands being used.</p>
</div>
</div>
</div>
</div>
</div>
<div id="footer" class="footer">
<div class="openblock footerLinks">
<div class="content">
<div class="dlist linklist">
<dl>
<dt class="hdlist1">About</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><a href="/website/pages/welcome/welcome.html">About devonfw</a></p>
</li>
<li>
<p><a href="/website/pages/docs/devonfw-guide_getting-started.wiki_introduction-why-should-i-use-devonfw.asciidoc_features.html">Features</a></p>
</li>
<li>
<p><a href="/website/pages/docs/devonfw-guide_devon4j.wiki_architecture.asciidoc.html#devonfw-guide_devon4j.wiki_architecture.asciidoc_technology-stack">Technology Stack</a></p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div class="dlist linklist">
<dl>
<dt class="hdlist1">Explore</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><a href="/website/pages/docs/devonfw-guide_getting-started.wiki_getting-started.asciidoc.html">Getting started</a></p>
</li>
<li>
<p><a href="/website/pages/docs/devonfw-guide_devon4j.wiki_architecture.asciidoc.html">Architecture</a></p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div class="dlist linklist">
<dl>
<dt class="hdlist1">Docs</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><a href="/website/pages/docs/devonfw-guide_ide.wiki_devonfw-ide-introduction.asciidoc.html">User guide</a></p>
</li>
<li>
<p><a href="/website/pages/docs/devonfw-guide_general_master-release-notes.asciidoc.html">Releases information</a></p>
</li>
<li>
<p><a href="/website/pages/docs/master.html">Wiki</a></p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div class="dlist linklist">
<dl>
<dt class="hdlist1">Community</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/orgs/devonfw/people">Contributors</a></p>
</li>
<li>
<p><a href="https://github.com/devonfw/devonfw.github.io/blob/develop/README.asciidoc">Website Contribution</a></p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
</div>
<div class="ulist footerFooter">
<ul>
<li>
<p><a href="https://devonfw.com/website/pages/docs/devonfw-guide_ide.wiki_LICENSE.asciidoc.html">Terms of Use</a></p>
</li>
<li>
<p><a href="https://github.com/devonfw">Support</a></p>
</li>
</ul>
</div>
</div>
    <script>
      let bb = document.getElementById('menu-button');
      bb.addEventListener('click', function() {
        document.querySelector('.website-navbar ul').classList.toggle('visible');
        console.log(document.querySelector('.website-navbar ul'))
      })
    </script>
    <script type="module">
      import { EditLinksModule } from '/website/shared/editlinks.js';

      let alwaysVisible = true;
      if(document.location.pathname.endsWith("pages/welcome/welcome.html")) {
        alwaysVisible = false;
      }
      EditLinksModule.addEditLinks(alwaysVisible);
    </script>
    <script src="/website/assets/scripts/popper.min.js"></script>
    <script src="/website/assets/scripts/bootstrap.min.js"></script>
<div class="footnote"><sub>

Last updated 2023-11-07 11:01:32 UTC
</sub></div>
</div>
</div>
<link rel="stylesheet" type="text/css" href="https://cginternal.devonfw.com/websitesnippets/main.css">
<script async src="https://cginternal.devonfw.com/websitesnippets/main.js"></script>
<script>
  if(!document.location.pathname.endsWith("pages/welcome/welcome.html")) {
    anchors.options.visible = 'always';
  }
  anchors.add();
</script>
<script>
  var internalUrls = ["https://cginternal.devonfw.com/websitesnippets/"];
  $(".internal").each(function(){
    internalUrls.forEach((internalUrl, index) => {
      $.ajax({url: internalUrl + $(this).text() + "/index.html" })
      .then(r => {
        var leftDiv = $('<div class="info"><span class="infoText">Internal</span><img class="infoImage" src="' + internalUrl + 'logo.png"/></div>');
        var rightFirstDiv = $('<div class="message">This is only visible inside of the corporate network.</div>');
        var rightLastDiv = $('<div class="content"></div>');
        rightLastDiv.html(r);
        var rightDiv = $('<div class="right"></div>');
        rightDiv.append(rightFirstDiv);
        rightDiv.append(rightLastDiv);
        $(this).html(leftDiv);
        $(this).append(rightDiv);
        $(this).addClass("internal-active");
        $(this).removeClass("internal");
      })
    });
	});
</script>
<script>
      let cookieName = 'cookie_consent';
      let expiryTime = new Date(2037, 11, 21);
      let today = new Date();
      let cookieConsentDeclinedDate = localStorage.getItem("cookie_consent_declined");
      let dateDiffHours = 0;
      let cookieConsentHtml = `
      <div id="cookie-consent">
        <p>
          We use cookies to perform analytics and enhance user experience. Do you accept to the use of cookies?
        </p>
        <p class="cookie-consent-buttons">
          <a id="decline-cookie-btn" class="btn white-button" href="javascript:void(0)">Decline</a>
          <a id="accept-cookie-btn" class="btn blue-button" href="javascript:void(0)">Accept</a>
        </p>
      </div>
      `;
      
      const parseCookie = str =>
        str
        .split(';')
        .map(v => v.split('='))
        .reduce((acc, v) => {
          acc[decodeURIComponent(v[0].trim())] = decodeURIComponent(v[1].trim());
          return acc;
        }, {});
      
      dateDiffHours = cookieConsentDeclinedDate ? Math.abs(cookieConsentDeclinedDate - today) / 36e5 : 0;
      if (document.cookie.indexOf(cookieName) < 0) {
        if (cookieConsentDeclinedDate) {
          if (dateDiffHours > 24) {
            $("body").append(cookieConsentHtml);
          }
        } else {
          $("body").append(cookieConsentHtml);
        }
      } else {
        cookies = parseCookie(document.cookie);
        if (cookies["cookie_consent"] == "accept") {
          consentGranted();
        }
      }
      
      $("#accept-cookie-btn").click(function() {
        document.cookie = `${cookieName}=accept;expires=${expiryTime};path=/`;
        localStorage.removeItem("cookie_consent_declined");
        consentGranted();
        $("#cookie-consent").hide();
      });
      $("#decline-cookie-btn").click(function() {
        localStorage.setItem("cookie_consent_declined", today);
        $("#cookie-consent").hide();
      });
</script>
</body>
</html>