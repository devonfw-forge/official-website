<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=">
<meta name="generator" content="Asciidoctor 1.5.8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- ******** SOCIAL MEDIA META ********** -->

<meta name="title" property="og:title" content="devonfw website">
<meta property="og:type" content="website">
<meta name="image" property="og:image" content="https://devonfw.com/images/devonfwwebsite.png">
<meta name="description" property="og:description" content="devonfw is the standard open source software development platform; Serving the full Software Delivery Life Cycle.">
<meta property="og:url" content="https://devonfw.com/index.html">

<meta name="twitter:title" content="devonfw website">
<meta name="twitter:description" content="devonfw is the standard open source software development platform; Serving the full Software Delivery Life Cycle.">
<meta name="twitter:image" content="https://devonfw.com/images/devonfwwebsite.png">
<meta name="twitter:card" content="summary_large_image">

<!-- ************************************* -->


<title>Packages</title>
<!-- devonfw website stylesheet -->
<link rel="stylesheet" type="text/css" href="/devonfw.css">
<!-- Lunr -->
<script src="/website/assets/scripts/lunr.min.js"></script>
<!-- JQuery -->
<script src="/website/assets/scripts/jquery.min.js"></script>
<link rel="stylesheet" href="/website/assets/styles/font-awesome.min.css">
<link rel="stylesheet" href="/website/assets/styles/googlecode.min.css">
<script src="/website/assets/scripts/highlight.min.js"></script>
<script src="/website/assets/scripts/common.min.js"></script>
<script>hljs.initHighlightingOnLoad()</script>
<link rel="stylesheet" href="/website/assets/styles/bootstrap.min.css">

<script src="/website/assets/scripts/anchor.min.js"></script>

<script src="/website/components/header/search-engine/bundle.js"></script>

<script src="/website/shared/rightmenu.js"></script>

<!-- ************** Google analytics ************ -->
<script>
window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}

gtag('consent', 'default', {
  'analytics_storage': 'denied'
});
</script>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-151636804-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-151636804-1');
</script>
<script>
  function consentGranted() {
    gtag('consent', 'update', {
      'analytics_storage': 'granted'
    });
  }
</script>

<!-- ******************************************** -->


</head>
<body id="devonfw-guide_devon4net.wiki_packages.asciidoc" class="article">
<div id="website-navbar" class="website-navbar">
<button id="menu-button" class="menu-button">
  <img src="/images/menu-button.svg" width="32px" height="32px" alt=""/>
</button>

<ul>
<li>
<p><span class="image"><a class="image" href="/website/pages/welcome/welcome.html"><img alt="logo" src="/images/Logo_devonfw.svg"></a></span></p>
</li>
<li>
<p><a href="https://killercoda.com/devonfw">Tutorials</a></p>
</li>
<li>
<p><a href="/website/pages/solutions/index.html">Solutions</a></p>
</li>
<li>
<p><a href="/website/pages/docs/master.html">Docs</a></p>
</li>
</ul>

<form class="form-inline">
  <div class="search-bar">
    <input
      id="search-field"
      type="search"
      class="form-control mr-sm-2"
      placeholder="Search by keyword(s)..."
      aria-label="Search"
      style="height: auto;"
      autocomplete="off"/>
    <div class="sb-res-pos px-4">
      <div id="click-outside" class="click-outside z-50 hidden"></div>
      <div class="col rounded px-0 border z-100 bg-white hidden search-bar-results" id="search-results-box">
      </div>
    </div>
  </div>
</form>
<a class="navbar-github text-white" href="https://github.com/devonfw/">
  <img src="/images/github-mark.png" width=auto height=auto alt="">
</a></div>
<div id="sidebar" class="wiki-sidebar"></div>

<div id="content" class="mt-4 mt-sm-5">
<div id="preamble">
<div class="sectionbody">
<div class="toc2">
<div class="title">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#devonfw-guide_devon4net.wiki_packages.asciidoc_overview">Overview</a>
<ul class="sectlevel2">
<li><a href="#devonfw-guide_devon4net.wiki_packages.asciidoc_component-structure">Component structure</a></li>
</ul>
</li>
<li><a href="#devonfw-guide_devon4net.wiki_packages.asciidoc_configuration-basics">Configuration basics</a>
<ul class="sectlevel2">
<li><a href="#devonfw-guide_devon4net.wiki_packages.asciidoc_extension-methods">Extension methods</a></li>
<li><a href="#devonfw-guide_devon4net.wiki_packages.asciidoc_options-pattern">Options pattern</a></li>
<li><a href="#devonfw-guide_devon4net.wiki_packages.asciidoc_dependency-injection">Dependency Injection</a></li>
</ul>
</li>
<li><a href="#devonfw-guide_devon4net.wiki_packages.asciidoc_devon4net.infrastructure.circuitbreaker">Devon4Net.Infrastructure.CircuitBreaker</a>
<ul class="sectlevel2">
<li><a href="#devonfw-guide_devon4net.wiki_packages.asciidoc_configuration">Configuration</a></li>
<li><a href="#devonfw-guide_devon4net.wiki_packages.asciidoc_setting-up-in-devon">Setting up in Devon</a></li>
<li><a href="#devonfw-guide_devon4net.wiki_packages.asciidoc_setting-up-in-other-projects">Setting up in other projects</a></li>
</ul>
</li>
<li><a href="#devonfw-guide_devon4net.wiki_packages.asciidoc_devon4net.infrastructure.swagger">Devon4Net.Infrastructure.Swagger</a>
<ul class="sectlevel2">
<li><a href="#devonfw-guide_devon4net.wiki_packages.asciidoc_configuration">Configuration</a></li>
<li><a href="#devonfw-guide_devon4net.wiki_packages.asciidoc_setting-up-in-devon">Setting up in Devon</a></li>
<li><a href="#devonfw-guide_devon4net.wiki_packages.asciidoc_setting-up-in-other-projects">Setting up in other projects</a></li>
<li><a href="#devonfw-guide_devon4net.wiki_packages.asciidoc_tips">Tips</a></li>
</ul>
</li>
<li><a href="#devonfw-guide_devon4net.wiki_packages.asciidoc_devon4net.infrastructure.logger">Devon4Net.Infrastructure.Logger</a>
<ul class="sectlevel2">
<li><a href="#devonfw-guide_devon4net.wiki_packages.asciidoc_configuration">Configuration</a></li>
<li><a href="#devonfw-guide_devon4net.wiki_packages.asciidoc_setting-up-in-devon">Setting up in Devon</a></li>
<li><a href="#devonfw-guide_devon4net.wiki_packages.asciidoc_setting-up-in-other-projects">Setting up in other projects</a></li>
</ul>
</li>
<li><a href="#devonfw-guide_devon4net.wiki_packages.asciidoc_devon4net.infrastructure.cors">Devon4Net.Infrastructure.Cors</a>
<ul class="sectlevel2">
<li><a href="#devonfw-guide_devon4net.wiki_packages.asciidoc_configuration">Configuration</a></li>
<li><a href="#devonfw-guide_devon4net.wiki_packages.asciidoc_setting-up-in-devon">Setting up in Devon</a></li>
<li><a href="#devonfw-guide_devon4net.wiki_packages.asciidoc_setting-up-in-other-projects">Setting up in other projects</a></li>
<li><a href="#devonfw-guide_devon4net.wiki_packages.asciidoc_tips">Tips</a></li>
</ul>
</li>
<li><a href="#devonfw-guide_devon4net.wiki_packages.asciidoc_devon4net.infrastructure.jwt">Devon4Net.Infrastructure.JWT</a>
<ul class="sectlevel2">
<li><a href="#devonfw-guide_devon4net.wiki_packages.asciidoc_configuration">Configuration</a></li>
<li><a href="#devonfw-guide_devon4net.wiki_packages.asciidoc_setting-up-in-devon">Setting up in Devon</a></li>
<li><a href="#devonfw-guide_devon4net.wiki_packages.asciidoc_setting-up-in-other-projects">Setting up in other projects</a></li>
<li><a href="#devonfw-guide_devon4net.wiki_packages.asciidoc_references">References</a></li>
</ul>
</li>
<li><a href="#devonfw-guide_devon4net.wiki_packages.asciidoc_devon4net.infrastructure.litedb">Devon4Net.Infrastructure.LiteDb</a>
<ul class="sectlevel2">
<li><a href="#devonfw-guide_devon4net.wiki_packages.asciidoc_configuration">Configuration</a></li>
<li><a href="#devonfw-guide_devon4net.wiki_packages.asciidoc_setting-up-in-devon">Setting up in Devon</a></li>
<li><a href="#devonfw-guide_devon4net.wiki_packages.asciidoc_setting-up-in-other-projects">Setting up in other projects</a></li>
</ul>
</li>
<li><a href="#devonfw-guide_devon4net.wiki_packages.asciidoc_devon4net.infrastructure.kafka">Devon4Net.Infrastructure.Kafka</a>
<ul class="sectlevel2">
<li><a href="#devonfw-guide_devon4net.wiki_packages.asciidoc_configuration">Configuration</a></li>
<li><a href="#devonfw-guide_devon4net.wiki_packages.asciidoc_setting-up-in-devon">Setting up in Devon</a></li>
<li><a href="#devonfw-guide_devon4net.wiki_packages.asciidoc_setting-up-in-other-projects">Setting up in other projects</a></li>
</ul>
</li>
<li><a href="#devonfw-guide_devon4net.wiki_packages.asciidoc_devon4net.infrastructure.grpc">Devon4Net.Infrastructure.Grpc</a>
<ul class="sectlevel2">
<li><a href="#devonfw-guide_devon4net.wiki_packages.asciidoc_configuration">Configuration</a></li>
<li><a href="#devonfw-guide_devon4net.wiki_packages.asciidoc_setting-up-in-devon">Setting up in Devon</a></li>
<li><a href="#devonfw-guide_devon4net.wiki_packages.asciidoc_setting-up-in-other-projects">Setting up in other projects</a></li>
</ul>
</li>
<li><a href="#devonfw-guide_devon4net.wiki_packages.asciidoc_devon4net.infrastructure.fluentvalidation">Devon4Net.Infrastructure.FluentValidation</a>
<ul class="sectlevel2">
<li><a href="#devonfw-guide_devon4net.wiki_packages.asciidoc_setting-up-in-devon">Setting up in Devon</a></li>
<li><a href="#devonfw-guide_devon4net.wiki_packages.asciidoc_setting-up-in-other-projects">Setting up in other projects</a></li>
<li><a href="#devonfw-guide_devon4net.wiki_packages.asciidoc_references">References</a></li>
</ul>
</li>
<li><a href="#devonfw-guide_devon4net.wiki_packages.asciidoc_devon4net.infrastructure.common">Devon4Net.Infrastructure.Common</a>
<ul class="sectlevel2">
<li><a href="#devonfw-guide_devon4net.wiki_packages.asciidoc_options-pattern">Options pattern</a></li>
</ul>
</li>
<li><a href="#devonfw-guide_devon4net.wiki_packages.asciidoc_devon4net.infrastructure.extensions">Devon4Net.Infrastructure.Extensions</a>
<ul class="sectlevel2">
<li><a href="#devonfw-guide_devon4net.wiki_packages.asciidoc_objecttypehelper">ObjectTypeHelper</a></li>
<li><a href="#devonfw-guide_devon4net.wiki_packages.asciidoc_jsonhelper-json-serializer">JsonHelper (Json Serializer)</a></li>
<li><a href="#devonfw-guide_devon4net.wiki_packages.asciidoc_guidextension">GuidExtension</a></li>
<li><a href="#devonfw-guide_devon4net.wiki_packages.asciidoc_httpcontextextensions">HttpContextExtensions</a></li>
<li><a href="#devonfw-guide_devon4net.wiki_packages.asciidoc_httprequestextensions">HttpRequestExtensions</a></li>
<li><a href="#devonfw-guide_devon4net.wiki_packages.asciidoc_configuration">Configuration</a></li>
</ul>
</li>
<li><a href="#devonfw-guide_devon4net.wiki_packages.asciidoc_devon4net.infrastructure.mediatr">Devon4Net.Infrastructure.MediatR</a>
<ul class="sectlevel2">
<li><a href="#devonfw-guide_devon4net.wiki_packages.asciidoc_patterns">Patterns</a></li>
<li><a href="#devonfw-guide_devon4net.wiki_packages.asciidoc_key-classes">Key Classes</a></li>
<li><a href="#devonfw-guide_devon4net.wiki_packages.asciidoc_configuration">Configuration</a></li>
<li><a href="#devonfw-guide_devon4net.wiki_packages.asciidoc_setting-up-in-devon">Setting up in Devon</a></li>
<li><a href="#devonfw-guide_devon4net.wiki_packages.asciidoc_setting-up-in-other-projects">Setting up in other projects</a></li>
</ul>
</li>
<li><a href="#devonfw-guide_devon4net.wiki_packages.asciidoc_devon4net.infrastructure.rabbitmq">Devon4Net.Infrastructure.RabbitMQ</a>
<ul class="sectlevel2">
<li><a href="#devonfw-guide_devon4net.wiki_packages.asciidoc_patterns">Patterns</a></li>
<li><a href="#devonfw-guide_devon4net.wiki_packages.asciidoc_key-classes">Key Classes</a></li>
<li><a href="#devonfw-guide_devon4net.wiki_packages.asciidoc_configuration">Configuration</a></li>
<li><a href="#devonfw-guide_devon4net.wiki_packages.asciidoc_setting-up-in-devon">Setting up in Devon</a></li>
<li><a href="#devonfw-guide_devon4net.wiki_packages.asciidoc_setting-up-in-other-projects">Setting up in other projects</a></li>
</ul>
</li>
<li><a href="#devonfw-guide_devon4net.wiki_packages.asciidoc_devon4net.infrastructure.middleware">Devon4Net.Infrastructure.Middleware</a>
<ul class="sectlevel2">
<li><a href="#devonfw-guide_devon4net.wiki_packages.asciidoc_configuration">Configuration</a></li>
<li><a href="#devonfw-guide_devon4net.wiki_packages.asciidoc_setting-up-in-devon">Setting up in Devon</a></li>
<li><a href="#devonfw-guide_devon4net.wiki_packages.asciidoc_setting-up-in-other-projects">Setting up in other projects</a></li>
<li><a href="#devonfw-guide_devon4net.wiki_packages.asciidoc_references">References</a></li>
</ul>
</li>
<li><a href="#devonfw-guide_devon4net.wiki_packages.asciidoc_devon4net.infrastructure.unitofwork">Devon4Net.Infrastructure.UnitOfWork</a>
<ul class="sectlevel2">
<li><a href="#devonfw-guide_devon4net.wiki_packages.asciidoc_the-repository-pattern">The Repository Pattern</a></li>
<li><a href="#devonfw-guide_devon4net.wiki_packages.asciidoc_configuration">Configuration</a></li>
<li><a href="#devonfw-guide_devon4net.wiki_packages.asciidoc_setting-up-in-devon">Setting up in Devon</a></li>
<li><a href="#devonfw-guide_devon4net.wiki_packages.asciidoc_setting-up-in-other-projects">Setting up in other projects</a></li>
<li><a href="#devonfw-guide_devon4net.wiki_packages.asciidoc_tips">Tips</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div class="sect1">
<h2 id="devonfw-guide_devon4net.wiki_packages.asciidoc_overview">Overview</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Devon4Net is made up of several components, all of which are described in this document. This components are available in the form of NuGet packages. In the <a href="https://github.com/devonfw/devon4net">Devon4Net repository</a> this packages are placed in the Infrastructure layer which is a cross-cutting layer that can be referenced from any level on the architecture.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw.github.io/devonfw.github.io/target/generated-docs/images/Infrastructure_package.png" alt="Infrastructure package">
</div>
<div class="title">Figure 1. Infrastructure directory</div>
</div>
<div class="paragraph">
<p>Components are class librarys that collaborate with each other for a purpose. They group the necessary code so that they can work according to the specified configuration. For example, the package <code>Devon4Net.Infrastructure.Swagger</code> has isolated the swagger essential pieces of code and has been developed in such a manner that you just need to write a few lines and specify a couple options to get it working the way you need.</p>
</div>
<div class="sect2">
<h3 id="devonfw-guide_devon4net.wiki_packages.asciidoc_component-structure">Component structure</h3>
<div class="paragraph">
<p>All of the components follow a similar structure which includes the next directories:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Configuration:</strong> Static configuration class (or multiple classes) that contains extension methods used to configure the component.</p>
</li>
<li>
<p><strong>Handlers:</strong> Classes that are required to manage complex operations or communications.</p>
</li>
<li>
<p><strong>Helpers:</strong> Normally static classes that help in small conversions and operations.</p>
</li>
<li>
<p><strong>Constants:</strong> Classes that contain static constants to get rid of hard-coded values.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="icon-note" title=""></i>
</td>
<td class="content">
Because each component is unique, you may find some more directories or less than those listed above.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="devonfw-guide_devon4net.wiki_packages.asciidoc_configuration-basics">Configuration basics</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Any configuration for .Net Core 6.0 projects needs to be done in the <code>Program.cs</code> files which is placed on the startup application, but we can extract any configuration needed to an extension method and call that method from the component. As a result, the component will group everything required and the configuration will be much easier.</p>
</div>
<div class="sect2">
<h3 id="devonfw-guide_devon4net.wiki_packages.asciidoc_extension-methods">Extension methods</h3>
<div class="paragraph">
<p><a href="https://docs.microsoft.com/en-us/dotnet/csharp/programming-guide/classes-and-structs/extension-methods">Extension methods</a> allow you to "add" methods to existing types without having to create a new derived type, or modify it in any way. Although they are static methods, they are referred to as instance methods on the extended type. For C# code, there is no difference in calling a extension method and a method defined in a type.</p>
</div>
<div class="paragraph">
<p>For example, the next extension method will extend the class <code>ExtendedClass</code> and it will need an <code>OptionalParameter</code> instance to do some configuration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="c# language-c#">public static class ExtensionMethods
{
    public static void DoConfiguration(this ExtendedClass class,  OptionalParameter extra)
    {
        // Do your configuration here
        class.DoSomething();
        class.AddSomething(extra)
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Thanks to the <code>this</code> modifier preceeding the first parameter, we are able to call the method directly on a instance of <code>ExtendedClass</code> as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="c# language-c#">ExtendedClass class = new();
OptionalParameter extra = new();

class.DoConfiguration(extra);</code></pre>
</div>
</div>
<div class="paragraph">
<p>As you can see, we don&#8217;t need that a class derived from <code>ExtendedClass</code> to add some methods and we don&#8217;t need those methods placed in the class itself either. This can be seen easily when extending a primitive type such as <code>string</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="c# language-c#">public static class ExtensionMethods
{
    public static int CountWords(this string word,  char[] separationChar = null)
    {
        if(separationChar == null) separationChar = new char[]{' '};
        return word.Split(separationChar, StringSplitOptions.RemoveEmptyEntries).Length;
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the previous example we created a method that can count words given a list of separation characters. And now we can use it over any string as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="c# language-c#">string s = "Hello World";
Console.WriteLine(s.CountWords());</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="output language-output">2</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="icon-note" title=""></i>
</td>
<td class="content">
Remember to reference the class so you can use the extension methods (<code>using</code> directive).
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="devonfw-guide_devon4net.wiki_packages.asciidoc_options-pattern">Options pattern</h3>
<div class="paragraph">
<p>The <a href="https://docs.microsoft.com/en-us/aspnet/core/fundamentals/configuration/options?view=aspnetcore-6.0">options design pattern</a> allows you to have strong typed options and provides you the ability to inject them into your services. To follow this pattern, the configuration present on the <code>appsettings.json</code> needs to be mapped into an object.</p>
</div>
<div class="paragraph">
<p>This means, the following configuration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="json language-json">"essentialoptions" : {
  "value1": "Hello",
  "value2": "World"
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Would need the following class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="c# language-c#">public class EssentialOptions
{
    public string Value1 { get; set; }
    public string Value2 { get; set; }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In .Net we can easily map the configuration thanks to the <code>Configure&lt;T&gt;()</code> method from <code>IServiceCollection</code> and <code>GetSection()</code> method from <code>IConfiguration</code>. We could be loading the configuration as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="c# language-c#">services.Configure&lt;EssentialOptions&gt;(configuration.GetSection("essentialoptions"));</code></pre>
</div>
</div>
<div class="paragraph">
<p>And then injecting it making use of <code>IOptions&lt;T&gt;</code> interface:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="c# language-c#">public class MyService : IMyService
{
    private readonly EssentialOptions _options;

    public MyService(IOptions&lt;EssentialOptions&gt; options)
    {
        _options = options.Value;
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In devon4net, there is an <code>IServiceCollection</code> extension available that uses the methods described above and also returns the options injected thanks to <code>IOptions&lt;T&gt;</code>.  So, to load the same options, we should use the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="c# language-c#">EssentialOptions options = services.GetTypedOptions&lt;EssentialOptions&gt;(configuration, "essentialoptions");</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="devonfw-guide_devon4net.wiki_packages.asciidoc_dependency-injection">Dependency Injection</h3>
<div class="paragraph">
<p><a href="https://docs.microsoft.com/en-us/dotnet/core/extensions/dependency-injection">Dependency Injection</a> is a technique for achieving Inversion of Control Principle. In .Net it is a built-in part that comes with the framework.</p>
</div>
<div class="paragraph">
<p>Using a service provider <code>IServiceProvider</code> available in .Net, we are able to add any service or option to a service stack that will be available for injection in constructors of the classes where it&#8217;s used.</p>
</div>
<div class="paragraph">
<p>Services can be registered with one of the following lifetimes:</p>
</div>
<table class="tableblock frame-all grid-all" style="width: 100%;">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Lifetime</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Description</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Example</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Transient</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Transient lifetime services are created each time they&#8217;re requested from the service container. Disposed at the end of the request.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">services.AddTransient&lt;IDependency, Dependency&gt;();</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Scoped</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A scoped lifetime indicates that services are created once per client request (connection).  Disposed at the end of the request.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">services.AddScoped&lt;IDependency, Dependency&gt;();</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Singleton</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Singleton lifetime services are created either the first time they&#8217;re requested or by the developer. Every subsequent request of the service implementation from the dependency injection container uses the same instance.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">services.AddSingleton&lt;IDependency, Dependency&gt;();</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>This injections would be done in the startup project in <code>Program.cs</code> file, and then injected in constructors where needed.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="devonfw-guide_devon4net.wiki_packages.asciidoc_devon4net.infrastructure.circuitbreaker">Devon4Net.Infrastructure.CircuitBreaker</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The Devon4Net.Infrastructure.CircuitBreaker component implements the retry pattern for HTTP/HTTPS calls. It may be used in both SOAP and REST services.</p>
</div>
<div class="sect2">
<h3 id="devonfw-guide_devon4net.wiki_packages.asciidoc_configuration">Configuration</h3>
<div class="paragraph">
<p>Component configuration is made on file <code>appsettings.{environment}.json</code> as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="json language-json">"CircuitBreaker": {
    "CheckCertificate": false,
    "Endpoints": [
      {
        "Name": "SampleService",
        "BaseAddress": "http://localhost:5001",
        "Headers": {
        },
        "WaitAndRetrySeconds": [
          0.0001,
          0.0005,
          0.001
        ],
        "DurationOfBreak": 0.0005,
        "UseCertificate": false,
        "Certificate": "localhost.pfx",
        "CertificatePassword": "localhost",
        "SslProtocol": "Tls12", //Tls, Tls11,Tls12, Tls13, none
        "CompressionSupport": true,
        "AllowAutoRedirect": true
      }
    ]
  }</code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all" style="width: 100%;">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong>Property</strong></th>
<th class="tableblock halign-left valign-top"><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CheckCertificate</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">True if HTTPS is required. This is useful when developing an API Gateway needs a secured HTTP, disabling this on development we can use communications with a valid server certificate</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Endpoints</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Array with predefined sites to connect with</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The name key to identify the destination URL</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Headers</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Not ready yet</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">WaitAndRetrySeconds</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Array which determines the number of retries and the lapse period between each retry. The value is in milliseconds.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Certificate</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ceritificate client to use to perform the HTTP call</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CertificatePassword</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The password that you assign when exporting the certificate</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SslProtocol</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The secure protocol to use on the call</p></td>
</tr>
</tbody>
</table>
<div class="sect3">
<h4 id="devonfw-guide_devon4net.wiki_packages.asciidoc_protocols">Protocols</h4>
<table class="tableblock frame-all grid-all" style="width: 100%;">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong>Protocol</strong></th>
<th class="tableblock halign-left valign-top"><strong>Key</strong></th>
<th class="tableblock halign-left valign-top"><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SSl3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">48</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specifies the Secure Socket Layer (SSL) 3.0 security protocol. SSL 3.0 has been superseded by the Transport Layer Security (TLS) protocol and is provided for backward compatibility only.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">TLS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">192</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specifies the Transport Layer Security (TLS) 1.0 security protocol. The TLS 1.0 protocol is defined in IETF RFC 2246.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">TLS11</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">768</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specifies the Transport Layer Security (TLS) 1.1 security protocol. The TLS 1.1 protocol is defined in IETF RFC 4346. On Windows systems, this value is supported starting with Windows 7.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">TLS12</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3072</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specifies the Transport Layer Security (TLS) 1.2 security protocol. The TLS 1.2 protocol is defined in IETF RFC 5246. On Windows systems, this value is supported starting with Windows 7.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">TLS13</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">12288</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specifies the TLS 1.3 security protocol. The TLS protocol is defined in IETF RFC 8446.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect2">
<h3 id="devonfw-guide_devon4net.wiki_packages.asciidoc_setting-up-in-devon">Setting up in Devon</h3>
<div class="paragraph">
<p>For setting it up using the Devon4NetApi template just configure it in the <code>appsettings.{environment}.json</code> file.</p>
</div>
<div class="paragraph">
<p>Add it using Dependency Injection on this case we instanciate Circuit Breaker in a Service Sample Class</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="C# language-C#">public class SampleService: Service&lt;SampleContext&gt;, ISampleService
    {
        private readonly ISampleRepository _sampleRepository;
        private IHttpClientHandler _httpClientHandler { get; }

        /// &lt;summary&gt;
        /// Constructor
        /// &lt;/summary&gt;
        /// &lt;param name="uoW"&gt;&lt;/param&gt;
        public SampleService(IUnitOfWork&lt;SampleContext&gt; uoW, IHttpClientHandler httpClientHandler) : base(uoW)
        {
            _httpClientHandler = httpClientHandler;
            _sampleRepository = uoW.Repository&lt;ISampleRepository&gt;();
        }
    }</code></pre>
</div>
</div>
<div class="paragraph">
<p>Add the necessary references.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="C# language-C#">using Devon4Net.Infrastructure.CircuitBreaker.Common.Enums;
using Devon4Net.Infrastructure.CircuitBreaker.Handlers;</code></pre>
</div>
</div>
<div class="paragraph">
<p>You must give the following arguments to make a POST call:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="C# language-C#">await _httpClientHandler.Send&lt;YourOutPutClass&gt;(HttpMethod.POST, NameOfTheService, EndPoint, InputData, MediaType.ApplicationJson);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Where:</p>
</div>
<table class="tableblock frame-all grid-all" style="width: 100%;">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong>Property</strong></th>
<th class="tableblock halign-left valign-top"><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">YourOutputClass</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The type of the class that you are expecting to retrieve from the call</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">NameOftheService</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The key name of the endpoint provided in the appsettings.json file at Endpoints[] node</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>EndPoint</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Part of the url to use with the base address. E.g: <em>/validate</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>InputData</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Your instance of the class with values that you want to use in the call</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>MediaType.ApplicationJson</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The media type flag for the call</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="devonfw-guide_devon4net.wiki_packages.asciidoc_setting-up-in-other-projects">Setting up in other projects</h3>
<div class="paragraph">
<p>Install the package on your solution using the Package Manager Console:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>Install-Package Devon4Net.Infrastructure.CircuitBreaker</code></pre>
</div>
</div>
<div class="paragraph">
<p>next add via Dependency Injection the circuit breaker instance.On this case we use a Service</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="C# language-C#">public class SampleService : ISampleService
 {
   private IHttpClientHandler _httpClientHandler { get; }

    public SampleService(IHttpClientHandler httpClientHandler)
      {
        _httpClientHandler = httpClientHandler;
      }
 }</code></pre>
</div>
</div>
<div class="paragraph">
<p>Don&#8217;t forget to provide the necessary references.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="C# language-C#">using Devon4Net.Infrastructure.CircuitBreaker.Common.Enums;
using Devon4Net.Infrastructure.CircuitBreaker.Handlers;</code></pre>
</div>
</div>
<div class="paragraph">
<p>And configure CircuitBreaker in <code>Program.cs</code> adding the following lines:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="C# language-C#">using Devon4Net.Infrastructure.CircuitBreaker;
.
.
.
builder.Services.SetupCircuitBreaker(builder.Configuration);</code></pre>
</div>
</div>
<div class="paragraph">
<p>You must add the default configuration shown in the configuration section and at this point you can use the circuit breaker functionality in your code.</p>
</div>
<div class="paragraph">
<p>To perform a GET call you should use your circuit breaker instance as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="C# language-C#">await _httpClientHandler.Send&lt;YourOutPutClass&gt;(HttpMethod.Get, NameOfTheService, EndPoint, InputData, MediaType.ApplicationJson);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Where:</p>
</div>
<table class="tableblock frame-all grid-all" style="width: 100%;">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong>Property</strong></th>
<th class="tableblock halign-left valign-top"><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">YourOutputClass</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The type of the class that you are expecting to retrieve from the call</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">NameOftheService</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The key name of the endpoint provided in the appsettings.json file at Endpoints[] node</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>EndPoint</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Part of the url to use with the base address. E.g: <em>/validate</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>InputData</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Your instance of the class with values that you want to use in the call</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>MediaType.ApplicationJson</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The media type flag for the call</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="devonfw-guide_devon4net.wiki_packages.asciidoc_devon4net.infrastructure.swagger">Devon4Net.Infrastructure.Swagger</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Swagger is a set of open source software tools for designing, building, documenting, and using RESTful web services. This component provides a full externalized configuration for the Swagger tool.</p>
</div>
<div class="paragraph">
<p>It primarily provides the swagger UI for visualizing and testing APIs, as well as automatic documentation generation via annotations in controllers.</p>
</div>
<div class="sect2">
<h3 id="devonfw-guide_devon4net.wiki_packages.asciidoc_configuration">Configuration</h3>
<div class="paragraph">
<p>Component configuration is made on file <code>appsettings.{environment}.json</code> as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="json language-json">"Swagger": {
    "Version": "v1",
    "Title": "My Swagger API",
    "Description": "Swagger API for devon4net documentation",
    "Terms": "https://www.devonfw.com/terms-of-use/",
    "Contact": {
      "Name": "devonfw",
      "Email": "sample@mail.com",
      "Url": "https://www.devonfw.com"
    },
    "License": {
      "Name": "devonfw - Terms of Use",
      "Url": "https://www.devonfw.com/terms-of-use/"
    },
    "Endpoint": {
      "Name": "V1 Docs",
      "Url": "/swagger/v1/swagger.json",
      "UrlUi": "swagger",
      "RouteTemplate": "swagger/v1/{documentName}/swagger.json"
    }
},</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the following list all the configuration fields are described:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>Version</code>: Actual version of the API.</p>
</li>
<li>
<p><code>Title</code>: Title of the API.</p>
</li>
<li>
<p><code>Description</code>: Description of the API.</p>
</li>
<li>
<p><code>Terms</code>: Link to the terms and conditions agreement.</p>
</li>
<li>
<p><code>Contact</code>: Your contact information.</p>
</li>
<li>
<p><code>License</code>: Link to the License agreement.</p>
</li>
<li>
<p><code>Endpoint</code>: Swagger endpoints information.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="devonfw-guide_devon4net.wiki_packages.asciidoc_setting-up-in-devon">Setting up in Devon</h3>
<div class="paragraph">
<p>For setting it up using the Devon4NetApi template just configure it in the <code>appsettings.{environment}.json</code> file.</p>
</div>
</div>
<div class="sect2">
<h3 id="devonfw-guide_devon4net.wiki_packages.asciidoc_setting-up-in-other-projects">Setting up in other projects</h3>
<div class="paragraph">
<p>Install the package on your solution using the Package Manager Console:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="console language-console">&gt; install-package Devon4Net.Infrastructure.Swagger</code></pre>
</div>
</div>
<div class="paragraph">
<p>Configure swagger in <code>Program.cs</code> adding the following lines:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="c# language-c#">using Devon4Net.Infrastructure.Swagger;
.
.
.
builder.Services.SetupSwagger(builder.Configuration);
.
.
.
app.ConfigureSwaggerEndPoint();</code></pre>
</div>
</div>
<div class="paragraph">
<p>Add the default configuration shown in the configuration section.</p>
</div>
</div>
<div class="sect2">
<h3 id="devonfw-guide_devon4net.wiki_packages.asciidoc_tips">Tips</h3>
<div class="ulist">
<ul>
<li>
<p>In order to generate the documentation annotate your actions with summary, remarks and response tags:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>/// &lt;summary&gt;
/// Method to make a reservation with potential guests. The method returns the reservation token.
/// &lt;/summary&gt;
/// &lt;param name="bookingDto"&gt;&lt;/param&gt;
/// &lt;response code="201"&gt;Ok.&lt;/response&gt;
/// &lt;response code="400"&gt;Bad request. Parser data error.&lt;/response&gt;
/// &lt;response code="401"&gt;Unauthorized. Authentication fail.&lt;/response&gt;
/// &lt;response code="403"&gt;Forbidden. Authorization error.&lt;/response&gt;
/// &lt;response code="500"&gt;Internal Server Error. The search process ended with error.&lt;/response&gt;
[HttpPost]
[HttpOptions]
[Route("/mythaistar/services/rest/bookingmanagement/v1/booking")]
[AllowAnonymous]
[EnableCors("CorsPolicy")]
public async Task&lt;IActionResult&gt; Booking([FromBody]BookingDto bookingDto)
{
    try
    {

    ...</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>You can access the swagger UI on <code><a href="http://localhost:yourport/swagger/index.html" class="bare">http://localhost:yourport/swagger/index.html</a></code></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="devonfw-guide_devon4net.wiki_packages.asciidoc_devon4net.infrastructure.logger">Devon4Net.Infrastructure.Logger</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Previously known as Devon4Net.Infrastructure.Log(v5.0 or lower)</p>
</div>
<div class="paragraph">
<p>Logging is an essential component of every application&#8217;s life cycle.
A strong logging system becomes a critical component that assists developers to understand and resolve emerging problems.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="icon-note" title=""></i>
</td>
<td class="content">
Starting with .NET 6, logging services no longer register the ILogger type. When using a logger, specify the generic-type alternative ILogger&lt;TCategoryName&gt; or register the <code>ILogger</code> with dependency injection (DI).
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Default .Net log levels system:</p>
</div>
<table class="tableblock frame-all grid-all" style="width: 100%;">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Type</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Description</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Critical</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Used to notify failures that force the program to shut down</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Error</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Used to track major faults that occur during program execution</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Warning</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Used to report non-critical unexpected behavior</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Information</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Informative messages</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Debug</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Used for debugging messages containing additional information about application operations</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Trace</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">For tracing the code</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">None</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If you choose this option the loggin category will not write any messages</p></td>
</tr>
</tbody>
</table>
<div class="sect2">
<h3 id="devonfw-guide_devon4net.wiki_packages.asciidoc_configuration">Configuration</h3>
<div class="paragraph">
<p>Component setup is done in the <code>appsettings.{environment}.json</code> file using the following structure:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="json language-json">  "Logging": {
    "UseLogFile": true,
    "UseSQLiteDb": true,
    "UseGraylog": true,
    "UseAOPTrace": false,
    "LogLevel": {
      "Default": "Information",
      "Microsoft.AspNetCore": "Warning"
    },
    "SqliteDatabase": "logs/log.db",
    "LogFile": "logs/{0}_devonfw.log",
    "SeqLogServerHost": "http://127.0.0.1:5341",
    "GrayLog": {
      "GrayLogHost": "127.0.0.1",
      "GrayLogPort": "12201",
      "GrayLogProtocol": "UDP",
      "UseSecureConnection": true,
      "UseAsyncLogging": true,
      "RetryCount": 5,
      "RetryIntervalMs": 15,
      "MaxUdpMessageSize": 8192
    }
  }</code></pre>
</div>
</div>
<div class="paragraph">
<p>Where:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>UseLogFile</code>: When you set this option to true, you can store the log output to a file.</p>
</li>
<li>
<p><code>UseSQLiteDb</code>: True when you wish to insert the log output into a SQLiteDb</p>
</li>
<li>
<p><code>UseGrayLog</code>: This option enables the use of GrayLog for loggin</p>
</li>
<li>
<p><code>UseAOPTrace</code>: True if you need to trace the attributes of the controllers</p>
</li>
</ul>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="icon-warning" title=""></i>
</td>
<td class="content">
Don&#8217;t set to true on production environments, doing so may expose critical information.
</td>
</tr>
</table>
</div>
<div class="ulist">
<ul>
<li>
<p><code>LogLevel</code>: Sets the minimum level of logs to be captured</p>
</li>
<li>
<p><code>SqliteDatabase</code>: path to SQlite database</p>
</li>
<li>
<p><code>LogFile</code>: path to the log file</p>
</li>
<li>
<p><code>SeqLogServerHost</code>: url for Seq server, you need to install Seq  in order to use it, you can install it clicking <a href="https://datalust.co/download">here</a></p>
</li>
<li>
<p><code>GrayLog</code>: Some configuration parameters for Graylog service you can install it using <a href="https://www.graylog.org/products/open-source#download-open">this link</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="devonfw-guide_devon4net.wiki_packages.asciidoc_setting-up-in-devon">Setting up in Devon</h3>
<div class="paragraph">
<p>For setting it up using the Devon4NetApi template just configure it in the <code>appsettings.{environment}.json</code> file.</p>
</div>
<div class="paragraph">
<p>You can use the methods implemented in Devon4NetLogger class, each method corresponds with a log level in .Net log levels system, for example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="c# language-c#">Devon4NetLogger.Debug("Executing GetTodo from controller TodoController");</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="devonfw-guide_devon4net.wiki_packages.asciidoc_setting-up-in-other-projects">Setting up in other projects</h3>
<div class="paragraph">
<p>Install the package on your solution using the Package Manager Console:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="console language-console">install-package Devon4Net.Infrastructure.Logger</code></pre>
</div>
</div>
<div class="paragraph">
<p>Add the following line of code to Progam.cs:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="c# language-c#">builder.Services.SetupLog(builder.Configuration);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Add the default configuration shown in the configuration section.</p>
</div>
<div class="paragraph">
<p>use the Devon4NetLogger class methods as explanied above:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="c# language-c#">Devon4NetLogger.Information("Executing GetSample from controller SampleController");</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="devonfw-guide_devon4net.wiki_packages.asciidoc_devon4net.infrastructure.cors">Devon4Net.Infrastructure.Cors</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Allows CORS settings for the devon4Net application.
Configuration may be used to configure several domains.
Web clients (for example, Angular) must follow this rule to avoid performing AJAX calls to another domain.</p>
</div>
<div class="paragraph">
<p>Cross-Origin Resource Sharing (CORS) is an HTTP-header-based mechanism that allows a server to specify any origin (domain, scheme, or port) outside of its own from which a browser should allow resources to be loaded. CORS also makes use of a process in which browsers send a "preflight" request to the server hosting the cross-origin resource to ensure that the server will allow the actual request. During that preflight, the browser sends headers indicating the HTTP method as well as headers that will be used in the actual request.</p>
</div>
<div class="paragraph">
<p>You may find out more by going to <a href="https://docs.microsoft.com/es-es/aspnet/core/security/cors?view=aspnetcore-6.0">Microsoft CORS documentation</a></p>
</div>
<div class="sect2">
<h3 id="devonfw-guide_devon4net.wiki_packages.asciidoc_configuration">Configuration</h3>
<div class="paragraph">
<p>Component setup is done in the <code>appsettings.{environment}.json</code> file using the following structure:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="json language-json"> "Cors": //[], //Empty array allows all origins with the policy "CorsPolicy"
  [
    {
      "CorsPolicy": "CorsPolicy",
      "Origins": "http://localhost:4200,https://localhost:4200,http://localhost,https://localhost;http://localhost:8085,https://localhost:8085",
      "Headers": "accept,content-type,origin,x-custom-header,authorization",
      "Methods": "GET,POST,HEAD,PUT,DELETE",
      "AllowCredentials": true
    }
  ]</code></pre>
</div>
</div>
<div class="paragraph">
<p>You may add as many policies as you like following the JSON format. for example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="json language-json"> "Cors": //[], //Empty array allows all origins with the policy "CorsPolicy"
  [
    {
      "CorsPolicy": "FirstPolicy",
      "Origins": "http://localhost:4200",
      "Headers": "accept,content-type,origin,x-custom-header,authorization",
      "Methods": "GET,POST,DELETE",
      "AllowCredentials": true
    },
    {
      "CorsPolicy": "SecondPolicy",
      "Origins": "https://localhost:8085",
      "Headers": "accept,content-type,origin",
      "Methods": "GET,POST,HEAD,PUT,DELETE",
      "AllowCredentials": false
    }
  ]</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the following table all the configuration fields are described:</p>
</div>
<table class="tableblock frame-all grid-all" style="width: 100%;">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Property</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Description</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CorsPolicy</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name of the policy</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Origins</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The origin&#8217;s url that you wish to accept.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Headers</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Permitted request headers</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Methods</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Allowed Http methods</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">AllowCredentials</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set true to allow the exchange of credentials across origins</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="devonfw-guide_devon4net.wiki_packages.asciidoc_setting-up-in-devon">Setting up in Devon</h3>
<div class="paragraph">
<p>For setting it up using the Devon4NetApi template just configure it in the <code>appsettings.{environment}.json</code> file.</p>
</div>
<div class="paragraph">
<p>You can enable CORS per action, per controller, or globally for all Web API controllers in your application:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Add this annotation in the Controller Class you want to use CORS policy</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="c# language-c#">[EnableCors("CorsPolicy")]</code></pre>
</div>
</div>
<div class="paragraph">
<p>As an example, consider this implementation on the EmployeeController class</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="c# language-c#">namespace Devon4Net.Application.WebAPI.Implementation.Business.EmployeeManagement.Controllers
{
    /// &lt;summary&gt;
    /// Employees controller
    /// &lt;/summary&gt;
    [ApiController]
    [Route("[controller]")]
    [EnableCors("CorsPolicy")]
    public class EmployeeController: ControllerBase
    {
      .
      .
      .
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The example above enables CORS for all the controller methods.</p>
</div>
</li>
<li>
<p>In the same way, you may enable CORS on any controller method:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="c# language-c#">[EnableCors("FirstPolicy")]
public async Task&lt;ActionResult&gt; GetEmployee()
{

}

public async Task&lt;ActionResult&gt; ModifyEmployee(EmployeeDto employeeDto)
{

}

[EnableCors("SecondPolicy")]
public async Task&lt;ActionResult&gt; Delete([Required]long employeeId)
{

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The example above enables CORS for the GetEmployee and Delete method.</p>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="devonfw-guide_devon4net.wiki_packages.asciidoc_setting-up-in-other-projects">Setting up in other projects</h3>
<div class="paragraph">
<p>Using the Package Manager Console, install the the next package on your solution:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="console language-console">install-package Devon4Net.Infrastructure.Cors</code></pre>
</div>
</div>
<div class="paragraph">
<p>Add the following lines of code to Progam.cs:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="c# language-c#">builder.Services.SetupCors(builder.Configuration);
.
.
.
app.SetupCors();</code></pre>
</div>
</div>
<div class="paragraph">
<p>Add the default configuration shown in the configuration section.</p>
</div>
<div class="paragraph">
<p>You can enable CORS per action, per controller, or globally for all Web API controllers in your application:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Add this annotation to the controller class that will be using the CORS policy.</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="c# language-c#">[EnableCors("SamplePolicy")]
    public class SampleController: ControllerBase
    {
      .
      .
      .
    }</code></pre>
</div>
</div>
<div class="paragraph">
<p>Where "SamplePolicy" is the name you give the Policy in the <code>appsettings.{environment}.json</code>.</p>
</div>
<div class="paragraph">
<p>The example above enables CORS for all the controller methods.</p>
</div>
</li>
<li>
<p>In the same way, you may enable any CORS-policy on any controller method:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="c# language-c#">[EnableCors("FirstPolicy")]
public async Task&lt;ActionResult&gt; GetSample()
{

}

public async Task&lt;ActionResult&gt; Modify(SampleDto sampleDto)
{

}

[EnableCors("SecondPolicy")]
public async Task&lt;ActionResult&gt; Delete([Required]long sampleId)
{

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The example above enables CORS for the GetSample and Delete method.</p>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="devonfw-guide_devon4net.wiki_packages.asciidoc_tips">Tips</h3>
<div class="ulist">
<ul>
<li>
<p>If you specify the CORS in the <code>appsettings.{environment}.json</code> configuration file as empty array, a default CORS-policy will be used with all origins enabled:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="json language-json"> "Cors": [], //Empty array allows all origins with the policy "CorsPolicy"</code></pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="icon-warning" title=""></i>
</td>
<td class="content">
Only use this policy in development environments
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>This default CORS-policy is defined as "CorsPolicy," and it should be enabled on the Controller Class as a standard Policy:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="c# language-c#">[EnableCors("CorsPolicy")]
public IActionResult Index() {
    return View();
}</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>if you want to disable the CORS check use the following annotation on any controller method:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="c# language-c#">[DisableCors]
public IActionResult Index() {
    return View();
}</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>If you set the EnableCors attribute at more than one scope, the order of precedence is:</p>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Action</p>
</li>
<li>
<p>Controller</p>
</li>
<li>
<p>Global</p>
</li>
</ol>
</div>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="devonfw-guide_devon4net.wiki_packages.asciidoc_devon4net.infrastructure.jwt">Devon4Net.Infrastructure.JWT</h2>
<div class="sectionbody">
<div class="quoteblock">
<blockquote>
JSON Web Token (JWT) is an open standard (<a href="https://datatracker.ietf.org/doc/html/rfc7519">RFC 7519</a>) that defines a compact and self-contained way for securely transmitting information between parties as a JSON object. This information can be verified and trusted because it is digitally signed. JWTs can be signed using a secret (with the <code>HMAC</code> algorithm) or a public/private key pair using <code>RSA</code> or <code>ECDSA</code> .
</blockquote>
<div class="attribution">
&#8212; <a href="https://jwt.io/introduction/">What is JSON Web Token?</a>
</div>
</div>
<div class="paragraph">
<p>In other words, a JSON Web Token is a JSON object encoded into an encrypted <code>string</code> that can be decoded and verified making use of cryptographic methods and algorithms. This tokens are mostly used to authenticate users in the context of websites, web applications and web services, but they can also be used to securely exchange information between parties.</p>
</div>
<div class="sect2">
<h3 id="devonfw-guide_devon4net.wiki_packages.asciidoc_configuration">Configuration</h3>
<div class="paragraph">
<p>Component configuration is made on file <code>appsettings.{environment}.json</code> as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="json language-json"> "JWT": {
    "Audience": "devon4Net",
    "Issuer": "devon4Net",
    "ValidateIssuer": true,
    "ValidateIssuerSigningKey": true,
    "ValidateLifetime": true,
    "RequireSignedTokens": true,
    "RequireExpirationTime": true,
    "RequireAudience": true,
    "ClockSkew": 5,
    "Security": {
      "SecretKeyEncryptionAlgorithm": "",
      "SecretKey": "",
      "Certificate": "",
      "CertificatePassword": "",
      "CertificateEncryptionAlgorithm": "",
      "RefreshTokenEncryptionAlgorithm": ""
    }
  },</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the following list all the configuration fields are described:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>Audience</code>: Represents a valid audience that will be used to check against the token&#8217;s audience.</p>
</li>
<li>
<p><code>Issuer</code>: Represents a valid issuer that will be used to check against the token&#8217;s issuer.</p>
</li>
<li>
<p><code>ValidateIssuer</code>: Boolean that controls if validation of the Issuer is done.</p>
</li>
<li>
<p><code>ValidateIssuerSigningKey</code>: Boolean that controls if validation of the SecurityKey that signed the securityToken is called.</p>
</li>
<li>
<p><code>ValidateLifetime</code>: Boolean to control if the lifetime will be validated during token validation.</p>
</li>
<li>
<p><code>RequireSignedTokens</code>: Boolean that indicates wether a security token has to be signed oe not.</p>
</li>
<li>
<p><code>RequireExpirationTime</code>: Boolean that tells the handler if tokens need an expiration time specified or not.</p>
</li>
<li>
<p><code>RequireAudience</code>: Boolean that indicates tokens need to have an audience specified to be valid or not.</p>
</li>
<li>
<p><code>ClockSkew</code>: Expiration time in minutes.</p>
</li>
<li>
<p><code>Security</code>: Certificate properties will be found in this part.</p>
<div class="ulist">
<ul>
<li>
<p><code>SecretKeyEncryptionAlgorithm</code>: Algorithm used to encrypt the secret key. If no argument is specified, <code>HmacSha512</code> is used.</p>
</li>
<li>
<p><code>SecretKey</code>: Private key used to sign with the certificates. This key will be encrypted and hashed using the specified algorithm.</p>
</li>
<li>
<p><code>Certificate</code>: Name of certificate file or its path (if it is not in the same directory). If it doesn&#8217;t exist an exception will be raised.</p>
</li>
<li>
<p><code>CertificatePassword</code>: Password for the certificate selected.</p>
</li>
<li>
<p><code>CertificateEncryptionAlgorithm</code>: Algorithm used to encrypt the certificate. If no argument is specified, <code>HmacSha512</code> is used.</p>
</li>
<li>
<p><code>RefreshTokenEncryptionAlgorithm</code>: Algorithm used to encrypt the refresh token. If no argument is specified, <code>HmacSha512</code> is used.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>There are two ways of using and creating tokens:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Secret key: A key to encrypt and decrypt the tokens is specified. This key will be encrypted using the specified algorithm.</p>
</li>
<li>
<p>Certificates: A certificate is used to manage token encryption and decryption.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="icon-note" title=""></i>
</td>
<td class="content">
Because the secret key takes precedence over the other option, JWT with the secret key will be used if both configurations are supplied.
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="devonfw-guide_devon4net.wiki_packages.asciidoc_encryption-algorithms">Encryption algorithms</h4>
<div class="paragraph">
<p>The supported and tested algorithms are the following:</p>
</div>
<table class="tableblock frame-all grid-all" style="width: 100%;">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Algorithm</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Value</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>HmacSha256</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HS256</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>HmacSha384</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HS384</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>HmacSha512</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HS512</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>HmacSha256Signature</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://www.w3.org/2001/04/xmldsig-more#hmac-sha256" class="bare">http://www.w3.org/2001/04/xmldsig-more#hmac-sha256</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>HmacSha384Signature</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://www.w3.org/2001/04/xmldsig-more#hmac-sha384" class="bare">http://www.w3.org/2001/04/xmldsig-more#hmac-sha384</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>HmacSha512Signature</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://www.w3.org/2001/04/xmldsig-more#hmac-sha512" class="bare">http://www.w3.org/2001/04/xmldsig-more#hmac-sha512</a></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>For the refresh token encryption algorithm you will be able to use any algoritm from the previous table and the following table:</p>
</div>
<table class="tableblock frame-all grid-all" style="width: 100%;">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Algorithm</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Value</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>MD5</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">MD5</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Sha</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SHA</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="icon-note" title=""></i>
</td>
<td class="content">
You will need to specify the name of the algorithm (shown in 'algorithm' column) when configuring the component.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="icon-note" title=""></i>
</td>
<td class="content">
Please check <a href="https://github.com/AzureAD/azure-activedirectory-identitymodel-extensions-for-dotnet/wiki/Supported-Algorithms">Windows Documentation</a> to get the latest updates on supported encryption algorithms.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="devonfw-guide_devon4net.wiki_packages.asciidoc_setting-up-in-devon">Setting up in Devon</h3>
<div class="paragraph">
<p>For setting it up using the Devon4NetApi template configure it in the <code>appsettings.{environment}.json</code> file.</p>
</div>
<div class="paragraph">
<p>You will need to add a certificate that will be used for signing the token, please check the documentation about how to create a new certificate and add it to a project if you are not aware of how it&#8217;s done.</p>
</div>
<div class="paragraph">
<p>Remember to configure your certificates in the JWT configuration.</p>
</div>
<div class="paragraph">
<p>Navigate to <code>Devon4Net.Application.WebAPI.Implementation.Business.AuthManagement.Controllers</code>. There you will find <code>AuthController</code> sample class which is responsible of generating the token thanks to login method.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="c# language-c#">public AuthController(IJwtHandler jwtHandler)
{
    JwtHandler = jwtHandler;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can see how the <code>IJwtHandler</code> is injected in the constructor via its interface, which allows you to use its methods.</p>
</div>
<div class="paragraph">
<p>In the following piece of code, you will find how the client token is created using a variety of claims. In this case this end-point will be available to not identified clients thanks to the <code>AllowAnonymous</code> attribute. The client will also have a sample role asigned, depending on which it will be able to access some end-points and not others.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="c# language-c#">[AllowAnonymous]
.
.
.
var token = JwtHandler.CreateJwtToken(new List&lt;Claim&gt;
{
    new Claim(ClaimTypes.Role, AuthConst.DevonSampleUserRole),
    new Claim(ClaimTypes.Name,user),
    new Claim(ClaimTypes.NameIdentifier,Guid.NewGuid().ToString()),
});

return Ok(new LoginResponse { Token = token });</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following example will require clients to have the sample role to be able to use the end-point, thanks to the attribute <code>Authorize</code> with the <code>Roles</code> value specified.</p>
</div>
<div class="paragraph">
<p>It also shows how you can obtain information directly from the token using the <code>JwtHandler</code> injection.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="c# language-c#">[Authorize(AuthenticationSchemes = AuthConst.AuthenticationScheme, Roles = AuthConst.DevonSampleUserRole)]
.
.
.
//Get claims
var token = Request.Headers["Authorization"].ToString().Replace($"{AuthConst.AuthenticationScheme} ", string.Empty);
.
.
.
// Return result with claims values
var result = new CurrentUserResponse
{
    Id = JwtHandler.GetClaimValue(userClaims, ClaimTypes.NameIdentifier),
    UserName = JwtHandler.GetClaimValue(userClaims, ClaimTypes.Name),
    CorporateInfo = new List&lt;CorporateBasicInfo&gt;
    {
        new CorporateBasicInfo
        {
            Id = ClaimTypes.Role,
            Value = JwtHandler.GetClaimValue(userClaims, ClaimTypes.Role)
        }
    }
};

return Ok(result);</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="icon-note" title=""></i>
</td>
<td class="content">
Please check devon documentation of Security and Roles to learn more about method attributtes.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="devonfw-guide_devon4net.wiki_packages.asciidoc_setting-up-in-other-projects">Setting up in other projects</h3>
<div class="paragraph">
<p>Install the package on your solution using the Package Manager Console:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="console language-console">&gt; install-package Devon4Net.Infrastructure.JWT</code></pre>
</div>
</div>
<div class="paragraph">
<p>Configure swagger in <code>Program.cs</code> adding the following lines:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="c# language-c#">using Devon4Net.Application.WebAPI.Configuration;
.
.
.
builder.Services.SetupJwt(builder.Configuration);</code></pre>
</div>
</div>
<div class="paragraph">
<p>At this moment you&#8217;ll need to have at least one certificate added to your project.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="icon-note" title=""></i>
</td>
<td class="content">
Please read the documentation of how to create and add certificates to a project.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Now we will configure the JWT component in <code>appsettings.{environment}.json</code> as shown in the next piece of code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="json language-json">"JWT": {
    "Audience": "devon4Net",
    "Issuer": "devon4Net",
    "ValidateIssuer": true,
    "ValidateIssuerSigningKey": true,
    "ValidateLifetime": true,
    "RequireSignedTokens": true,
    "RequireExpirationTime": true,
    "RequireAudience": true,
    "ClockSkew": 5,
    "Security": {
      "SecretKeyLengthAlgorithm": "",
      "SecretKeyEncryptionAlgorithm": "",
      "SecretKey": "",
      "Certificate": "localhost.pfx",
      "CertificatePassword": "12345",
      "CertificateEncryptionAlgorithm": "HmacSha512",
      "RefreshTokenEncryptionAlgorithm": "Sha"
    }
  },</code></pre>
</div>
</div>
<div class="paragraph">
<p>For using it, you will need a method that provides you a token. So lets create an <code>AuthController</code> controller and add those methods:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="c# language-c#">[Route("api/[controller]")]
[ApiController]
public class AuthController : ControllerBase
{
    private readonly IJwtHandler _jwtHandler;

    public AuthController(IJwtHandler jwtHandler)
    {
        _jwtHandler = jwtHandler;
    }

    [HttpGet]
    [Route("/Auth")]
    [AllowAnonymous]
    public IActionResult GetToken()
    {
        var token = _jwtHandler.CreateJwtToken(new List&lt;Claim&gt;
        {
            new Claim(ClaimTypes.Role, "MyRole"),
            new Claim(ClaimTypes.Name, "MyName"),
            new Claim(ClaimTypes.NameIdentifier, Guid.NewGuid().ToString()),
        });
        return Ok(token);
    }

    [HttpGet]
    [Route("/Auth/CheckToken")]
    [Authorize(AuthenticationSchemes = "Bearer", Roles = "MyRole")]
    public IActionResult CheckToken()
    {
        var token = Request.Headers["Authorization"].ToString().Replace($"Bearer ", string.Empty);
        var userClaims = _jwtHandler.GetUserClaims(token).ToList();
        var result = new
        {
            Id = _jwtHandler.GetClaimValue(userClaims, ClaimTypes.NameIdentifier),
            UserName = _jwtHandler.GetClaimValue(token, ClaimTypes.Name),
            Role = _jwtHandler.GetClaimValue(userClaims, ClaimTypes.Role)
        };
        return Ok(result);
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Reading the code of this controller you have to take in mind a few things:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>IJwtHandler</code> class is injected via dependency injection.</p>
<div class="ulist">
<ul>
<li>
<p><code>string CreateClientToken(List&lt;Claim&gt; list)</code> will allow you to create the token through a list of claims. The claims shown are hard-coded examples.</p>
</li>
<li>
<p><code>List&lt;Claim&gt; GetUserClaims(string token)</code> will allow you to get a list of claims given a token.</p>
</li>
<li>
<p><code>string GetClaimValue(List&lt;Claim&gt; list, string claim)</code> will allow you to get the value given the ClaimType and either a list of claims or a token thanks to the <code>string GetClaimValue(string token, string claim)</code> overload.</p>
</li>
</ul>
</div>
</li>
<li>
<p><code>[AllowAnonymous]</code> attribute will allow access any client without authentication.</p>
</li>
<li>
<p><code>[Authorize(AuthenticationSchemes = "Bearer", Roles = "MyRole")]</code> attribute will allow any client authenticated with a bearer token and the role <code>"MyRole"</code>.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="devonfw-guide_devon4net.wiki_packages.asciidoc_references">References</h3>
<div class="ulist">
<ul>
<li>
<p><a href="https://docs.microsoft.com/en-us/dotnet/api/microsoft.identitymodel.tokens.tokenvalidationparameters?view=azure-dotnet">TokenValidationParameterClass - Microsoft Docs</a></p>
</li>
<li>
<p><a href="https://docs.microsoft.com/en-us/dotnet/csharp/programming-guide/concepts/attributes/">Attributtes in C# - Microsoft Docs</a></p>
</li>
<li>
<p><a href="https://github.com/AzureAD/azure-activedirectory-identitymodel-extensions-for-dotnet/wiki/Supported-Algorithms">Algorithms supported</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="devonfw-guide_devon4net.wiki_packages.asciidoc_devon4net.infrastructure.litedb">Devon4Net.Infrastructure.LiteDb</h2>
<div class="sectionbody">
<div class="paragraph">
<p><a href="https://www.litedb.org/">LiteDb</a> is an open-source NoSQL embedded database for .NET. Is a document store inspired by MongoDB database. It stores data in documents, which are JSON objects containing key-value pairs. It uses BSON which is a Binary representation of JSON with additional type information.</p>
</div>
<div class="paragraph">
<p>One of the advantages of using this type of NoSQL database is that it allows the use of asynchronous programming techniques following ACID properties on its transactions. This properties are: Atomicity, Consistency, Isolation and Durability, and they ensure the highest possible data reliability and integrity. This means that you will be able to use <code>async/await</code> on your operations.</p>
</div>
<div class="sect2">
<h3 id="devonfw-guide_devon4net.wiki_packages.asciidoc_configuration">Configuration</h3>
<div class="paragraph">
<p>The component configuration can be done in <code>appsettings.{environment}.json</code> with the following section:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="json language-json">"LiteDb": {
  "EnableLiteDb": true,
  "DatabaseLocation": "devon4net.db"
}</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>EnableLiteDb</code>: Boolean to activate the use of LiteDb.</p>
</li>
<li>
<p><code>DatabaseLocation</code>: Relative path of the file containing all the documents.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="devonfw-guide_devon4net.wiki_packages.asciidoc_setting-up-in-devon">Setting up in Devon</h3>
<div class="paragraph">
<p>For setting it up using the Devon4Net WebApi template just configure it in the <code>appsettings.{environment}.json</code>.</p>
</div>
<div class="paragraph">
<p>Then you will need to inject the repositories. For that go to <code>Devon4Net.Application.WebAPI.Implementation.Configuration.DevonConfiguration</code> and add the folowing lines in <code>SetupDependencyInjection</code> method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="c# language-c#">using Devon4Net.Infrastructure.LiteDb.Repository;
.
.
.
services.AddTransient(typeof(IRepository&lt;&gt;), typeof(Repository&lt;&gt;));</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now you can use the <code>IRepository&lt;T&gt;</code> by injecting it wherever you want to use it. <code>T</code> will be the entity you will be working with in the repository.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="c# language-c#">private readonly IRepository&lt;Todo&gt; _todoRepository;

public TodoController(IRepository&lt;Todo&gt; todoRepository)
{
    _todoRepository = todoRepository;
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="devonfw-guide_devon4net.wiki_packages.asciidoc_setting-up-in-other-projects">Setting up in other projects</h3>
<div class="paragraph">
<p>For setting it up in other projects install it running the following command in the Package Manager Console, or using the Package Manager in Visual Studio:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="console language-console">install-package Devon4Net.Infrastructure.LiteDb</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now set the configuration in the <code>appsettings.{enviroment}.json</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="json language-json">"LiteDb": {
  "EnableLiteDb": true,
  "DatabaseLocation": "devon_database.db"
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="icon-note" title=""></i>
</td>
<td class="content">
Remember to set <code>EnableLiteDb</code> to <code>true</code>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Navigate to your <code>Program.cs</code> file and add the following line to configure the component:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="c# language-c#">using Devon4Net.Application.WebAPI.Configuration;
.
.
.
builder.Services.SetupLiteDb(builder.Configuration);</code></pre>
</div>
</div>
<div class="paragraph">
<p>You will need also to add the repositories you will be using to your services, either by injecting the generic:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="c# language-c#">builder.Services.AddTransient(typeof(IRepository&lt;&gt;), typeof(Repository&lt;&gt;));</code></pre>
</div>
</div>
<div class="paragraph">
<p>Or by choosing to inject them one by one:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="c# language-c#">builder.Services.AddTransient&lt;IRepository&lt;WeatherForecast&gt;, Repository&lt;WeatherForecast&gt;&gt;();</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now you will be able to use the repositories in your class using dependency injection, for example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="c# language-c#">[ApiController]
[Route("[controller]")]
public class WeatherForecastController : ControllerBase
{
    private readonly IRepository&lt;WeatherForecast&gt; _weatherForecastRepository;

    public WeatherForecastController(IRepository&lt;WeatherForecast&gt; weatherForecastRepository)
    {
        _weatherForecastRepository = weatherForecastRepository;
    }

    [HttpGet]
    public IEnumerable&lt;WeatherForecast&gt; Get()
    {
        return _weatherForecastRepository.Get();
    }

    [HttpPost]
    public IEnumerable&lt;WeatherForecast&gt; PostAndGetAll(WeatherForecast weatherForecast)
    {
        _weatherForecastRepository.Create(weatherForecast);
        return _weatherForecastRepository.Get();
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="devonfw-guide_devon4net.wiki_packages.asciidoc_devon4net.infrastructure.kafka">Devon4Net.Infrastructure.Kafka</h2>
<div class="sectionbody">
<div class="paragraph">
<p><a href="https://kafka.apache.org/">Apache Kafka</a> is an open-source distributed event streaming platform. Event streaming is the practice of capturing a stream of events and store it for later being able to retrieve it for processing it in the desired form. It guarantees a continuous flow of data between components in a distributed system. You can think of it as a data bus where components of a system can publish some events and can subscribe to others, the following diagram shows perfectly how the system works:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw.github.io/devonfw.github.io/target/generated-docs/images/kafka.png" alt="kafka">
</div>
<div class="title">Figure 2. Kafka diagram</div>
</div>
<div class="paragraph">
<p>In the image you can see how an event is sent to the Kafka server. This <strong>Event</strong> is a record of an action that happened and typically contains a key, value, timestamp and some metadata.</p>
</div>
<div class="paragraph">
<p>This events are published by <strong>Producers</strong>, who are those client applications that write to Kafka; and readed and processed by <strong>Consumers</strong>, who are the clients subscribed to the different topics.</p>
</div>
<div class="paragraph">
<p><strong>Topics</strong> are the organization type of Kafka events, similar to a folder on a filesystem, being events the files in that folder. Unlike message queues, Kafka events are not deleted after being read. Instead you can choose how much time should Kafka keep track of the events.</p>
</div>
<div class="paragraph">
<p>Other interesting concepts about Kafka are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Partitions</strong>: Topics are divided into partitions. When a new event is published to a topic, it is actually appended to one of the topic&#8217;s partitions. Events with the same event key are written to the same partition.</p>
</li>
<li>
<p><strong>Replication</strong>: To make your data fault-tolerant and highly-available, every topic can be replicated so that there are always multiple brokers that have a copy of the data just in case things go wrong.</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="devonfw-guide_devon4net.wiki_packages.asciidoc_configuration">Configuration</h3>
<div class="paragraph">
<p>The component configuration can be done in <code>appsettings.{environment}.json</code> with the following section:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="json language-json">"Kafka": {
    "EnableKafka": true,
    "Administration": [
      {
        "AdminId": "Admin1",
        "Servers": "127.0.0.1:9092"
      }
    ],
    "Producers": [
      {
        "ProducerId": "Producer1",
        "Servers": "127.0.0.1:9092",
        "ClientId": "client1",
        "Topic": "devonfw",
        "MessageMaxBytes": 1000000,
        "CompressionLevel": -1,
        "CompressionType": "None",
        "ReceiveMessageMaxBytes": 100000000,
        "EnableSslCertificateVerification": false,
        "CancellationDelayMaxMs": 100,
        "Ack": "None",
        "Debug": "",
        "BrokerAddressTtl": 1000,
        "BatchNumMessages": 1000000,
        "EnableIdempotence": false,
        "MaxInFlight": 5,
        "MessageSendMaxRetries": 5,
        "BatchSize": 100000000
      }
    ],
    "Consumers": [
      {
        "ConsumerId": "Consumer1",
        "Servers": "127.0.0.1:9092",
        "GroupId": "group1",
        "Topics": "devonfw",
        "AutoCommit": true,
        "StatisticsIntervalMs": 0,
        "SessionTimeoutMs": 10000,
        "AutoOffsetReset": "Largest",
        "EnablePartitionEof": true,
        "IsolationLevel": "ReadCommitted",
        "EnableSslCertificateVerification": false,
        "Debug": ""
      }
    ]
  }</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>EnableKafka</code>: Boolean to activate the use of Apache Kafka.</p>
</li>
<li>
<p><code>Administration</code>:</p>
<div class="ulist">
<ul>
<li>
<p><code>AdminId</code>: Admin Identifier</p>
</li>
<li>
<p><code>Servers</code>: Host address and port number in the form of <code>host:port</code>.</p>
</li>
</ul>
</div>
</li>
<li>
<p><code>Producers</code>: List of all kafka producers configuration.</p>
<div class="ulist">
<ul>
<li>
<p><code>ProducerId</code>: Identifier of the producer in devon.</p>
</li>
<li>
<p><code>Servers</code>: Host address and port number in the form of <code>host:port</code>.</p>
</li>
<li>
<p><code>ClientId</code>: Identifier of the client in Kafka.</p>
</li>
<li>
<p><code>Topic</code>: Topics where the event will be delivered.</p>
</li>
<li>
<p><code>MessageMaxBytes</code>: Maximum Kafka protocol request message size. Due to differing framing overhead between protocol versions the producer is unable to reliably enforce a strict max message limit at produce time and may exceed the maximum size by one message in protocol ProduceRequests, the broker will enforce the the topic&#8217;s <code>max.message.bytes</code> limit (see Apache Kafka documentation).</p>
</li>
<li>
<p><code>CompressionLevel</code>: Compression level parameter for algorithm selected by configuration property compression.codec. Higher values will result in better compression at the cost of more CPU usage. Usable range is algorithm-dependent:</p>
<div class="paragraph">
<p>[0-9] for gzip; [0-12] for lz4; only 0 for snappy; -1 = codec-dependent</p>
</div>
<div class="paragraph">
<p>Default is <code>-1</code>.</p>
</div>
</li>
<li>
<p><code>CompressionType</code>: compression codec to use for compressing message sets. This is the default value for all topics, may be overridden by the topic configuration property compression.codec. Types are: <code>None</code>, <code>Gzip</code>, <code>Snappy</code>, <code>Lz4</code>, <code>Zstd</code>. Default is <code>None</code>.</p>
</li>
<li>
<p><code>ReceiveMessageMaxBytes</code>: Maximum Kafka protocol response message size. Default is <code>100000000</code>.</p>
</li>
<li>
<p><code>EnableSslCertificateVerification</code>: Enable OpenSSL&#8217;s builtin broker (server) certificate verification. Default is <code>true</code>.</p>
</li>
<li>
<p><code>CancellationDelayMaxMs</code>: The maximum time in milliseconds before a cancellation request is acted on. Low values may result in measurably higher CPU usage. Default is <code>100</code>.</p>
</li>
<li>
<p><code>Ack</code>:</p>
<table class="tableblock frame-all grid-all" style="width: 100%;">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Value</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Description</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>None</code> - default</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Broker does not send any response/ack to client</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Leader</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The leader will write the record to its local log but will respond without awaiting full acknowledgement from all followers</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>All</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Broker will block until message is committed by all in sync replicas (ISRs). If there are less than min.insync.replicas (broker configuration) in the ISR set the produce request will fail</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Default is <code>None</code>.</p>
</div>
</li>
<li>
<p><code>Debug</code>:
A comma-separated list of debug contexts to enable. Detailed Producer debugging: broker,topic,msg. Consumer: consumer,cgrp,topic,fetch</p>
</li>
<li>
<p><code>BrokerAddressTtl</code>: How long to cache the broker address resolving results in milliseconds.</p>
</li>
<li>
<p><code>BatchNumMessages</code>: Maximum size (in bytes) of all messages batched in one MessageSet, including protocol framing overhead. This limit is applied after the first message has been added to the batch, regardless of the first message&#8217;s size, this is to ensure that messages that exceed <code>batch.size</code> are produced. The total MessageSet size is also limited by <code>batch.num.messages</code> and <code>message.max.bytes</code></p>
</li>
<li>
<p><code>EnableIdempotence</code>: When set to <code>true</code>, the producer will ensure that messages are successfully produced exactly once and in the original produce order. The following configuration properties are adjusted automatically (if not modified by the user) when idempotence is enabled: <code>max.in.flight.requests.per.connection=5</code> (must be less than or equal to 5), <code>retries=INT32_MAX</code> (must be greater than 0), <code>acks=all</code>, <code>queuing.strategy=fifo</code>. Producer instantation will fail if user-supplied configuration is incompatible</p>
</li>
<li>
<p><code>MaxInFlight</code>: Maximum number of in-flight requests per broker connection. This is a generic property applied to all broker communication, however it is primarily relevant to produce requests. In particular, note that other mechanisms limit the number of outstanding consumer fetch request per broker to one. Default is <code>5</code>.</p>
</li>
<li>
<p><code>MessageSendMaxRetries</code>: How many times to retry sending a failing Message. Default is <code>5</code>.</p>
</li>
<li>
<p><code>BatchSize</code>: Maximum size (in bytes) of all messages batched in one MessageSet, including protocol framing overhead. This limit is applied after the first message has been added to the batch, regardless of the first message&#8217;s size, this is to ensure that messages that exceed batch.size are produced. The total MessageSet size is also limited by batch.num.messages and <code>message.max.bytes</code>. Default is <code>1000000</code>.</p>
</li>
</ul>
</div>
</li>
<li>
<p><code>Consumers</code>: List of consumers configurations.</p>
<div class="ulist">
<ul>
<li>
<p><code>ConsumerId</code>: Identifier of the consumer for devon.</p>
</li>
<li>
<p><code>Servers</code>: Host address and port number in the form of <code>host:port</code>.</p>
</li>
<li>
<p><code>GroupId</code>: Client group id string. All clients sharing the same group.id belong to the same group.</p>
</li>
<li>
<p><code>Topics</code>: Topics where the event will be read from.</p>
</li>
<li>
<p><code>AutoCommit</code>: Automatically and periodically commit offsets in the background. Note: setting this to false does not prevent the consumer from fetching previously committed start offsets. To circumvent this behaviour set specific start offsets per partition in the call to assign()</p>
</li>
<li>
<p><code>StatisticsIntervalMs</code>: librdkafka statistics emit interval. The application also needs to register a stats callback using <code>rd_kafka_conf_set_stats_cb()</code>. The granularity is 1000ms. A value of 0 disables statistics</p>
</li>
<li>
<p><code>SessionTimeoutMs</code>: Client group session and failure detection timeout. The consumer sends periodic heartbeats (heartbeat.interval.ms) to indicate its liveness to the broker. If no hearts are received by the broker for a group member within the session timeout, the broker will remove the consumer from the group and trigger a rebalance. Default is <code>0</code>.</p>
</li>
<li>
<p><code>AutoOffsetReset</code>: Action to take when there is no initial offset in offset store or the desired offset is out of range: 'smallest','earliest' - automatically reset the offset to the smallest offset, 'largest','latest' - automatically reset the offset to the largest offset, 'error' - trigger an error which is retrieved by consuming messages and checking 'message-&gt;err'</p>
</li>
<li>
<p><code>EnablePartitionEof</code>: Verify CRC32 of consumed messages, ensuring no on-the-wire or on-disk corruption to the messages occurred. This check comes at slightly increased CPU usage</p>
</li>
<li>
<p><code>IsolationLevel</code>: Controls how to read messages written transactionally: <code>ReadCommitted</code> - only return transactional messages which have been committed. <code>ReadUncommitted</code> - return all messages, even transactional messages which have been aborted.</p>
</li>
<li>
<p><code>EnableSslCertificateVerification</code>: Enable OpenSSL&#8217;s builtin broker (server) certificate verification. Default is <code>true</code>.</p>
</li>
<li>
<p><code>Debug</code>: A comma-separated list of debug contexts to enable. Detailed Producer debugging: broker,topic,msg. Consumer: consumer,cgrp,topic,fetch</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="devonfw-guide_devon4net.wiki_packages.asciidoc_setting-up-in-devon">Setting up in Devon</h3>
<div class="paragraph">
<p>For setting it up using the Devon4Net WebApi template just configure it in the <code>appsettings.Development.json</code>. You can do this by copying the previously showed configuration with your desired values.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="icon-note" title=""></i>
</td>
<td class="content">
Please refer to the "How to use Kafka" and "Kafka template" documentation to learn more about Kafka.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="devonfw-guide_devon4net.wiki_packages.asciidoc_setting-up-in-other-projects">Setting up in other projects</h3>
<div class="paragraph">
<p>For setting it up in other projects install it running the following command in the Package Manager Console, or using the Package Manager in Visual Studio:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="console language-console">install-package Devon4Net.Infrastructure.Kafka</code></pre>
</div>
</div>
<div class="paragraph">
<p>This will install all the packages the component needs to work properly. Now set the configuration in the <code>appsettings.{enviroment}.json</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="json language-json">"Kafka": {
    "EnableKafka": true,
    "Administration": [
      {
        "AdminId": "Admin1",
        "Servers": "127.0.0.1:9092"
      }
    ],
    "Producers": [
      {
        "ProducerId": "Producer1",
        "Servers": "127.0.0.1:9092",
        "ClientId": "client1",
        "Topic": "devonfw",
        "MessageMaxBytes": 1000000,
        "CompressionLevel": -1,
        "CompressionType": "None",
        "ReceiveMessageMaxBytes": 100000000,
        "EnableSslCertificateVerification": false,
        "CancellationDelayMaxMs": 100,
        "Ack": "None",
        "Debug": "",
        "BrokerAddressTtl": 1000,
        "BatchNumMessages": 1000000,
        "EnableIdempotence": false,
        "MaxInFlight": 5,
        "MessageSendMaxRetries": 5,
        "BatchSize": 100000000
      }
    ],
    "Consumers": [
      {
        "ConsumerId": "Consumer1",
        "Servers": "127.0.0.1:9092",
        "GroupId": "group1",
        "Topics": "devonfw",
        "AutoCommit": true,
        "StatisticsIntervalMs": 0,
        "SessionTimeoutMs": 10000,
        "AutoOffsetReset": "Largest",
        "EnablePartitionEof": true,
        "IsolationLevel": "ReadCommitted",
        "EnableSslCertificateVerification": false,
        "Debug": ""
      }
    ]
  }</code></pre>
</div>
</div>
<div class="paragraph">
<p>Navigate to your <code>Program.cs</code> file and add the following lines to configure the component:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="c# language-c#">using Devon4Net.Application.WebAPI.Configuration;
.
.
.
builder.Services.SetupKafka(builder.Configuration);</code></pre>
</div>
</div>
<div class="paragraph">
<p>As you will be able to tell, the process is very similar to installing other components. Doing the previous actions will allow you to use the different handlers available with kafka. You can learn more</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="icon-note" title=""></i>
</td>
<td class="content">
Please refer to the "How to use Kafka" and "Kafka template" documentation to learn more about Kafka.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="devonfw-guide_devon4net.wiki_packages.asciidoc_devon4net.infrastructure.grpc">Devon4Net.Infrastructure.Grpc</h2>
<div class="sectionbody">
<div class="paragraph">
<p>As you may know at this point in Grpc communication two parties are involved: the client and the server. The server provides an implementation of a service that the client can access. Both have access to a file that acts as a contract between them, this way each of them can be written in a different language. This file is the protocol buffer.</p>
</div>
<div class="paragraph">
<p>To learn more you can read "Grpc Template" and "How to use Grpc" in devon documentation or forward to <a href="https://grpc.io/">gRPC official site</a>.</p>
</div>
<div class="sect2">
<h3 id="devonfw-guide_devon4net.wiki_packages.asciidoc_configuration">Configuration</h3>
<div class="sect3">
<h4 id="devonfw-guide_devon4net.wiki_packages.asciidoc_grpc-server">Grpc server</h4>
<div class="paragraph">
<p>The server does not need any type of specific configuration options other than the certificates, headers or other components that need to be used in the same project.</p>
</div>
</div>
<div class="sect3">
<h4 id="devonfw-guide_devon4net.wiki_packages.asciidoc_grpc-client">Grpc Client</h4>
<div class="paragraph">
<p>On the other hand, the client needs the following configuration on the <code>appsettings.{environment}.json</code> file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="json language-json">"Grpc" : {
    "EnableGrpc": true,
    "UseDevCertificate": true,
    "GrpcServer": "https://localhost:5002",
    "MaxReceiveMessageSize": 16,
    "RetryPatternOptions": {
      "MaxAttempts": 5,
      "InitialBackoffSeconds": 1,
      "MaxBackoffSeconds": 5,
      "BackoffMultiplier": 1.5,
      "RetryableStatus": "Unavailable"
    }
}</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>EnableGrpc</code>: Boolean to enable the use of Grpc component.</p>
</li>
<li>
<p><code>UseDevCertificate</code>: Boolean to bypass validation of client certificate. Only for development purposes.</p>
</li>
<li>
<p><code>GrpcServer</code>: Grpc server host and port number in the form of <code>Host:Port</code></p>
</li>
<li>
<p><code>MaxReceiveMessageSize</code>: Maximum size of message that can be received by the server in MB.</p>
</li>
<li>
<p><code>RetryPatternOptions</code>: Options for the retry pattern applied when communicating with the server.</p>
<div class="ulist">
<ul>
<li>
<p><code>MaxAttempts</code>: Maximum number of communication attempts.</p>
</li>
<li>
<p><code>InitialBackoffSeconds</code>: Initial delay time for next try in seconds. A randomized delay between 0 and the current backoff value will determine when the next retry attempt is made.</p>
</li>
<li>
<p><code>MaxBackoffSeconds</code>: Maximum time in seconds that work as an upper limit on exponential backoff growth.</p>
</li>
<li>
<p><code>BackoffMultiplier</code>: The backoff time will be multiplied by this number in its growth.</p>
</li>
<li>
<p><code>RetryableStatus</code>: Status of the requests that may be retried.</p>
<table class="tableblock frame-all grid-all" style="width: 100%;">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Status</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Code</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OK</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cancelled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Unknown</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">InvalidArgument</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">DeadlineExceeded</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">NotFound</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">AlreadyExists</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">6</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">PermissionDenied</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">7</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Unauthenticated</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x10</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ResourceExhausted</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">FailedPrecondition</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">9</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Aborted</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">10</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OutOfRange</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">11</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Unimplemented</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">12</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Internal</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">13</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Unavailable</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">14</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">DataLoss</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0xF</p></td>
</tr>
</tbody>
</table>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="devonfw-guide_devon4net.wiki_packages.asciidoc_setting-up-in-devon">Setting up in Devon</h3>
<div class="sect3">
<h4 id="devonfw-guide_devon4net.wiki_packages.asciidoc_grpc-server">Grpc Server</h4>
<div class="paragraph">
<p>For setting up a Grpc server in a devon project you will need to first create the service that implements the contract specified in the proto file. Below an example of service is shown:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="c# language-c#">[GrpcDevonServiceAttribute]
public class GreeterService : Greeter.GreeterBase
{
    public GreeterService() { }

    public override Task&lt;HelloReply&gt; SayHello(HelloRequest request, ServerCallContext context)
    {
        return Task.FromResult(new HelloReply
        {
            Message = "Hello " + request.Name
        });
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This previous example of service will be extending the following protocol buffer (<code>.proto</code> file):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="proto language-proto">syntax = "proto3";
option csharp_namespace = "Devon4Net.Application.GrpcServer.Protos";
package greet;

service Greeter {
  rpc SayHello (HelloRequest) returns (HelloReply);
}

message HelloRequest {
  string name = 1;
}

message HelloReply {
  string message = 1;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Once you have all your services created you will need to add them as Grpc services on your server. All of the services marked with the <code>GrpcDevonService</code> attribute will be automatically added, but you need to specify the assembly names where they are implemented. For that you can modify the following lines in the <code>Program.cs</code> file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="c# language-c#">app.SetupGrpcServices(new List&lt;string&gt; { "Devon4Net.Application.GrpcServer" });</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>SetupGrpcServices</code> method will accept a list of assembly names so feel free to organize your code as desired.</p>
</div>
</div>
<div class="sect3">
<h4 id="devonfw-guide_devon4net.wiki_packages.asciidoc_grpc-client">Grpc Client</h4>
<div class="paragraph">
<p>In the client side, you will need to add the configuration with your own values on the <code>appsettings.{environment}.json</code> file, for that copy the configuration JSON shown in the previous part and add your own values.</p>
</div>
<div class="paragraph">
<p>Everything is ready if you are using the template. So next step will be use the GrpcChanel via dependency injection and use the service created before as shown:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="c# language-c#">[ApiController]
[Route("[controller]")]
public class GrpcGreeterClientController : ControllerBase
{
    private GrpcChannel GrpcChannel { get; }

    public GrpcGreeterClientController(GrpcChannel grpcChannel)
    {
        GrpcChannel = grpcChannel;
    }

    [HttpGet]
    [ProducesResponseType(typeof(HelloReply), StatusCodes.Status200OK)]
    [ProducesResponseType(StatusCodes.Status400BadRequest)]
    [ProducesResponseType(StatusCodes.Status404NotFound)]
    [ProducesResponseType(StatusCodes.Status500InternalServerError)]
    public async Task&lt;HelloReply&gt; Get(string name)
    {
        try
        {
            var client = new Greeter.GreeterClient(GrpcChannel);
            return await client.SayHelloAsync(new HelloRequest { Name = name }).ResponseAsync.ConfigureAwait(false);
        }
        catch (Exception ex)
        {
            Devon4NetLogger.Error(ex);
            throw;
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="devonfw-guide_devon4net.wiki_packages.asciidoc_setting-up-in-other-projects">Setting up in other projects</h3>
<div class="sect3">
<h4 id="devonfw-guide_devon4net.wiki_packages.asciidoc_grpc-server">Grpc Server</h4>
<div class="paragraph">
<p>For setting up a Grpc server in other projects you will need to install the component running the following command in the Package Manager Console, or using the Package Manager in Visual Studio:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="console language-console">install-package Devon4Net.Infrastructure.Grpc</code></pre>
</div>
</div>
<div class="paragraph">
<p>This will install all the packages the component needs to work properly. Navigate to your <code>Program.cs</code> file and add the following lines to configure the component.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="c# language-c#">using Devon4Net.Infrastructure.Grpc;
.
.
.
builder.Services.AddGrpc();</code></pre>
</div>
</div>
<div class="paragraph">
<p>You will need to add the assembly names for the services you created in the following line, so they can be automatically deployed to your server:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="c# language-c#">app.SetupGrpcServices(new List&lt;string&gt; { "Devon4Net.Application.GrpcServer" });</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="icon-note" title=""></i>
</td>
<td class="content">
Please refer to "Grpc template" and "How to use Grpc" documentation to learn more.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="devonfw-guide_devon4net.wiki_packages.asciidoc_grpc-client">Grpc Client</h4>
<div class="paragraph">
<p>For setting up a Grpc client in other projects you will need to install the component running the following command in the Package Manager Console, or using the Package Manager in Visual Studio:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="console language-console">install-package Devon4Net.Infrastructure.Grpc</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now set the configuration in the <code>appsettings.{enviroment}.json</code> file as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="json language-json">"Grpc" : {
    "EnableGrpc": true,
    "UseDevCertificate": true,
    "GrpcServer": "https://localhost:5002",
    "MaxReceiveMessageSize": 16,
    "RetryPatternOptions": {
      "MaxAttempts": 5,
      "InitialBackoffSeconds": 1,
      "MaxBackoffSeconds": 5,
      "BackoffMultiplier": 1.5,
      "RetryableStatus": "Unavailable"
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Navigate to your <code>Program.cs</code> file and add the following lines to configure the component:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="c# language-c#">using Devon4Net.Infrastructure.Grpc;
.
.
.
builder.Services.SetupGrpc(builder.Configuration);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Following this steps will allow you to use <code>GrpcChannel</code> via dependency injection in your classes, so you can call any procedure through Grpc communication.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="devonfw-guide_devon4net.wiki_packages.asciidoc_devon4net.infrastructure.fluentvalidation">Devon4Net.Infrastructure.FluentValidation</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Validation is an automatic check to ensure that data entered is sensible and feasible.
It is critical to add validation for data inputs when programming.
This avoids unexpected or anomalous data from crashing your application and from obtaining unrealistic garbage outputs.</p>
</div>
<div class="paragraph">
<p>In the following table some validation methods are described:</p>
</div>
<table class="tableblock frame-all grid-all" style="width: 100%;">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Validation Method</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Description</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Range check</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Checks if the data is inside a given range.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Type check</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Checks that the data entered is of an expected type</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Length check</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Checks the number of characters meets expectations</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Presence check</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Checks that the user has at least inputted something</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Check digit</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An additional digit added to a number that is computed from the other digits; this verifies that the remainder of the number has been input correctly.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>FluentValidation is a.NET library that allows users to create strongly-typed validation rules.</p>
</div>
<div class="sect2">
<h3 id="devonfw-guide_devon4net.wiki_packages.asciidoc_setting-up-in-devon">Setting up in Devon</h3>
<div class="paragraph">
<p>To establish a set of validation criteria for a specific object, build a class that inherits from <code>CustomFluentValidator&lt;T&gt;</code>, where <code>T</code> is the type of class to validate. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="c# language-c#">public class EmployeeFluentValidator : CustomFluentValidator&lt;Employee&gt;
    {
    }</code></pre>
</div>
</div>
<div class="paragraph">
<p>Where Employee is the class to validate.</p>
</div>
<div class="paragraph">
<p>Create a constructor for this class that will handle validation exceptions, and override the CustomValidate() method from the <code>CustomFluentValidator&lt;T&gt;</code> class to include the validation rules.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="c# language-c#">public class EmployeeFluentValidator : CustomFluentValidator&lt;Employee&gt;
    {
        /// &lt;summary&gt;
        ///
        /// &lt;/summary&gt;
        /// &lt;param name="launchExceptionWhenError"&gt;&lt;/param&gt;
        public EmployeeFluentValidator(bool launchExceptionWhenError) : base(launchExceptionWhenError)
        {
        }

        /// &lt;summary&gt;
        ///
        /// &lt;/summary&gt;
        public override void CustomValidate()
        {
            RuleFor(Employee =&gt; Employee.Name).NotNull();
            RuleFor(Employee =&gt; Employee.Name).NotEmpty();
            RuleFor(Employee =&gt; Employee.SurName).NotNull();
            RuleFor(Employee =&gt; Employee.Surname).NotEmpty();
        }
    }</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this example, we want Employee entity to not accept Null or empty data.
We can notice this error if we do not enter the needed data:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw.github.io/devonfw.github.io/target/generated-docs/images/fluent-validation-error.png" alt="fluent validation error">
</div>
<div class="title">Figure 3. Fluent Validation exceptions</div>
</div>
<div class="paragraph">
<p>We can also develop Custom Validators by utilizing the Predicate Validator to define a custom validation function.
In the example above we can add:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="c# language-c#"> RuleFor(x =&gt; x.Todos).Must(list =&gt; list.Count &lt; 10)
      .WithMessage("The list must contain fewer than 10 items");</code></pre>
</div>
</div>
<div class="paragraph">
<p>This rule restricts the Todo List from having more than ten items.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="icon-note" title=""></i>
</td>
<td class="content">
For more information about Validators (Rules, Custom Validators, etc&#8230;&#8203;) please refer to this <a href="https://docs.fluentvalidation.net/en/latest/built-in-validators.html">link</a>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="devonfw-guide_devon4net.wiki_packages.asciidoc_setting-up-in-other-projects">Setting up in other projects</h3>
<div class="paragraph">
<p>Install the package on your solution using the Package Manager Console:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="console language-console">install-package Devon4Net.Infrastructure.FluentValidation</code></pre>
</div>
</div>
<div class="paragraph">
<p>Follow the instructions described in the previous section.</p>
</div>
</div>
<div class="sect2">
<h3 id="devonfw-guide_devon4net.wiki_packages.asciidoc_references">References</h3>
<div class="ulist">
<ul>
<li>
<p><a href="https://fluentvalidation.net/">FluentValidation Documentation</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="devonfw-guide_devon4net.wiki_packages.asciidoc_devon4net.infrastructure.common">Devon4Net.Infrastructure.Common</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Library that contains common classes to manage the web api template configuration.</p>
</div>
<div class="paragraph">
<p>The main classes are described in the table below:</p>
</div>
<table class="tableblock frame-all grid-all" style="width: 100%;">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Folder</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Classes</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Description</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Common</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">AutoRegisterData.cs</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Contains the data supplied between the various stages of the AutoRegisterDi extension methods</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Http</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ProtocolOperation.cs</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Contains methods to obtain the Http or Tls protocols</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">IO</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">FileOperations.cs</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Contains methods for managing file operations.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Constants</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">AuthConst.cs</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Default values for AuthenticationScheme property in the JwtBearerAuthenticationOptions</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enums</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">MediaType.cs</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Static class providing constants for different media types for the CircuitBreaker Handlers.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Exceptions</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HttpCustomRequestException.cs</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Public class that enables to create Http Custom Request Exceptions</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Exceptions</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">IWebApiException.cs</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Interface for webapi exceptions</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Handlers</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">OptionsHandler.cs</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Class with a method for retrieving the configuration of the components implementing the <a href="https://docs.microsoft.com/en-us/aspnet/core/fundamentals/configuration/options?view=aspnetcore-6.0">options pattern</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Helpers</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">AutoRegisterHelpers.cs</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Contains the extension methods for registering classes automatically</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Helpers</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">StaticConstsHelper.cs</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Assists in the retrieval of an object&#8217;s value through reflection</p></td>
</tr>
</tbody>
</table>
<div class="sect2">
<h3 id="devonfw-guide_devon4net.wiki_packages.asciidoc_options-pattern">Options pattern</h3>
<div class="paragraph">
<p>The options pattern uses classes to provide strongly typed access to groups of related settings.</p>
</div>
<div class="paragraph">
<p>It is usually preferable to have a group of related settings packed together in a highly typed object rather than simply a plain key-value pair collection.</p>
</div>
<div class="paragraph">
<p>For the other hand strong typing will always ensure that the configuration settings have the required data types.</p>
</div>
<div class="paragraph">
<p>Keeping related settings together ensures that the code meets two crucial design criteria: <a href="https://docs.microsoft.com/en-us/dotnet/csharp/fundamentals/tutorials/oop">encapsulation</a> and <a href="https://docs.microsoft.com/en-us/dotnet/architecture/modern-web-apps-azure/architectural-principles#:~:text=Separation%20of%20concerns&amp;text=This%20principle%20asserts%20that%20software,to%20make%20them%20more%20noticeable">separation of concerns</a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="icon-note" title=""></i>
</td>
<td class="content">
If you require more information of the options pattern, please see <a href="https://docs.microsoft.com/en-us/aspnet/core/fundamentals/configuration/options?view=aspnetcore-6.0">the official Microsoft documentation.</a>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>On this component, we have an <strong>Options folder</strong> that has the classes with all the attributes that store all of the configuration parameters.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="devonfw-guide_devon4net.wiki_packages.asciidoc_devon4net.infrastructure.extensions">Devon4Net.Infrastructure.Extensions</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Miscellaneous extension library which contains :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>ObjectTypeHelper</p>
</li>
<li>
<p>JsonHelper</p>
</li>
<li>
<p>GuidExtension</p>
</li>
<li>
<p>HttpContextExtensions</p>
</li>
<li>
<p>HttpRequestExtensions</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="devonfw-guide_devon4net.wiki_packages.asciidoc_objecttypehelper">ObjectTypeHelper</h3>
<div class="paragraph">
<p>Provides a method for converting an instance of an object in the type of an object of a specified class name.</p>
</div>
</div>
<div class="sect2">
<h3 id="devonfw-guide_devon4net.wiki_packages.asciidoc_jsonhelper-json-serializer">JsonHelper (Json Serializer)</h3>
<div class="paragraph">
<p>Serialization is the process of transforming an object&#8217;s state into a form that can be saved or transmitted.
Deserialization is the opposite of serialization in that it transforms a stream into an object.
These procedures, when combined, allow data to be stored and transferred.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="icon-note" title=""></i>
</td>
<td class="content">
More information about serializacion may be found in the official <a href="https://docs.microsoft.com/en-us/dotnet/standard/serialization/">Microsoft documentation.</a>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>This helper is used in the devon4net components <code>CircuitBreaker</code>, <code>MediatR</code>, and <code>RabbitMQ</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="devonfw-guide_devon4net.wiki_packages.asciidoc_guidextension">GuidExtension</h3>
<div class="paragraph">
<p>This class has basic methods for managing GUIDs. Some devon4net components, such as <code>MediatR</code> or <code>RabbitMQ</code>, implement it in their Backup Services.</p>
</div>
</div>
<div class="sect2">
<h3 id="devonfw-guide_devon4net.wiki_packages.asciidoc_httpcontextextensions">HttpContextExtensions</h3>
<div class="paragraph">
<p>Provides methods for managing response headers for example:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>TryAddHeader</code> method is used on <code>devon4Net.Infrastructure.Middleware</code> component to add automatically response header options such authorization.</p>
</li>
<li>
<p><code>TryRemoveHeader</code> method is used on <code>devon4Net.Infrastructure.Middleware</code> component to remove automatically response header such AspNetVersion header.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="devonfw-guide_devon4net.wiki_packages.asciidoc_httprequestextensions">HttpRequestExtensions</h3>
<div class="paragraph">
<p>Provides methods for obtaining Culture and Language information from a <code>HttpRequest</code> object.</p>
</div>
</div>
<div class="sect2">
<h3 id="devonfw-guide_devon4net.wiki_packages.asciidoc_configuration">Configuration</h3>
<div class="paragraph">
<p>Install the package on your solution via Package Manager Console by running the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="console language-console">Install-Package devon4Net.Infrastructure.Extensions</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="devonfw-guide_devon4net.wiki_packages.asciidoc_devon4net.infrastructure.mediatr">Devon4Net.Infrastructure.MediatR</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This component employs the <code>MediatR</code> library, which is a tool for implementing CQRS and Mediator patterns in .Net.
<code>MediatR</code> handles the decoupling of the in-process sending of messages from handling messages.</p>
</div>
<div class="sect2">
<h3 id="devonfw-guide_devon4net.wiki_packages.asciidoc_patterns">Patterns</h3>
<div class="ulist">
<ul>
<li>
<p>Mediator pattern:</p>
<div class="paragraph">
<p>The <a href="https://docs.microsoft.com/en-us/dotnet/architecture/microservices/microservice-ddd-cqrs-patterns/microservice-application-layer-implementation-web-api">mediator pattern</a> is a behavioral design pattern that aids in the reduction of object dependencies. The pattern prevents the items from communicating directly with one another, forcing them to collaborate only through a mediator object. Mediator is used to decrease the communication complexity between multiple objects or classes. This pattern offers a mediator class that manages all communications between distinct classes and allows for easy code maintenance through loose coupling.</p>
</div>
</li>
<li>
<p>CQRS pattern:</p>
<div class="paragraph">
<p>The acronym <a href="https://docs.microsoft.com/en-us/dotnet/architecture/microservices/microservice-ddd-cqrs-patterns/apply-simplified-microservice-cqrs-ddd-patterns">CQRS</a> stands for Command and Query Responsibility Segregation, and it refers to a design that separates read and update processes for data storage.
By incorporating CQRS into your application, you may improve its performance, scalability, and security.
The flexibility gained by moving to CQRS enables a system to grow more effectively over time and prevents update instructions from triggering merge conflicts at the domain level.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw.github.io/devonfw.github.io/target/generated-docs/images/CQRS.png" alt="CQRS">
</div>
<div class="title">Figure 4. CQRS Diagram</div>
</div>
<div class="paragraph">
<p>In this figure, we can see how we may implement this design by utilizing a Relational Database for Write operations and a <a href="https://docs.microsoft.com/en-us/azure/architecture/patterns/materialized-view">Materialized view</a> of this Database that is synchronized and updated via events.</p>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="devonfw-guide_devon4net.wiki_packages.asciidoc_key-classes">Key Classes</h3>
<div class="paragraph">
<p>In <code>MediatR</code>, you build a basic class that is identified as an implementation of the IRequest or IAsyncRequest interface.
All of the properties that are required to be in the message will be defined in your message class.</p>
</div>
<div class="paragraph">
<p>In the case of this component the messages are created in the <code>ActionBase&lt;T&gt;</code> class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="c# language-c#">public class ActionBase&lt;T&gt; : IRequest&lt;T&gt; where T : class
    {
        public DateTime Timestamp { get; }
        public string MessageType { get; }
        public Guid InternalMessageIdentifier { get; }

        protected ActionBase()
        {
            Timestamp = DateTime.Now;
            InternalMessageIdentifier = Guid.NewGuid();
            MessageType = GetType().Name;
        }
    }</code></pre>
</div>
</div>
<div class="paragraph">
<p>This <code>ActionBase&lt;T&gt;</code> class is then inherited by the <code>CommandBase&lt;T&gt;</code> and <code>QueryBase&lt;T&gt;</code> classes.</p>
</div>
<div class="paragraph">
<p>Now that we&#8217;ve built a request message, we can develop a handler to reply to any messages of that type. We must implement the <code>IRequestHandler</code> or <code>IAsyncRequestHandler</code> interfaces, describing the input and output types.</p>
</div>
<div class="paragraph">
<p>In the case of this component <code>MediatrRequestHandler&lt;TRequest, TResponse&gt;</code> abstract class is used for making this process generecic</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="c# language-c#">public abstract class MediatrRequestHandler&lt;TRequest, TResponse&gt; : IRequestHandler&lt;TRequest, TResponse&gt; where TRequest : IRequest&lt;TResponse&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>This interface defines a single method called Handle, which returns a Task of your output type.
This expects your request message object as an argument. In the <code>MediatrRequestHandler&lt;TRequest, TResponse&gt;</code> class has been implemented in this way.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="c# language-c#">public async Task&lt;TResponse&gt; Handle(TRequest request, CancellationToken cancellationToken)
        {
            MediatrActions status;
            TResponse result = default;
            try
            {
                result = await HandleAction(request, cancellationToken).ConfigureAwait(false);
                status = MediatrActions.Handled;
            }
            catch (Exception ex)
            {
                Devon4NetLogger.Error(ex);
                status = MediatrActions.Error;
            }
            await BackUpMessage(request, status).ConfigureAwait(false);
            return result;
        }</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>HandleAction</code> method is defined in the following lines:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="c# language-c#">public abstract Task&lt;TResponse&gt; HandleAction(TRequest request, CancellationToken cancellationToken);</code></pre>
</div>
</div>
<div class="paragraph">
<p>This method should be overridden in the application&#8217;s business layer Handlers.</p>
</div>
</div>
<div class="sect2">
<h3 id="devonfw-guide_devon4net.wiki_packages.asciidoc_configuration">Configuration</h3>
<div class="paragraph">
<p>Component configuration is made on file <code>appsettings.{environment}.json</code> as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="json language-json">  "MediatR": {
    "EnableMediatR": true,
    "Backup": {
      "UseLocalBackup": true,
      "DatabaseName": "devon4netMessageBackup.db"
    }
  },</code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all" style="width: 100%;">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Property</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Description</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">EnableMediatR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">True for enabling the use of MediatR component</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">UseLocalBackup</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">True for using a LiteDB database as a local backup for the <code>MediatR</code> messages</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">DatabaseName</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The name of the LiteDB database</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="devonfw-guide_devon4net.wiki_packages.asciidoc_setting-up-in-devon">Setting up in Devon</h3>
<div class="paragraph">
<p>For setting it up using the Devon4NetApi template just configure it in the <code>appsettings.{environment}.json</code> file.</p>
</div>
<div class="paragraph">
<p>A template is available in the MediatRManagement folder of the <code>Devon4Net.Application.WebAPI.Implementation</code> Business Layer:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw.github.io/devonfw.github.io/target/generated-docs/images/MediatR-management.png" alt="MediatR management">
</div>
<div class="title">Figure 5. MediatR Management Folder Structure</div>
</div>
<div class="paragraph">
<p>As we can see, this example adheres to the CQRS pattern structure, with Commands for writing methods and Queries for reading operations, as well as one handler for each method:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>CreateTodoCommand.cs</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="c# language-c#"> public class CreateTodoCommand : CommandBase&lt;TodoResultDto&gt;
    {
        public string Description { get; set; }

        public CreateTodoCommand(string description)
        {
            Description = description;
        }
    }</code></pre>
</div>
</div>
<div class="paragraph">
<p>The CreateTodoCommand inherits from <code>CommandBase&lt;T&gt;</code>, in this situation, the request message&#8217;s additional properties, such as <code>Description</code> of the <code>Todo</code> entity, will be included.</p>
</div>
</li>
<li>
<p><code>GetTodoQuery.cs</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="c# language-c#">public class GetTodoQuery : QueryBase&lt;TodoResultDto&gt;
    {
        public long TodoId{ get; set; }

        public GetTodoQuery(long todoId)
        {
            TodoId = todoId;
        }
    }</code></pre>
</div>
</div>
<div class="paragraph">
<p>Because GetTodoQuery inherits from <code>QueryBase&lt;T&gt;</code>, an <code>TodoId</code> of the <code>Todo</code> object will be attached to the message&#8217;s properties in this case.</p>
</div>
</li>
<li>
<p><code>CreateTodoHandler.cs</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="c# language-c#">public class CreateTodoHandler : MediatrRequestHandler&lt;CreateTodoCommand, TodoResultDto&gt;
    {
        private ITodoService TodoService { get; set; }

        public CreateTodoHandler(ITodoService todoService, IMediatRBackupService mediatRBackupService, IMediatRBackupLiteDbService mediatRBackupLiteDbService) : base(mediatRBackupService, mediatRBackupLiteDbService)
        {
            Setup(todoService);
        }

        public CreateTodoHandler(ITodoService todoService, IMediatRBackupLiteDbService mediatRBackupLiteDbService) : base(mediatRBackupLiteDbService)
        {
            Setup(todoService);
        }

        public CreateTodoHandler(ITodoService todoService, IMediatRBackupService mediatRBackupService) : base(mediatRBackupService)
        {
            Setup(todoService);
        }

        private void Setup(ITodoService todoService)
        {
            TodoService = todoService;
        }

        public override async Task&lt;TodoResultDto&gt; HandleAction(CreateTodoCommand request, CancellationToken cancellationToken)
        {

            var result = await TodoService.CreateTodo(request.Description).ConfigureAwait(false);

            return new TodoResultDto
            {
                Id = result.Id,
                Done = result.Done,
                Description = result.Description
            };

        }
    }</code></pre>
</div>
</div>
<div class="paragraph">
<p>This class must to inherit from <code>MediatrRequestHandler&lt;TRequest, TResponse&gt;</code> class that is explained above.
On first place we inject the TodoService via dependency injection using the <code>Setup(ITodoService todoService)</code> method, and then we overload the <code>HandleAction(TRequest request, CancellationToken cancellationToken)</code> method calling the service and returning the new DTO</p>
</div>
</li>
<li>
<p><code>GetTodoHandler.cs</code>:</p>
<div class="paragraph">
<p>All handlers may be configured using the same structure as <code>CreateTodoHandler.cs.</code> To do the required operation, just change the method called by the service.</p>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="devonfw-guide_devon4net.wiki_packages.asciidoc_setting-up-in-other-projects">Setting up in other projects</h3>
<div class="paragraph">
<p>Install the package in your solution using the Package Manager Console:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="console language-console">Install-Package Devon4Net.Infrastructure.MediatR</code></pre>
</div>
</div>
<div class="paragraph">
<p>Create a Configuration static class in order to add the <code>IRequestHandler</code> services, for example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="c# language-c#"> public static class Configuration
    {

        public static void SetupDependencyInjection(this IServiceCollection services, IConfiguration configuration)
        {

            var mediatR = serviceProvider.GetService&lt;IOptions&lt;MediatROptions&gt;&gt;();

            if (mediatR?.Value != null &amp;&amp; mediatR.Value.EnableMediatR)
            {
                SetupMediatRHandlers(services);
            }
        }

        private static void SetupMediatRHandlers(IServiceCollection services)
        {
            services.AddTransient(typeof(IRequestHandler&lt;GetTodoQuery, TodoResultDto&gt;), typeof(GetTodoHandler));
            services.AddTransient(typeof(IRequestHandler&lt;CreateTodoCommand, TodoResultDto&gt;), typeof(CreateTodoHandler));
        }
    }</code></pre>
</div>
</div>
<div class="paragraph">
<p>Add the following lines in the <code>Program.cs</code> class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="c# language-c#">builder.Services.SetupMediatR(builder.Configuration);
builder.Services.SetupDependencyInjection(builder.Configuration);</code></pre>
</div>
</div>
<div class="paragraph">
<p>After adding the default settings provided in the configuration section, you may use the MediatR component in your code.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="devonfw-guide_devon4net.wiki_packages.asciidoc_devon4net.infrastructure.rabbitmq">Devon4Net.Infrastructure.RabbitMQ</h2>
<div class="sectionbody">
<div class="paragraph">
<p><code>RabbitMQ</code> is an open-source message-broker software (also known as message-oriented middleware) that was developed to support the Advanced Message Queuing Protocol (AMQP) and has since been expanded with a plug-in architecture to support the Streaming Text Oriented Messaging Protocol (STOMP), MQ Telemetry Transport (MQTT), and <a href="https://www.rabbitmq.com/protocols.html">other protocols</a>.</p>
</div>
<div class="paragraph">
<p>In <code>RabbitMQ</code>, queues are defined to store messages sent by producers until they are received and processed by consumer applications.</p>
</div>
<div class="sect2">
<h3 id="devonfw-guide_devon4net.wiki_packages.asciidoc_patterns">Patterns</h3>
<div class="ulist">
<ul>
<li>
<p>Publisher-Subscriber pattern</p>
<div class="paragraph">
<p>Publish-Subscribe is a design pattern that allows loose coupling between the application components.</p>
</div>
<div class="paragraph">
<p>Message senders, known as publishers, do not configure the messages to be sent directly to specific receivers, known as subscribers.
Messages are released with no information of what they are or if any subscribers to that information exist.
Delegate is the core of this C# design pattern.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw.github.io/devonfw.github.io/target/generated-docs/images/publish-suscribe.png" alt="publish suscribe">
</div>
<div class="title">Figure 6. RabbitMQ Queue system</div>
</div>
<div class="paragraph">
<p>To summarize :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A producer is a user application that sends messages.</p>
</li>
<li>
<p>A queue is a buffer that stores messages.</p>
</li>
<li>
<p>A consumer is a user application that receives messages.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="devonfw-guide_devon4net.wiki_packages.asciidoc_key-classes">Key Classes</h3>
<div class="paragraph">
<p>In the case of this component the messages are created in the <code>Message</code> abstract class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="c# language-c#">public abstract class Message
    {
        public string MessageType { get; }
        public Guid InternalMessageIdentifier { get; set; }

        protected Message()
        {
            MessageType = GetType().Name;
        }
    }</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then the <code>Command</code> serializable class inherits from <code>Message</code> class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="c# language-c#">[Serializable]
public class Command : Message
    {
        public DateTime Timestamp { get; protected set; }
        protected Command()
        {
            Timestamp = DateTime.Now;
            InternalMessageIdentifier = Guid.NewGuid();
        }
    }</code></pre>
</div>
</div>
<div class="paragraph">
<p>The message will have from base a Timestamp, a Guid as message identifier and the message type.</p>
</div>
</div>
<div class="sect2">
<h3 id="devonfw-guide_devon4net.wiki_packages.asciidoc_configuration">Configuration</h3>
<div class="paragraph">
<p>Component configuration is made on file <code>appsettings.{environment}.json</code> as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="json language-json">  "RabbitMq": {
    "EnableRabbitMq": true,
    "Hosts": [
      {
        "Host": "127.0.0.1",
        "Port": 5672,
        "Ssl": false,
        "SslServerName": "localhost",
        "SslCertPath": "localhost.pfx",
        "SslCertPassPhrase": "localhost",
        "SslPolicyErrors": "RemoteCertificateNotAvailable" //None, RemoteCertificateNotAvailable, RemoteCertificateNameMismatch, RemoteCertificateChainErrors
      }
    ],

    "VirtualHost": "/",
    "UserName": "admin",
    "Password": "password",
    "Product": "devon4net",
    "RequestedHeartbeat": 10, //Set to zero for no heartbeat
    "PrefetchCount": 50,
    "PublisherConfirms": false,
    "PersistentMessages": true,
    "Platform": "localhost",
    "Timeout": 10,
    "Backup": {
      "UseLocalBackup": true,
      "DatabaseName": "devon4netMessageBackup.db"
    }
  },</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="icon-note" title=""></i>
</td>
<td class="content">
Please refer to the <a href="https://github.com/EasyNetQ/EasyNetQ/wiki/Connecting-to-RabbitMQ">official EasyNetQ documentation</a> for further details about connection parameters.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="devonfw-guide_devon4net.wiki_packages.asciidoc_setting-up-in-devon">Setting up in Devon</h3>
<div class="paragraph">
<p>For setting it up using the Devon4NetApi template configure it in the <code>appsettings.{environment}.json</code> file.</p>
</div>
<div class="paragraph">
<p>A template is available in the RabbitMqManagement folder of the <code>Devon4Net.Application.WebAPI.Implementation</code> Business folder:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw.github.io/devonfw.github.io/target/generated-docs/images/RabbitMqManagement.png" alt="RabbitMqManagement">
</div>
<div class="title">Figure 7. RabbitMQ Management folder structure</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>TodoCommand.cs</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="c# language-c#"> public class TodoCommand : Command
    {
        public string Description { get; set; }
    }</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>TodoCommand</code> inherits from <code>Command</code>, in this case, the <code>Description</code> will be added to the <code>Message</code>.</p>
</div>
</li>
<li>
<p><code>TodoRabbitMqHandler.cs</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="c# language-c#"> public class TodoRabbitMqHandler: RabbitMqHandler&lt;TodoCommand&gt;
    {
        private ITodoService TodoService { get; set; }

        public TodoRabbitMqHandler(IServiceCollection services, IBus serviceBus, bool subscribeToChannel = false) : base(services, serviceBus, subscribeToChannel)
        {
        }

        public TodoRabbitMqHandler(IServiceCollection services, IBus serviceBus, IRabbitMqBackupService rabbitMqBackupService, bool subscribeToChannel = false) : base(services, serviceBus, rabbitMqBackupService, subscribeToChannel)
        {
        }

        public TodoRabbitMqHandler(IServiceCollection services, IBus serviceBus, IRabbitMqBackupLiteDbService rabbitMqBackupLiteDbService, bool subscribeToChannel = false) : base(services, serviceBus, rabbitMqBackupLiteDbService, subscribeToChannel)
        {
        }

        public TodoRabbitMqHandler(IServiceCollection services, IBus serviceBus, IRabbitMqBackupService rabbitMqBackupService, IRabbitMqBackupLiteDbService rabbitMqBackupLiteDbService, bool subscribeToChannel = false) : base(services, serviceBus, rabbitMqBackupService, rabbitMqBackupLiteDbService, subscribeToChannel)
        {
        }

        public override async Task&lt;bool&gt; HandleCommand(TodoCommand command)
        {
            TodoService = GetInstance&lt;ITodoService&gt;();

            var result = await TodoService.CreateTodo(command.Description).ConfigureAwait(false);
            return result!=null;
        }
    }</code></pre>
</div>
</div>
<div class="paragraph">
<p>This class must to inherit from <code>RabbitMqHandler&lt;T&gt;</code> class.
<code>HandleCommand(T command)</code> method should be overridden in order to send command to the queue, this method returns true if the message has been published.</p>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="devonfw-guide_devon4net.wiki_packages.asciidoc_setting-up-in-other-projects">Setting up in other projects</h3>
<div class="paragraph">
<p>Install the package in your solution using the Package Manager Console:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="console language-console">Install-Package Devon4Net.Infrastructure.RabbitMQ</code></pre>
</div>
</div>
<div class="paragraph">
<p>Create a Configuration static class in order to add the <code>RabbitMqHandler</code> services, for example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="c# language-c#"> public static class Configuration
    {

        public static void SetupDependencyInjection(this IServiceCollection services, IConfiguration configuration)
        {

            var rabbitMq = serviceProvider.GetService&lt;IOptions&lt;RabbitMqOptions&gt;&gt;();

            if (rabbitMq?.Value != null &amp;&amp; rabbitMq.Value.EnableRabbitMq)
            {
                SetupRabbitHandlers(services);
            }
        }

        private static void SetupRabbitHandlers(IServiceCollection services)
        {
            services.AddRabbitMqHandler&lt;TodoRabbitMqHandler&gt;(true);
        }
    }</code></pre>
</div>
</div>
<div class="paragraph">
<p>Add the following lines in the <code>Program.cs</code> class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="c# language-c#">builder.Services.SetupRabbitMq(builder.Configuration);
builder.Services.SetupDependencyInjection(builder.Configuration);</code></pre>
</div>
</div>
<div class="paragraph">
<p>After adding the default settings provided in the configuration section, you may use the RabbitMQ component in your code.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="icon-note" title=""></i>
</td>
<td class="content">
Please see the <a href="https://www.rabbitmq.com/download.html"> RabbitMQ official documentation</a> for instructions on installing the RabbitMQ Server. You can also visit the <a href="#devonfw-guide_devon4net.wiki_howto.asciidoc">RabbitMQ How-to section</a>
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="devonfw-guide_devon4net.wiki_packages.asciidoc_devon4net.infrastructure.middleware">Devon4Net.Infrastructure.Middleware</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Middleware is software that&#8217;s assembled into an app pipeline to handle requests and responses. Request delegates are used to construct the request pipeline. Each HTTP request is handled by a request delegate.</p>
</div>
<div class="paragraph">
<p>The diagram below represents the whole request processing pipeline for ASP.NET Core MVC and Razor Pages apps.
You can see how existing middlewares are organized in a typical app and where additional middlewares are implemented.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw.github.io/devonfw.github.io/target/generated-docs/images/middleware-life-cycle.png" alt="middleware life cycle">
</div>
<div class="title">Figure 8. Middleware Order</div>
</div>
<div class="paragraph">
<p>The ASP.NET Core request pipeline is composed of a number of request delegates that are called one after the other. This concept is illustrated in the diagram below. The execution thread is shown by the black arrows.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw.github.io/devonfw.github.io/target/generated-docs/images/middleware-delegates-flow.png" alt="middleware delegates flow">
</div>
<div class="title">Figure 9. Delegates flow in middleware</div>
</div>
<div class="sect2">
<h3 id="devonfw-guide_devon4net.wiki_packages.asciidoc_configuration">Configuration</h3>
<div class="paragraph">
<p>In this component there are four custom Middlewares classes, configuration is made on file <code>appsettings.{environment}.json</code> as follows:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><code>ClientCertificatesMiddleware.cs</code>: For the management of client certificates.</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="json language-json">  "Certificates": {
    "ServerCertificate": {
      "Certificate": "",
      "CertificatePassword": ""
    },
    "ClientCertificate": {
      "EnableClientCertificateCheck": false,
      "RequireClientCertificate": false,
      "CheckCertificateRevocation": true,
      "ClientCertificates": {
        "Whitelist": [
          ""
        ]
      }
    }
  },</code></pre>
</div>
</div>
<div class="paragraph">
<p>The ClientCertificate Whitelist contains the client&#8217;s certificate thumbprint.</p>
</div>
</li>
<li>
<p><code>ExceptionHandlingMiddleware.cs</code>: Handles a few different types of exceptions.</p>
</li>
<li>
<p><code>CustomHeadersMiddleware.cs</code>: To add or remove certain response headers.</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="json language-json">"Headers": {
    "AccessControlExposeHeader": "Authorization",
    "StrictTransportSecurityHeader": "",
    "XFrameOptionsHeader": "DENY",
    "XssProtectionHeader": "1;mode=block",
    "XContentTypeOptionsHeader": "nosniff",
    "ContentSecurityPolicyHeader": "",
    "PermittedCrossDomainPoliciesHeader": "",
    "ReferrerPolicyHeader": ""
  },</code></pre>
</div>
</div>
<div class="paragraph">
<p>On the sample above, the server application will add to the response headers the <code>AccessControlExposeHeader</code>, <code>XFrameOptionsHeader</code>, <code>XssProtectionHeader</code> and <code>XContentTypeOptionsHeader</code> headers.
If the header response attribute does not have a value, it will not be added to the response headers.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="icon-note" title=""></i>
</td>
<td class="content">
Please refer to the <a href="#devonfw-guide_devon4net.wiki_howto.asciidoc">How To: Customize Headers</a> documentation for more information.
</td>
</tr>
</table>
</div>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw.github.io/devonfw.github.io/target/generated-docs/images/headers-middleware.png" alt="headers middleware">
</div>
<div class="title">Figure 10. Response Headers</div>
</div>
</li>
<li>
<p><code>KillSwicthMiddleware.cs</code>: To enable or disable HTTP requests.</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="json language-json">"KillSwitch": {
    "UseKillSwitch": false,
    "EnableRequests": true,
    "HttpStatusCode": 403
  },</code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all" style="width: 100%;">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong>Property</strong></th>
<th class="tableblock halign-left valign-top"><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">UseKillSwitch</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">True to enable KillSwtich middleware</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">EnableRequests</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">True to enable HTTP requests.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">HttpStatusCode</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">the HTTP status code that will be returned</p></td>
</tr>
</tbody>
</table>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="devonfw-guide_devon4net.wiki_packages.asciidoc_setting-up-in-devon">Setting up in Devon</h3>
<div class="paragraph">
<p>For setting it up using the Devon4NetApi template just configure it in the <code>appsettings.{environment}.json</code> file.</p>
</div>
</div>
<div class="sect2">
<h3 id="devonfw-guide_devon4net.wiki_packages.asciidoc_setting-up-in-other-projects">Setting up in other projects</h3>
<div class="paragraph">
<p>Install the package on your solution using the Package Manager Console:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="console language-console">install-package Devon4Net.Infrastructure.Middleware</code></pre>
</div>
</div>
<div class="paragraph">
<p>Configure the component in <code>Program.cs</code> adding the following lines:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="c# language-c#">using Devon4Net.Infrastructure.Middleware.Middleware;
.
.
.
builder.Services.SetupMiddleware(builder.Configuration);
.
.
.
app.SetupMiddleware(builder.Services);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Add the default configuration shown in the configuration section.</p>
</div>
</div>
<div class="sect2">
<h3 id="devonfw-guide_devon4net.wiki_packages.asciidoc_references">References</h3>
<div class="paragraph">
<p><a href="https://docs.microsoft.com/en-us/aspnet/core/fundamentals/middleware/?view=aspnetcore-6.0">ASP.NET Core Middleware - Microsoft Docs</a></p>
</div>
<div class="paragraph">
<p><a href="https://docs.microsoft.com/en-us/aspnet/core/fundamentals/middleware/write?view=aspnetcore-6.0">Write custom ASP.NET Core middleware - Microsoft Docs</a></p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="devonfw-guide_devon4net.wiki_packages.asciidoc_devon4net.infrastructure.unitofwork">Devon4Net.Infrastructure.UnitOfWork</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The idea of Unit of Work is related to the successful implementation of the Repository Pattern. It is necessary to first comprehend the Repository Pattern in order to fully understand this concept.</p>
</div>
<div class="sect2">
<h3 id="devonfw-guide_devon4net.wiki_packages.asciidoc_the-repository-pattern">The Repository Pattern</h3>
<div class="paragraph">
<p>A repository is a class defined for an entity, that contains all of the operations that may be executed on that entity. For example, a repository for an entity Employee will contain basic CRUD operations as well as any additional potential actions connected to it. The following procedures can be used to implement the Repository Pattern:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>One repository per entity (non-generic) : This approach makes use of a single repository class for each entity. For instance, if you have two entities, Todo and Employee, each will have its own repository.</p>
</li>
<li>
<p>Generic repository: A generic repository is one that can be used for all entities.</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="devonfw-guide_devon4net.wiki_packages.asciidoc_unit-of-work-in-the-repository-pattern">Unit of Work in the Repository Pattern</h4>
<div class="paragraph">
<p>Unit of Work is referred to as a single transaction that involves multiple operations of insert/update/delete. It means that, for a specific user action, all transactions are performed in a single transaction rather than several database transactions.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw.github.io/devonfw.github.io/target/generated-docs/images/Unit-of-work.png" alt="Unit of work">
</div>
<div class="title">Figure 11. Unit of work diagram</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="devonfw-guide_devon4net.wiki_packages.asciidoc_configuration">Configuration</h3>
<div class="paragraph">
<p>Connection strings must be added to the configuration in the file <code>appsettings.{environment}.json</code> as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="json language-json">"ConnectionStrings": {
    "Todo": "Add your database connection string here",
    "Employee": "Add your database connection string here"
  },</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="devonfw-guide_devon4net.wiki_packages.asciidoc_setting-up-in-devon">Setting up in Devon</h3>
<div class="paragraph">
<p>For setting it up using the Devon4NetApi template just configure the connection strings in the <code>appsettings.{environment}.json</code> file.</p>
</div>
<div class="paragraph">
<p>To add Databases, use the SetupDatabase method in the <code>DevonConfiguration.cs</code> file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="c# language-c#">  private static void SetupDatabase(IServiceCollection services, IConfiguration configuration)
        {
            services.SetupDatabase&lt;TodoContext&gt;(configuration, "Todo", DatabaseType.SqlServer, migrate:true).ConfigureAwait(false);
            services.SetupDatabase&lt;EmployeeContext&gt;(configuration, "Employee", DatabaseType.SqlServer, migrate:true).ConfigureAwait(false);
        }</code></pre>
</div>
</div>
<div class="paragraph">
<p>You must provide the configuration, the connection string key, and the database type.</p>
</div>
<div class="paragraph">
<p>The supported databases are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>SqlServer</p>
</li>
<li>
<p>Sqlite</p>
</li>
<li>
<p>InMemory</p>
</li>
<li>
<p>Cosmos</p>
</li>
<li>
<p>PostgreSQL</p>
</li>
<li>
<p>MySql</p>
</li>
<li>
<p>MariaDb</p>
</li>
<li>
<p>FireBird</p>
</li>
<li>
<p>Oracle</p>
</li>
<li>
<p>MSAccess</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Set the migrate property value to true if you need to use migrations, as shown above.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="icon-note" title=""></i>
</td>
<td class="content">
For more information about the use of migrations please visit the <a href="https://docs.microsoft.com/en-us/ef/core/managing-schemas/migrations/?tabs=dotnet-core-cli">official microsoft documentation</a>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Our typed repositories must inherit from the generic repository of the Unit Of Work component, as seen in the example below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="c# language-c#">  public class TodoRepository : Repository&lt;Todos&gt;, ITodoRepository
    {
        public TodoRepository(TodoContext context) : base(context)
        {

        }
        .
        .
        .
    }</code></pre>
</div>
</div>
<div class="paragraph">
<p>Use the methods of the generic repository to perform your CRUD actions:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="c# language-c#">public Task&lt;Todos&gt; Create(string description)
        {

            var todo = new Todos {Description = description};
            return Create(todo);
        }</code></pre>
</div>
</div>
<div class="paragraph">
<p>The default value for <code>AutoSaveChanges</code> to the Database is true, you may change it to false if you need to employ transactions.</p>
</div>
<div class="paragraph">
<p>Inject the Repository on the service of the business layer, as shown below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="c# language-c#">public class TodoService: Service&lt;TodoContext&gt;, ITodoService
    {
        private readonly ITodoRepository _todoRepository;

        public TodoService(IUnitOfWork&lt;TodoContext&gt; uoW) : base(uoW)
        {
            _todoRepository = uoW.Repository&lt;ITodoRepository&gt;();
        }
        .
        .
        .
    }</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="devonfw-guide_devon4net.wiki_packages.asciidoc_setting-up-in-other-projects">Setting up in other projects</h3>
<div class="paragraph">
<p>Install the package on your solution using the Package Manager Console:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="console language-console">install-package Devon4Net.Infrastructure.UnitOfWork</code></pre>
</div>
</div>
<div class="paragraph">
<p>Create a Configuration static class in order to add the <code>IRequestHandler</code> services, for example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="c# language-c#">public static class Configuration
    {
        public static void SetupDependencyInjection(this IServiceCollection services, IConfiguration configuration)
        {
            SetupDatabase(services, configuration);
        }

        private static void SetupDatabase(IServiceCollection services, IConfiguration configuration)
        {
            services.SetupDatabase&lt;TodoContext&gt;(configuration, "Default", DatabaseType.SqlServer).ConfigureAwait(false);
        }
    }</code></pre>
</div>
</div>
<div class="paragraph">
<p>Configure the component in <code>Program.cs</code> adding the following lines:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="c# language-c#">using Devon4Net.Domain.UnitOfWork;
.
.
.
builder.Services.SetupUnitOfWork(typeof(Configuration));</code></pre>
</div>
</div>
<div class="paragraph">
<p>Add the default configuration shown in the configuration section and follow the same steps as the previous section.</p>
</div>
</div>
<div class="sect2">
<h3 id="devonfw-guide_devon4net.wiki_packages.asciidoc_tips">Tips</h3>
<div class="paragraph">
<p><em>Predicate expression builder</em></p>
</div>
<div class="ulist">
<ul>
<li>
<p>Use this expression builder to generate lambda expressions dynamically:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="C# language-C#">var predicate =  PredicateBuilder.True&lt;T&gt;();</code></pre>
</div>
</div>
<div class="paragraph">
<p>Where <code>T</code> is a class. At this moment, you can build your expression and apply it to obtain your results in a efficient way and not retrieving data each time you apply an expression.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Example from My Thai Star .Net Core implementation:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="C# language-C#">public async Task&lt;PaginationResult&lt;Dish&gt;&gt; GetpagedDishListFromFilter(int currentpage, int pageSize, bool isFav, decimal maxPrice, int minLikes, string searchBy, IList&lt;long&gt; categoryIdList, long userId)
{
    var includeList = new List&lt;string&gt;{"DishCategory","DishCategory.IdCategoryNavigation", "DishIngredient","DishIngredient.IdIngredientNavigation","IdImageNavigation"};

    //Here we create our predicate builder
    var dishPredicate = PredicateBuilder.True&lt;Dish&gt;();


    //Now we start applying the different criteria:
    if (!string.IsNullOrEmpty(searchBy))
    {
        var criteria = searchBy.ToLower();
        dishPredicate = dishPredicate.And(d =&gt; d.Name.ToLower().Contains(criteria) || d.Description.ToLower().Contains(criteria));
    }

    if (maxPrice &gt; 0) dishPredicate = dishPredicate.And(d=&gt;d.Price&lt;=maxPrice);

    if (categoryIdList.Any())
    {
        dishPredicate = dishPredicate.And(r =&gt; r.DishCategory.Any(a =&gt; categoryIdList.Contains(a.IdCategory)));
    }

    if (isFav &amp;&amp; userId &gt;= 0)
    {
        var favourites = await UoW.Repository&lt;UserFavourite&gt;().GetAllAsync(w=&gt;w.IdUser == userId);
        var dishes = favourites.Select(s =&gt; s.IdDish);
        dishPredicate = dishPredicate.And(r=&gt; dishes.Contains(r.Id));
    }

    // Now we can use the predicate to retrieve data from database with just one call
    return await UoW.Repository&lt;Dish&gt;().GetAllIncludePagedAsync(currentpage, pageSize, includeList, dishPredicate);

}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div id="footer" class="footer">
<div class="openblock footerLinks">
<div class="content">
<div class="dlist linklist">
<dl>
<dt class="hdlist1">About</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><a href="/website/pages/welcome/welcome.html">About devonfw</a></p>
</li>
<li>
<p><a href="/website/pages/docs/devonfw-guide_getting-started.wiki_introduction-why-should-i-use-devonfw.asciidoc_features.html">Features</a></p>
</li>
<li>
<p><a href="/website/pages/docs/devonfw-guide_devon4j.wiki_architecture.asciidoc.html#devonfw-guide_devon4j.wiki_architecture.asciidoc_technology-stack">Technology Stack</a></p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div class="dlist linklist">
<dl>
<dt class="hdlist1">Explore</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><a href="/website/pages/docs/devonfw-guide_getting-started.wiki_getting-started.asciidoc.html">Getting started</a></p>
</li>
<li>
<p><a href="/website/pages/docs/devonfw-guide_devon4j.wiki_architecture.asciidoc.html">Architecture</a></p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div class="dlist linklist">
<dl>
<dt class="hdlist1">Docs</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><a href="/website/pages/docs/devonfw-guide_ide.wiki_devonfw-ide-introduction.asciidoc.html">User guide</a></p>
</li>
<li>
<p><a href="/website/pages/docs/devonfw-guide_general_master-release-notes.asciidoc.html">Releases information</a></p>
</li>
<li>
<p><a href="/website/pages/docs/master.html">Wiki</a></p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div class="dlist linklist">
<dl>
<dt class="hdlist1">Community</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/orgs/devonfw/people">Contributors</a></p>
</li>
<li>
<p><a href="https://github.com/devonfw/devonfw.github.io/blob/develop/README.asciidoc">Website Contribution</a></p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
</div>
<div class="ulist footerFooter">
<ul>
<li>
<p><a href="https://devonfw.com/website/pages/docs/devonfw-guide_ide.wiki_LICENSE.asciidoc.html">Terms of Use</a></p>
</li>
<li>
<p><a href="https://github.com/devonfw">Support</a></p>
</li>
</ul>
</div>
</div>
    <script>
      let bb = document.getElementById('menu-button');
      bb.addEventListener('click', function() {
        document.querySelector('.website-navbar ul').classList.toggle('visible');
        console.log(document.querySelector('.website-navbar ul'))
      })
    </script>
    <script type="module">
      import { EditLinksModule } from '/website/shared/editlinks.js';

      let alwaysVisible = true;
      if(document.location.pathname.endsWith("pages/welcome/welcome.html")) {
        alwaysVisible = false;
      }
      EditLinksModule.addEditLinks(alwaysVisible);
    </script>
    <script src="/website/assets/scripts/popper.min.js"></script>
    <script src="/website/assets/scripts/bootstrap.min.js"></script>
<div class="footnote"><sub>

Last updated 2022-06-27 15:49:24 UTC
</sub></div>
</div>
</div>
<link rel="stylesheet" type="text/css" href="https://cginternal.devonfw.com/websitesnippets/main.css">
<script async src="https://cginternal.devonfw.com/websitesnippets/main.js"></script>
<script>
  if(!document.location.pathname.endsWith("pages/welcome/welcome.html")) {
    anchors.options.visible = 'always';
  }
  anchors.add();
</script>
<script>
  var internalUrls = ["https://cginternal.devonfw.com/websitesnippets/"];
  $(".internal").each(function(){
    internalUrls.forEach((internalUrl, index) => {
      $.ajax({url: internalUrl + $(this).text() + "/index.html" })
      .then(r => {
        var leftDiv = $('<div class="info"><span class="infoText">Internal</span><img class="infoImage" src="' + internalUrl + 'logo.png"/></div>');
        var rightFirstDiv = $('<div class="message">This is only visible inside of the corporate network.</div>');
        var rightLastDiv = $('<div class="content"></div>');
        rightLastDiv.html(r);
        var rightDiv = $('<div class="right"></div>');
        rightDiv.append(rightFirstDiv);
        rightDiv.append(rightLastDiv);
        $(this).html(leftDiv);
        $(this).append(rightDiv);
        $(this).addClass("internal-active");
        $(this).removeClass("internal");
      })
    });
	});
</script>
<script>
      let cookieName = 'cookie_consent';
      let expiryTime = new Date(2037, 11, 21);
      let today = new Date();
      let cookieConsentDeclinedDate = localStorage.getItem("cookie_consent_declined");
      let dateDiffHours = 0;
      let cookieConsentHtml = `
      <div id="cookie-consent">
        <p>
          We use cookies to perform analytics and enhance user experience. Do you accept to the use of cookies?
        </p>
        <p class="cookie-consent-buttons">
          <a id="decline-cookie-btn" class="btn white-button" href="javascript:void(0)">Decline</a>
          <a id="accept-cookie-btn" class="btn blue-button" href="javascript:void(0)">Accept</a>
        </p>
      </div>
      `;
      dateDiffHours = cookieConsentDeclinedDate ? Math.abs(cookieConsentDeclinedDate - today) / 36e5 : 0;
      if (document.cookie.indexOf(cookieName) < 0) {
        if (cookieConsentDeclinedDate) {
          if (dateDiffHours > 24) {
            $("body").append(cookieConsentHtml);
          }
        } else {
          $("body").append(cookieConsentHtml);
        }
      }
      $("#accept-cookie-btn").click(function() {
        document.cookie = `${cookieName}=accept;expires=${expiryTime};path=/`;
        localStorage.removeItem("cookie_consent_declined");
        consentGranted();
        $("#cookie-consent").hide();
      });
      $("#decline-cookie-btn").click(function() {
        localStorage.setItem("cookie_consent_declined", today);
        $("#cookie-consent").hide();
      });
</script>
</body>
</html>