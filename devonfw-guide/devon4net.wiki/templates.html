<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=">
<meta name="generator" content="Asciidoctor 1.5.8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- ******** SOCIAL MEDIA META ********** -->

<meta name="title" property="og:title" content="devonfw website">
<meta property="og:type" content="website">
<meta name="image" property="og:image" content="https://devonfw.com/images/devonfwwebsite.png">
<meta name="description" property="og:description" content="devonfw is the standard open source software development platform; Serving the full Software Delivery Life Cycle.">
<meta property="og:url" content="https://devonfw.com/index.html">

<meta name="twitter:title" content="devonfw website">
<meta name="twitter:description" content="devonfw is the standard open source software development platform; Serving the full Software Delivery Life Cycle.">
<meta name="twitter:image" content="https://devonfw.com/images/devonfwwebsite.png">
<meta name="twitter:card" content="summary_large_image">

<!-- ************************************* -->


<title>Templates</title>
<!-- devonfw website stylesheet -->
<link rel="stylesheet" type="text/css" href="/devonfw.css">
<!-- Lunr -->
<script src="/website/assets/scripts/lunr.min.js"></script>
<!-- JQuery -->
<script src="/website/assets/scripts/jquery.min.js"></script>
<link rel="stylesheet" href="/website/assets/styles/font-awesome.min.css">
<link rel="stylesheet" href="/website/assets/styles/googlecode.min.css">
<script src="/website/assets/scripts/highlight.min.js"></script>
<script src="/website/assets/scripts/common.min.js"></script>
<script>hljs.initHighlightingOnLoad()</script>
<link rel="stylesheet" href="/website/assets/styles/bootstrap.min.css">

<script src="/website/assets/scripts/anchor.min.js"></script>

<script src="/website/components/header/search-engine/bundle.js"></script>

<script src="/website/shared/rightmenu.js"></script>

<!-- ************** Google analytics ************ -->
<script>
window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}

gtag('consent', 'default', {
  'analytics_storage': 'denied'
});
</script>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-151636804-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-151636804-1');
</script>
<script>
  function consentGranted() {
    gtag('consent', 'update', {
      'analytics_storage': 'granted'
    });
  }
</script>

<!-- ******************************************** -->


</head>
<body id="devonfw-guide_devon4net.wiki_templates.asciidoc" class="article">
<div id="website-navbar" class="website-navbar">
<button id="menu-button" class="menu-button">
  <img src="/images/menu-button.svg" width="32px" height="32px" alt=""/>
</button>

<ul>
<li>
<p><span class="image"><a class="image" href="/website/pages/welcome/welcome.html"><img alt="logo" src="/images/Logo_devonfw.svg"></a></span></p>
</li>
<li>
<p><a href="https://killercoda.com/devonfw">Tutorials</a></p>
</li>
<li>
<p><a href="/website/pages/solutions/index.html">Solutions</a></p>
</li>
<li>
<p><a href="/website/pages/docs/master.html">Docs</a></p>
</li>
</ul>

<form class="form-inline">
  <div class="search-bar">
    <input
      id="search-field"
      type="search"
      class="form-control mr-sm-2"
      placeholder="Search by keyword(s)..."
      aria-label="Search"
      style="height: auto;"
      autocomplete="off"/>
    <div class="sb-res-pos px-4">
      <div id="click-outside" class="click-outside z-50 hidden"></div>
      <div class="col rounded px-0 border z-100 bg-white hidden search-bar-results" id="search-results-box">
      </div>
    </div>
  </div>
</form>
<a class="navbar-github text-white" href="https://github.com/devonfw/">
  <img src="/images/github-mark.png" width=auto height=auto alt="">
</a></div>
<div id="sidebar" class="wiki-sidebar"></div>

<div id="content" class="mt-4 mt-sm-5">
<div id="preamble">
<div class="sectionbody">
<div class="toc2">
<div class="title">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#devonfw-guide_devon4net.wiki_templates.asciidoc_webapi-template">WebAPI Template</a>
<ul class="sectlevel2">
<li><a href="#devonfw-guide_devon4net.wiki_templates.asciidoc_devon4net.application.webapi">Devon4Net.Application.WebAPI</a></li>
<li><a href="#devonfw-guide_devon4net.wiki_templates.asciidoc_devon4net.application.implementation">Devon4Net.Application.Implementation</a></li>
<li><a href="#devonfw-guide_devon4net.wiki_templates.asciidoc_sample-of-use">Sample of use</a></li>
</ul>
</li>
<li><a href="#devonfw-guide_devon4net.wiki_templates.asciidoc_grpc-template">gRPC Template</a>
<ul class="sectlevel2">
<li><a href="#devonfw-guide_devon4net.wiki_templates.asciidoc_grpc">gRPC</a></li>
<li><a href="#devonfw-guide_devon4net.wiki_templates.asciidoc_protocol-buffers">Protocol Buffers</a></li>
<li><a href="#devonfw-guide_devon4net.wiki_templates.asciidoc_devon4net.application.grpcserver">Devon4Net.Application.GrpcServer</a></li>
<li><a href="#devonfw-guide_devon4net.wiki_templates.asciidoc_devon4net.application.grpcclient">Devon4Net.Application.GrpcClient</a></li>
<li><a href="#devonfw-guide_devon4net.wiki_templates.asciidoc_references">References</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div class="sect1">
<h2 id="devonfw-guide_devon4net.wiki_templates.asciidoc_webapi-template">WebAPI Template</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This section contains all of the information about the template that corresponds to the Devon4net WebAPI. This template will allow you to easily create a functional API with everything set up so you can start coding for your specific domain.</p>
</div>
<div class="paragraph">
<p>Firstly, all the details about the contents of the package will be explained. Going through all of the directory tree explaining the most imporant concepts. Then we will show an example of how to add the entity Student from the domain layer all the way to the controller, so you can understand how the architecture works on this template and how the layers interact with each other.</p>
</div>
<div class="sect2">
<h3 id="devonfw-guide_devon4net.wiki_templates.asciidoc_devon4net.application.webapi">Devon4Net.Application.WebAPI</h3>
<div class="paragraph">
<p>This is the startup project of the template. Its main purpose is to launch the api and configure it using the settings files. The following figure shows the directory tree you will find when you first use the template.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw.github.io/devonfw.github.io/target/generated-docs/images/Application.WebAPI_tree.png" alt="Application.WebAPI tree">
</div>
<div class="title">Figure 1. Devon4Net.Application.WebAPI Directory tree</div>
</div>
<div class="paragraph">
<p>Everything will be set up in the <code>Program.cs</code> file as for any .Net 6 Core API project. Going through this file, you will find all the configuration included with the template, such as middlewares and Dependency Injection.</p>
</div>
<div class="sect3">
<h4 id="devonfw-guide_devon4net.wiki_templates.asciidoc_appsettings.json">appsettings.json</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="json language-json">{
  "devonfw": {
    "UseDetailedErrorsKey": true,
    "UseIIS": false,
    "UseSwagger": true,
    "UseXsrf": true,
    "UseModelStateValidation": true,
    "Environment": "Development",
    "ForceUseHttpsRedirection": false,
    "Kestrel": {
      "UseHttps": false,
      "HttpProtocol": "Http1AndHttp2",
      "ApplicationPort": 8085,
      "SslProtocol": "Tls12",
      "ExtraSettings": {
        "KeepAliveTimeout": 120,
        "MaxConcurrentConnections": 100,
        "MaxConcurrentUpgradedConnections": 100,
        "MaxRequestBodySize": 28.6,
        "Http2MaxStreamsPerConnection": 100,
        "Http2InitialConnectionWindowSize": 131072,
        "Http2InitialStreamWindowSize": 98304,
        "AllowSynchronousIO": true
      }
    },
    "IIS": {
      "ForwardClientCertificate": true,
      "AutomaticAuthentication": true,
      "AuthenticationDisplayName": ""
    }
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the following list all the configuration fields are described:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>UseIIS</code>: Boolean that indicates if IIS is used.</p>
</li>
<li>
<p><code>ValidateIssuerSigningKey</code>: Boolean that controls if validation of the security key that signed the securityToken is called.</p>
</li>
<li>
<p><code>UseXsrf</code>: Boolean that adds Anti Forgery middleware to prevent XSRF attacks.</p>
</li>
<li>
<p><code>UseModelStateValidation</code>: Boolean that indicates if model validation is called.</p>
</li>
<li>
<p><code>Environment</code>: Running environment to load the corresponding configuration (Development, Production&#8230;&#8203;)</p>
</li>
<li>
<p><code>ForceUseHttpsRedirection</code>: Boolean to force adding a middleware that redirects HTTP requests to HTTPS.</p>
</li>
<li>
<p><code>Kestrel</code>: Kestrel server configuration</p>
<div class="ulist">
<ul>
<li>
<p><code>UseHttps</code>: Boolean to indicate if the connection needs to be secured via HTTPS.</p>
</li>
<li>
<p><code>HttpProtocol</code>: Hypertext protocol used.</p>
<table class="tableblock frame-all grid-all" style="width: 100%;">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Protocol</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Description</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Http1</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HTTP/1.x (default)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Http2</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HTTP/2</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Http1andHttp2</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Both HTTP/1.x and HTTP/2</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>none</code></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
</li>
<li>
<p><code>ApplicationPort</code>: Port number where the API will listen</p>
</li>
<li>
<p><code>SslProtocol</code>: SSL encrytion protocol for Https</p>
<table class="tableblock frame-all grid-all" style="width: 100%;">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Protocol</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Description</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Tls12</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TLS 1.2 (default, needed for Https2)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Tls13</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TLS 1.3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>none</code></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
</li>
<li>
<p><code>ExtraSettings</code>: Some extra settings for Kestrel</p>
<div class="ulist">
<ul>
<li>
<p><code>KeepAliveTimeout</code>: Sets the keep-alive timeout in seconds.</p>
</li>
<li>
<p><code>MaxConcurrentConnections</code>: Maximum number of open connections. Null is unlimited. Default is 100.</p>
</li>
<li>
<p><code>MaxConcurrentUpgradedConnections</code>: Maximum number of open upgraded connectinos. Null is unlimited. An upgraded connection is one that has been switched from HTTP to another protocol. Default is 100.</p>
</li>
<li>
<p><code>MaxRequestBodySize</code>: Maximum allowed size of any request body in MB. Default is 28.6MB.</p>
</li>
<li>
<p><code>Http2MaxStreamsPerConnection</code>: Maximum number of concurrent request streams per HTTP/2 connection. Excess streams will be refused. Default is 100.</p>
</li>
<li>
<p><code>Http2InitialConnectionWindowSize</code>: Indicates how much request body data the server is willing to receive and buffer at a time aggregated across all requests (streams) per connection. Value must be greater or equal to 65,535 and less than 2^31. Defaults to 128 KB.</p>
</li>
<li>
<p><code>Http2InitialStreamWindowSize</code>: Indicates how much request body data the server is willing to receive and buffer at a time per stream.</p>
</li>
<li>
<p><code>AllowSynchronousIO</code>: Boolean that controls wether Synchronous IO operations are allowed in requests.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
<li>
<p><code>IIS</code>: Internet Information Services configuration</p>
<div class="ulist">
<ul>
<li>
<p><code>ForwardClientCertificate</code>:  Populates the ITLSConnectionFeature if the MS-ASPNETCORE-CLIENTCERT request header is present</p>
</li>
<li>
<p><code>AutomaticAuthentication</code>: If true the middleware should set HttpContext.User. If false the middleware will only provide an identity when explicitly requested by the AuthenticationScheme. Note Windows Authentication must also be enabled in IIS for this to work.</p>
</li>
<li>
<p><code>AuthenticationDisplayName</code>: Sets the display name shown to users on login pages. The default is null</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>For each environment you can have a different configuration if you wish. You will find an <code>appsettings.Development.json</code> file where the configuration for the different components used in the template is placed. Please go through the documentation of each component to learn more about how are they configured.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="devonfw-guide_devon4net.wiki_templates.asciidoc_devon4net.application.implementation">Devon4Net.Application.Implementation</h3>
<div class="paragraph">
<p>This is where all the magic happens. This project holds all the classes needed to implement the API end-points. The following image shows the structure you will find in this project.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw.github.io/devonfw.github.io/target/generated-docs/images/Application.WebAPI.Implementation_tree.png" alt="Application.WebAPI.Implementation tree">
</div>
<div class="title">Figure 2. Devon4Net.Application.WebAPI.Implementation Directory tree</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="icon-note" title=""></i>
</td>
<td class="content">
Please refer to documentation about Architecture to understand better the proposed architecture which is Onion Architecture.
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="devonfw-guide_devon4net.wiki_templates.asciidoc_configuration">Configuration</h4>
<div class="paragraph">
<p>In this directory the Configuration is placed, you will find all the dependency injection code for this project in the static class <code>DevonConfiguration</code>. The code is divided into many private extensions based on their intended use, all of which are called by one main public extension for the <code>IServiceCollection</code> interface in the <code>Program.cs</code> file.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="icon-tip" title=""></i>
</td>
<td class="content">
If you need to segregate chunks of code, don&#8217;t be afraid to add extra static classes. This will improve reading and it will make it much easier to locate items later.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="devonfw-guide_devon4net.wiki_templates.asciidoc_domain">Domain</h4>
<div class="paragraph">
<p>As you may have learned thanks to the architecture document, this is the core of the application. It holds the entities and the contracts for the operations you can execute on them, that last being the repository interfaces.</p>
</div>
<div class="paragraph">
<p>You will be able to find also the different database contexts for the application in the Database directory. These contexts will allow <code>EntityFramework</code> to work properly by extending <code>DbContext</code> class.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw.github.io/devonfw.github.io/target/generated-docs/images/Application.WebAPI.Implementation.Domain.png" alt="Application.WebAPI.Implementation.Domain">
</div>
<div class="title">Figure 3. Devon4Net.Application.WebAPI.Implementation Domain layer</div>
</div>
<div class="paragraph">
<p>The repositories interfaces extend from a generic repository interface <code>IRepository&lt;T&gt;</code> available in Devon4Net. As you can see in figure 3, Devon4Net already comes with some examples of implementation for some entities. Please revise them so that you have a better understanding of how they work.</p>
</div>
</div>
<div class="sect3">
<h4 id="devonfw-guide_devon4net.wiki_templates.asciidoc_data">Data</h4>
<div class="paragraph">
<p>The Data directory corresponds to the Data Layer and implements all the interfaces contracts. This Repositories extend from a generic repository implementation <code>Repository&lt;T&gt;</code> available in Devon4Net. As you can see in the next figure, the template also come with some examples of implementation.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw.github.io/devonfw.github.io/target/generated-docs/images/Application.WebAPI.Implementation.Data.png" alt="Application.WebAPI.Implementation.Data">
</div>
<div class="title">Figure 4. Devon4Net.Application.WebAPI.Implementation Data layer</div>
</div>
</div>
<div class="sect3">
<h4 id="devonfw-guide_devon4net.wiki_templates.asciidoc_business">Business</h4>
<div class="paragraph">
<p>The Business directory is where all the application logic is placed, it corresponds to the Business Layer. You will find a lot of implemented examples as shown in the next image.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw.github.io/devonfw.github.io/target/generated-docs/images/Application.WebAPI.Implementation.Business.png" alt="Application.WebAPI.Implementation.Business">
</div>
<div class="title">Figure 5. Devon4Net.Application.WebAPI.Implementation Business layer</div>
</div>
<div class="paragraph">
<p>These are:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><strong>AntiForgeryTokenManagement:</strong> This is an example of how to use the XSRF protection in API controllers. It contains a controller class with a working example.</p>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw.github.io/devonfw.github.io/target/generated-docs/images/AntiForgeryTokenManagement.png" alt="AntiForgeryTokenManagement">
</div>
<div class="title">Figure 6. AntiForgeryTokenManagement directory</div>
</div>
</li>
<li>
<p><strong>AuthManagement:</strong> This example shows how to use Authorization in API controllers thanks to Json Web Tokens. It contains a controller class and some response entities needed to return information.</p>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw.github.io/devonfw.github.io/target/generated-docs/images/AuthManagement.png" alt="AuthManagement">
</div>
<div class="title">Figure 7. AuthManagement directory</div>
</div>
</li>
<li>
<p><strong>EmployeeManagement:</strong> This directory contains all the implementation classes for entity type Employee.</p>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw.github.io/devonfw.github.io/target/generated-docs/images/EmployeeManagement.png" alt="EmployeeManagement">
</div>
<div class="title">Figure 8. EmployeeManagement directory</div>
</div>
</li>
<li>
<p><strong>MediatRManagement:</strong> Example of how implement MediatR for using CQRS pattern.</p>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw.github.io/devonfw.github.io/target/generated-docs/images/MediatRManagement.png" alt="MediatRManagement">
</div>
<div class="title">Figure 9. MediatRManagement directory</div>
</div>
</li>
<li>
<p><strong>RabbitMqManagement:</strong> Sample of implementation of RabbitMq queues.</p>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw.github.io/devonfw.github.io/target/generated-docs/images/RabbitMqManagement.png" alt="RabbitMqManagement">
</div>
<div class="title">Figure 10. RabbitMqManagement directory</div>
</div>
</li>
<li>
<p><strong>TodoManagement:</strong> Implementation sample of entity type Todo.</p>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw.github.io/devonfw.github.io/target/generated-docs/images/TodoManagement.png" alt="TodoManagement">
</div>
<div class="title">Figure 11. TodoManagement directory</div>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect2">
<h3 id="devonfw-guide_devon4net.wiki_templates.asciidoc_sample-of-use">Sample of use</h3>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="icon-note" title=""></i>
</td>
<td class="content">
If you don&#8217;t know how to install and use this template, please refer to documentation on how to do it.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In this part we will be creating CRUD (Create, Read, Update and Delete) operations for the entity type <code>Student</code>. Before that, we will delete the samples that come with the template.</p>
</div>
<div class="sect3">
<h4 id="devonfw-guide_devon4net.wiki_templates.asciidoc_step-1-entity">Step 1: Entity</h4>
<div class="paragraph">
<p>First we will need the object <code>Student</code>. For that we will need to create a new <code>Student.cs</code> class in <code>Domain\Entities</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="c# language-c#">public class Student
{
    public long Id { get; set; }
    public string Name { get; set; }
    public string Surname { get; set; }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Our student should have an Identifier, and we will also put some interesting properties, name and surname for example.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="icon-tip" title=""></i>
</td>
<td class="content">
Is good practice to override <code>object</code> methods: <code>Equals(object o)</code>, <code>GetHashCode()</code> and <code>ToString()</code>.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="devonfw-guide_devon4net.wiki_templates.asciidoc_step-2-context">Step 2: Context</h4>
<div class="paragraph">
<p>EntityFramework will need a context to be able to work with Students. Lets create a <code>StudentContext.cs</code> class in <code>Domain\Database</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="c# language-c#">public class StudentContext : DbContext
{
    public virtual DbSet&lt;Student&gt; Students { get; set; }
    public StudentContext(DbContextOptions&lt;StudentContext&gt; options) : base(options)
    {
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="devonfw-guide_devon4net.wiki_templates.asciidoc_step-3-repository-contract">Step 3: Repository contract</h4>
<div class="paragraph">
<p>The repository contract in <code>Data\RepositoryInterfaces</code> will allow us to inject the repository and will increase decoupling. It will be implemented in the next step. You can inherit methods from Devon4Net <code>IRepository</code> as shown, but we will be also implementing a couple of queries:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="c# language-c#">public interface IStudentRepository : IRepository&lt;Student&gt;
{
    Task&lt;long&gt; DeleteById(long id);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Everything should be asynchronous making use of the <code>Task</code> class.</p>
</div>
</div>
<div class="sect3">
<h4 id="devonfw-guide_devon4net.wiki_templates.asciidoc_step-4-repository-implementation">Step 4: Repository implementation</h4>
<div class="paragraph">
<p>Now we will need a repository implementation for the previous interface. It will be placed in <code>Data\Repositories</code>, it will inherit also from Devon4Net generic repository and will implement interface methods:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="c# language-c#">public class StudentRepository : Repository&lt;Student&gt;, IStudentRepository
{
    public StudentRepository(StudentContext context) : base(context)
    {
    }

    public async Task&lt;long&gt; DeleteById(long id)
    {
        var deleted = await Delete(t =&gt; t.Id == id).ConfigureAwait(false);
        if (deleted) return id;
        throw  new ArgumentException($"The Todo entity {id} has not been deleted.");
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="devonfw-guide_devon4net.wiki_templates.asciidoc_step-5-studentdto">Step 5: StudentDto</h4>
<div class="paragraph">
<p>To increase decoupling, we will create a copy of the entity Student in <code>Business\Dto</code> for the Business layer. To make it a little different we will be including the surname in the property <code>FullName</code> and it will be separated before being stored in the database and viceversa:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="c# language-c#">public class StudentDto
{
    public long Id { get; set; }
    public string FullName { get; set; }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>We will need also a converter placed in <code>Business\Converters</code> so we can transform it in both directions:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="c# language-c#">public static class StudentConverter
{
    public static StudentDto EntityToDto(Student item)
    {
        if (item == null) return new StudentDto();
        return new StudentDto
        {
            Id = item.Id,
            FullName = item.Name + " " + item.Surname
        };
    }

    public static Student DtoToEntity(StudentDto item)
    {
        if (item == null) return new Student();
        return new Student
        {
            Id = item.Id,
            Name = item.FullName.Split(" ")[0],
            Surname = item.FullName.Split(" ")[1]
        };
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="devonfw-guide_devon4net.wiki_templates.asciidoc_step-6-service">Step 6: Service</h4>
<div class="paragraph">
<p>Now we will need a service in <code>Business\StudentManagement\Service</code>. The service will execute all the necessary operations.  In this case as it is a simple CRUD it will only call the repository. The Devon4Net Service class implements Unit of Work pattern.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="c# language-c#">public interface IStudentService
{
    Task&lt;IEnumerable&lt;StudentDto&gt;&gt; GetAllStudents();
    Task&lt;Student&gt; CreateStudent(StudentDto student);
    Task&lt;long&gt; DeleteStudentById(long id);
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="c# language-c#">public class StudentService: Service&lt;StudentContext&gt;, IStudentService
{
    private readonly IStudentRepository _studentRepository;

    public StudentService(IUnitOfWork&lt;StudentContext&gt; uoW) : base(uoW)
    {
        _studentRepository = uoW.Repository&lt;IStudentRepository&gt;();
    }

    public async Task&lt;IEnumerable&lt;StudentDto&gt;&gt; GetAllStudents()
    {
        Devon4NetLogger.Debug("GetTodo method from service TodoService");
        var result = await _studentRepository.Get().ConfigureAwait(false);
        return result.Select(StudentConverter.EntityToDto);
    }

    public async Task&lt;StudentDto&gt; CreateStudent(StudentDto student)
    {
        var result = await _studentRepository.Create(StudentConverter.DtoToEntity(student));
        return StudentConverter.EntityToDto(result);
    }

    public async Task&lt;long&gt; DeleteStudentById(long id)
    {
        var todo = await _studentRepository.GetFirstOrDefault(t =&gt; t.Id == id).ConfigureAwait(false);
        if (todo == null) throw new ArgumentException($"The provided Id {id} does not exist");
        return await _studentRepository.DeleteById(id).ConfigureAwait(false);
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="devonfw-guide_devon4net.wiki_templates.asciidoc_step-7-controller">Step 7: Controller</h4>
<div class="paragraph">
<p>The controller will end up looking like this and needs to be placed in <code>Business\StudentManagement\Controllers</code>. It uses the <code>IStudentService</code> via dependency injection.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="c# language-c#">[EnableCors("CorsPolicy")]
[ApiController]
[Route("[controller]")]
public class StudentController : ControllerBase
{
    private readonly IStudentService _studentService;

    public StudentController(IStudentService studentService)
    {
        _studentService = studentService;
    }

    [HttpGet]
    [ProducesResponseType(typeof(List&lt;StudentDto&gt;), StatusCodes.Status200OK)]
    [ProducesResponseType(StatusCodes.Status400BadRequest)]
    [ProducesResponseType(StatusCodes.Status404NotFound)]
    [ProducesResponseType(StatusCodes.Status500InternalServerError)]
    public async Task&lt;ActionResult&gt; GetStudents()
    {
        return Ok(await _studentService.GetAllStudents().ConfigureAwait(false));
    }

    [HttpPost]
    [ProducesResponseType(typeof(StudentDto), StatusCodes.Status201Created)]
    [ProducesResponseType(StatusCodes.Status400BadRequest)]
    [ProducesResponseType(StatusCodes.Status404NotFound)]
    [ProducesResponseType(StatusCodes.Status500InternalServerError)]
    public async Task&lt;ActionResult&gt; Create(StudentDto student)
    {
        var result = await _studentService.CreateStudent(student).ConfigureAwait(false);
        return StatusCode(StatusCodes.Status201Created, result);
    }

    [HttpDelete]
    [ProducesResponseType(typeof(long), StatusCodes.Status200OK)]
    [ProducesResponseType(StatusCodes.Status400BadRequest)]
    [ProducesResponseType(StatusCodes.Status404NotFound)]
    [ProducesResponseType(StatusCodes.Status500InternalServerError)]
    public async Task&lt;ActionResult&gt; Delete(long id)
    {
        return Ok(await _studentService.DeleteStudentById(id).ConfigureAwait(false));
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="devonfw-guide_devon4net.wiki_templates.asciidoc_step-8-dependency-injection">Step 8: Dependency Injection</h4>
<div class="paragraph">
<p>Now we are ready to inject the context in <code>Configuration\DevonConfiguration.cs</code>. In this example we are creating a database stored in memory:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="c# language-c#">services.SetupDatabase&lt;StudentContext&gt;(configuration, "Default", DatabaseType.InMemory).ConfigureAwait(false);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Also the repository and the service, so we can use them in the entire solution.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="c# language-c#">services.AddTransient&lt;IStudentRepository, StudentRepository&gt;();
services.AddTransient&lt;IStudentService, StudentService&gt;();</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="devonfw-guide_devon4net.wiki_templates.asciidoc_test">Test</h4>
<div class="paragraph">
<p>Now you can run the application and go to the path <code>swagger/index.html</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="icon-note" title=""></i>
</td>
<td class="content">
take a look at your application port and the protocol you configured (http or https).
</td>
</tr>
</table>
</div>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw.github.io/devonfw.github.io/target/generated-docs/images/WebApi_template_swagger.png" alt="WebApi template swagger">
</div>
<div class="title">Figure 12. Swagger test for Student</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="devonfw-guide_devon4net.wiki_templates.asciidoc_grpc-template">gRPC Template</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In this part of the document you will learn what is gRPC and how the devon4net gRPC template works.</p>
</div>
<div class="paragraph">
<p>To help you understand how the template works, we will first go over some general concepts concerning gRPC technology in broad strokes. Then continue describing the contract shared between client and server and how it is formed using Google&#8217;s Protocol Buffers. And last but not least, both the GrpcClient and the GrpcServer will be explained.</p>
</div>
<div class="sect2">
<h3 id="devonfw-guide_devon4net.wiki_templates.asciidoc_grpc">gRPC</h3>
<div class="paragraph">
<p>gRPC is a modern open source high performance Remote Procedure Call (RPC) framework. It is totally independent of the language used on the client side and the server side.</p>
</div>
<div class="paragraph">
<p>In gRPC a client app can directly call a method on a server application. Both parts need to share a file that acts as a contract. This way compatibility is ensured between client and server without taking languages into account.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw.github.io/devonfw.github.io/target/generated-docs/images/gRPC.png" alt="gRPC">
</div>
<div class="title">Figure 13. gRPC diagram</div>
</div>
<div class="paragraph">
<p>On the server side, we need to develop a service that implements the contract shared between both parts and also listens to client calls and process them using this implementation.</p>
</div>
<div class="paragraph">
<p>On the client side, the client can use the methods provided by this contract thanks to the "stub" (gRPC client).</p>
</div>
<div class="paragraph">
<p>This file is the Protocol Buffer (".proto" file)and needs to be both in the client and the server for them to understand each other.</p>
</div>
</div>
<div class="sect2">
<h3 id="devonfw-guide_devon4net.wiki_templates.asciidoc_protocol-buffers">Protocol Buffers</h3>
<div class="paragraph">
<p>Protocol buffers provide a cross-platform mechanism for serializing structured data. It is like a JSON file, but smaller and faster.</p>
</div>
<div class="paragraph">
<p>This protocol buffers are written in an language called <code>proto3</code>. The following piece of code describes an example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="proto language-proto">syntax = "proto3";

option csharp_namespace = "Devon4Net.Application.GrpcClient.Protos";

package greet;

// The greeting service definition.
service Greeter {
  // Sends a greeting
  rpc SayHello (HelloRequest) returns (HelloReply);
}

// The request message containing the user's name.
message HelloRequest {
  string name = 1;
}

// The response message containing the greetings.
message HelloReply {
  string message = 1;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The first line, specifies that you are using the <code>proto3</code> version. There are other versions such as <code>proto2</code>.</p>
</div>
<div class="paragraph">
<p>The option <code>csharp_namespace</code> specifies the namespace of the proto file in C#.</p>
</div>
<div class="paragraph">
<p>A message types are definitions of object structures. A message might have different fields, that have:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Type: Type of the field value. It can be any scalar type (int32, double, string&#8230;&#8203;) or composite type (enumerations, other messages&#8230;&#8203;).</p>
</li>
<li>
<p>Number: Each field has a unique number which is used to identify the field.</p>
</li>
<li>
<p>Rule: Singular (can have zero or one) or repeated (can be zero or multiple times rpeated)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You can also see a service contract, which is called <code>Greeter</code> and has a method <code>SayHello</code> that accepts a <code>HelloRequest</code> and returns a <code>HelloReply</code>, both also defined on the file.</p>
</div>
</div>
<div class="sect2">
<h3 id="devonfw-guide_devon4net.wiki_templates.asciidoc_devon4net.application.grpcserver">Devon4Net.Application.GrpcServer</h3>
<div class="paragraph">
<p>This project will launch the server that will be called from the GrpcClient and will manage the rpc calls to the available methods.</p>
</div>
<div class="paragraph">
<p>The proto file, which is shown in the previous section, defines the contract for the service, that will need to be implemented in this same project.</p>
</div>
<div class="paragraph">
<p>As you can see in the following figure, the proto file is placed in the directory <code>Protos</code>.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw.github.io/devonfw.github.io/target/generated-docs/images/grpc_server.png" alt="grpc server">
</div>
<div class="title">Figure 14. GrpcServer directory tree</div>
</div>
<div class="paragraph">
<p>The service <code>GreeterService</code>, will need to extend <code>Greeter.GreeterBase</code> which is generated automatically thanks to the service named <code>Greeter</code> in the proto file.</p>
</div>
<div class="paragraph">
<p>This service will need to override the method <code>SayHello</code> defined in the proto file. This method can be overriden from the class <code>Greeter.GreeterBase</code> as it was already implemented:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="c# language-c#">[GrpcDevonService]
public class GreeterService : Greeter.GreeterBase
{
    public GreeterService()
    {
    }

    public override Task&lt;HelloReply&gt; SayHello(HelloRequest request, ServerCallContext context)
    {
        return Task.FromResult(new HelloReply
        {
            Message = "Hello " + request.Name
        });
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Notice the attribute <code>GrpcDevonService</code>. All services marked with this attribute will be auto registered in the <code>Program.cs</code> when adding the following line:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="c# language-c#">builder.Services.AddGrpc();
.
.
.
app.SetupGrpcServices(new List&lt;string&gt; { "Devon4Net.Application.GrpcServer" });</code></pre>
</div>
</div>
<div class="paragraph">
<p>The list of strings provided as argument is the list of assemblies where devon will look for gRPC services tagged with that attribute.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="icon-note" title=""></i>
</td>
<td class="content">
Check the component documentation to learn more.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="devonfw-guide_devon4net.wiki_templates.asciidoc_devon4net.application.grpcclient">Devon4Net.Application.GrpcClient</h3>
<div class="paragraph">
<p>The client project will access the GrpcServer project end-point thanks to the protocol buffer and the configuration in the <code>appsettings.{environment}.json</code>. For trying out the communication between the client and the server, you will find an end-point in the <code>GrpcGreeterController</code> class.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw.github.io/devonfw.github.io/target/generated-docs/images/grpc_client.png" alt="grpc client">
</div>
<div class="title">Figure 15. GrpcClient directory tree</div>
</div>
<div class="paragraph">
<p>The configuration is done adding the following options to the settings file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="json language-json"> "Grpc": {
    "EnableGrpc": true,
    "UseDevCertificate": true,
    "GrpcServer": "https://localhost:5002",
    "MaxReceiveMessageSize": 16,
    "RetryPatternOptions": {
      "MaxAttempts": 5,
      "InitialBackoffSeconds": 1,
      "MaxBackoffSeconds": 5,
      "BackoffMultiplier": 1.5,
      "RetryableStatus": "Unavailable"
    }
  },</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="icon-note" title=""></i>
</td>
<td class="content">
<code>GrpcServer</code> is the direction of the gRPC end-points. To learn more about the component configuration please visit the package documentation.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The following line will configure the component to use this configuration in the <code>Program.cs</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="c# language-c#">builder.Services.SetupGrpc(builder.Configuration);</code></pre>
</div>
</div>
<div class="paragraph">
<p>The greeter controller will use a <code>GrpcChannel</code> injected in the constructor as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="c# language-c#">[ApiController]
[Route("[controller]")]
public class GrpcGreeterClientController : ControllerBase
{
    private GrpcChannel GrpcChannel { get; }

    public GrpcGreeterClientController(GrpcChannel grpcChannel)
    {
        GrpcChannel = grpcChannel;
    }</code></pre>
</div>
</div>
<div class="paragraph">
<p>You will find that the end-point that accesses the gRPC service looks like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="c# language-c#">[HttpGet]
public async Task&lt;HelloReply&gt; Get(string name)
{
    try
    {
        var client = new Greeter.GreeterClient(GrpcChannel);
        return await client.SayHelloAsync(new HelloRequest { Name = name }).ResponseAsync.ConfigureAwait(false);
    }
    catch (Exception ex)
    {
        Devon4NetLogger.Error(ex);
        throw;
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>Greeter.GreeterClient</code> is created automatically and can be used when adding the reference to the proto file namespace with the <code>using</code> directive.</p>
</div>
</div>
<div class="sect2">
<h3 id="devonfw-guide_devon4net.wiki_templates.asciidoc_references">References</h3>
<div class="ulist">
<ul>
<li>
<p><a href="https://grpc.io/docs/what-is-grpc/introduction/">Introduction to gRPC - gRPC Docs</a></p>
</li>
<li>
<p><a href="https://developers.google.com/protocol-buffers/docs/overview">Protocol Buffers - Google Docs</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div id="footer" class="footer">
<div class="openblock footerLinks">
<div class="content">
<div class="dlist linklist">
<dl>
<dt class="hdlist1">About</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><a href="/website/pages/welcome/welcome.html">About devonfw</a></p>
</li>
<li>
<p><a href="/website/pages/docs/devonfw-guide_getting-started.wiki_introduction-why-should-i-use-devonfw.asciidoc_features.html">Features</a></p>
</li>
<li>
<p><a href="/website/pages/docs/devonfw-guide_devon4j.wiki_architecture.asciidoc.html#devonfw-guide_devon4j.wiki_architecture.asciidoc_technology-stack">Technology Stack</a></p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div class="dlist linklist">
<dl>
<dt class="hdlist1">Explore</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><a href="/website/pages/docs/devonfw-guide_getting-started.wiki_getting-started.asciidoc.html">Getting started</a></p>
</li>
<li>
<p><a href="/website/pages/docs/devonfw-guide_devon4j.wiki_architecture.asciidoc.html">Architecture</a></p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div class="dlist linklist">
<dl>
<dt class="hdlist1">Docs</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><a href="/website/pages/docs/devonfw-guide_ide.wiki_devonfw-ide-introduction.asciidoc.html">User guide</a></p>
</li>
<li>
<p><a href="/website/pages/docs/devonfw-guide_general_master-release-notes.asciidoc.html">Releases information</a></p>
</li>
<li>
<p><a href="/website/pages/docs/master.html">Wiki</a></p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div class="dlist linklist">
<dl>
<dt class="hdlist1">Community</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/orgs/devonfw/people">Contributors</a></p>
</li>
<li>
<p><a href="https://github.com/devonfw/devonfw.github.io/blob/develop/README.asciidoc">Website Contribution</a></p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
</div>
<div class="ulist footerFooter">
<ul>
<li>
<p><a href="https://devonfw.com/website/pages/docs/devonfw-guide_ide.wiki_LICENSE.asciidoc.html">Terms of Use</a></p>
</li>
<li>
<p><a href="https://github.com/devonfw">Support</a></p>
</li>
</ul>
</div>
</div>
    <script>
      let bb = document.getElementById('menu-button');
      bb.addEventListener('click', function() {
        document.querySelector('.website-navbar ul').classList.toggle('visible');
        console.log(document.querySelector('.website-navbar ul'))
      })
    </script>
    <script type="module">
      import { EditLinksModule } from '/website/shared/editlinks.js';

      let alwaysVisible = true;
      if(document.location.pathname.endsWith("pages/welcome/welcome.html")) {
        alwaysVisible = false;
      }
      EditLinksModule.addEditLinks(alwaysVisible);
    </script>
    <script src="/website/assets/scripts/popper.min.js"></script>
    <script src="/website/assets/scripts/bootstrap.min.js"></script>
<div class="footnote"><sub>

Last updated 2022-06-29 08:19:41 UTC
</sub></div>
</div>
</div>
<link rel="stylesheet" type="text/css" href="https://cginternal.devonfw.com/websitesnippets/main.css">
<script async src="https://cginternal.devonfw.com/websitesnippets/main.js"></script>
<script>
  if(!document.location.pathname.endsWith("pages/welcome/welcome.html")) {
    anchors.options.visible = 'always';
  }
  anchors.add();
</script>
<script>
  var internalUrls = ["https://cginternal.devonfw.com/websitesnippets/"];
  $(".internal").each(function(){
    internalUrls.forEach((internalUrl, index) => {
      $.ajax({url: internalUrl + $(this).text() + "/index.html" })
      .then(r => {
        var leftDiv = $('<div class="info"><span class="infoText">Internal</span><img class="infoImage" src="' + internalUrl + 'logo.png"/></div>');
        var rightFirstDiv = $('<div class="message">This is only visible inside of the corporate network.</div>');
        var rightLastDiv = $('<div class="content"></div>');
        rightLastDiv.html(r);
        var rightDiv = $('<div class="right"></div>');
        rightDiv.append(rightFirstDiv);
        rightDiv.append(rightLastDiv);
        $(this).html(leftDiv);
        $(this).append(rightDiv);
        $(this).addClass("internal-active");
        $(this).removeClass("internal");
      })
    });
	});
</script>
<script>
      let cookieName = 'cookie_consent';
      let expiryTime = new Date(2037, 11, 21);
      let today = new Date();
      let cookieConsentDeclinedDate = localStorage.getItem("cookie_consent_declined");
      let dateDiffHours = 0;
      let cookieConsentHtml = `
      <div id="cookie-consent">
        <p>
          We use cookies to perform analytics and enhance user experience. Do you accept to the use of cookies?
        </p>
        <p class="cookie-consent-buttons">
          <a id="decline-cookie-btn" class="btn white-button" href="javascript:void(0)">Decline</a>
          <a id="accept-cookie-btn" class="btn blue-button" href="javascript:void(0)">Accept</a>
        </p>
      </div>
      `;
      dateDiffHours = cookieConsentDeclinedDate ? Math.abs(cookieConsentDeclinedDate - today) / 36e5 : 0;
      if (document.cookie.indexOf(cookieName) < 0) {
        if (cookieConsentDeclinedDate) {
          if (dateDiffHours > 24) {
            $("body").append(cookieConsentHtml);
          }
        } else {
          $("body").append(cookieConsentHtml);
        }
      }
      $("#accept-cookie-btn").click(function() {
        document.cookie = `${cookieName}=accept;expires=${expiryTime};path=/`;
        localStorage.removeItem("cookie_consent_declined");
        consentGranted();
        $("#cookie-consent").hide();
      });
      $("#decline-cookie-btn").click(function() {
        localStorage.setItem("cookie_consent_declined", today);
        $("#cookie-consent").hide();
      });
</script>
</body>
</html>